(window.webpackJsonp=window.webpackJsonp||[]).push([[99],{419:function(a,t,e){"use strict";e.r(t);var n=e(6),v=Object(n.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("SkyWalking概念与设计总览")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://skyapm.github.io/document-cn-translation-of-skywalking/zh/8.0.0/",target:"_blank",rel:"noopener noreferrer"}},[a._v("SkyWalking"),t("OutboundLink")],1),a._v(": 一个开源的可观测平台, 用于从服务和云原生基础设施收集, 分析, 聚合及可视化数据。SkyWalking 提供了一种简便的方式来清晰地观测分布式系统, 甚至横跨多个云平台。SkyWalking 更是一个现代化的应用程序性能监控(Application Performance Monitoring)系统, 尤其专为云原生、基于容器的分布式系统设计。")])]),a._v(" "),t("p",[t("strong",[a._v("为什么使用 SkyWalking")])]),a._v(" "),t("p",[a._v("SkyWalking 可以为为 服务(service), 服务实例(service instance), 以及 端点(endpoint) 提供了可观测能力。")]),a._v(" "),t("p",[a._v("● 服务(Service)： 表示对请求提供相同行为的一组工作负载。在使用打点代理或 SDK 的时候，你可以定义服务的名字。")]),a._v(" "),t("p",[a._v("● 服务实例(Service Instance)： 上述的一组工作负载中的每一个工作负载称为一个实例。就像 "),t("code",[a._v("Kubernetes")]),a._v(" 中的"),t("code",[a._v("pods")]),a._v(" 一样，服务实例未必就是操作系统上的一个进程。但当你在使用打点代理的时候，一个服务实例实际就是操作系统上的一个真实进程。")]),a._v(" "),t("p",[a._v("● 端点(Endpoint)：对于特定服务所接收的请求路径， 如 HTTP 的 "),t("code",[a._v("URI")]),a._v(" 路径和 gRPC 服务的类名 + 方法签名。")]),a._v(" "),t("p",[a._v("使用 SkyWalking 时，用户可以看到服务与端点之间的拓扑结构，每个服务/服务实例/端点的性能指标，还可以设置报警规则。")]),a._v(" "),t("p",[a._v("除此之外, 你还可以通过以下方式集成")]),a._v(" "),t("ol",[t("li",[a._v("其他使用带有 Zipkin、Jaeger 和 OpenCensus 的 SkyWalking 本地代理和 SDK 的分布式跟踪。")]),a._v(" "),t("li",[a._v("其他度量指标系统，例如 Prometheus , Sleuth(Micrometer)。")])]),a._v(" "),t("h2",{attrs:{id:"架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#架构"}},[a._v("#")]),a._v(" 架构")]),a._v(" "),t("p",[a._v("kyWalking 逻辑上分为四部分: 探针, 平台后端, 存储和用户界面.\n"),t("img",{attrs:{src:"note-doc/img/dev/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/framework.png",alt:"nacos"}})]),a._v(" "),t("ul",[t("li",[t("strong",[a._v("探针")]),a._v(" 基于不同的来源可能是不一样的，但作用都是收集数据，将数据格式化为 SkyWalking 适用的格式。")]),a._v(" "),t("li",[t("strong",[a._v("平台后端")]),a._v(" 支持数据聚合，数据分析以及驱动数据流从探针到用户界面的流程。分析包括 Skywalking 原生追踪和性能指标以及第三方来源，包括 Istio 及 Envoy telemetry 、Zipkin 追踪格式化等。 你甚至可以使用 Observability Analysis Language 对原生度量指标 和 用于扩展度量的计量系统 自定义聚合分析。")]),a._v(" "),t("li",[t("strong",[a._v("存储")]),a._v(" 通过开放的插件化的接口存放 SkyWalking 数据。你可以选择一个既有的存储系统，如 ElasticSearch, H2 或 MySQL 集群(Sharding-Sphere 管理)，也可以选择自己实现一个存储系统。 当然，我们非常欢迎你贡献新的存储系统实现。")]),a._v(" "),t("li",[t("strong",[a._v("UI")]),a._v(" 一个基于接口高度定制化的Web系统，用户可以可视化查看和管理 SkyWalking 数据。")])]),a._v(" "),t("h2",{attrs:{id:"设计目标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设计目标"}},[a._v("#")]),a._v(" 设计目标")]),a._v(" "),t("ul",[t("li",[t("strong",[a._v("保持可观测性")]),a._v(" 不管目标系统如何部署， SkyWalking 总要提供一种方案或集成方式来保持对目标系统的观测， 基于此， SkyWalking 提供了数种运行时探针。")]),a._v(" "),t("li",[t("strong",[a._v("拓扑结构， 性能指标和追踪一体化")]),a._v(" 理解分布式系统的第一步是通过观察其拓扑结构图。 拓扑图可以将复杂的系统在一张简单的图里面进行可视化展现。 基于拓扑图，运维支撑系统相关人员需要更多关于服务/实例/端点/调用的性能指标。 链路追踪(trace)作为详细的日志， 对于此种性能指标来说很有意义， 如你想知道什么时候端点延时变得很长， 想了解最慢的链路并找出原因。 因此你可以看到， 这些需求都是从大局到细节的， 都缺一不可。 SkyWalking 集成并提供了一系列特性来使得这些需求成为可能， 并且使之易于理解。")]),a._v(" "),t("li",[t("strong",[a._v("轻量级")]),a._v(" 有两个方面需要保持轻量级。\n"),t("ul",[t("li",[a._v("(1) 探针， 我们通常依赖于网络传输框架， 如 gRPC。 在这种情况下， 探针就应该尽可能小， 防止依赖库冲突以及虚拟机的负载压力(例如 JVM 永久代内存占用压力)。")]),a._v(" "),t("li",[a._v("(2) 作为一个观测平台， 在你的整个项目环境中只是次要系统， 因此我们使用自己的轻量级框架来构建后端核心服务。 所以你不需要部署并维护大数据相关的平台， SkyWalking 在技术栈方面应该足够简单。")])])]),a._v(" "),t("li",[t("strong",[a._v("可插拔")]),a._v(" SkyWalking 核心团队提供了许多默认实现， 但这肯定是不够的， 也不可能适用于每一种场景， 因此我们提供了大量的特性来支持可插拔功能。")]),a._v(" "),t("li",[t("strong",[a._v("可移植")]),a._v(" SkyWalking 可以运行在多种环境下， 包括:\n"),t("ul",[t("li",[a._v("(1) 使用传统的注册中心， 如 Eureka")]),a._v(" "),t("li",[a._v("(2) 使用包含服务发现的 RPC 框架，如 Spring Cloud， Apache Dubbo")]),a._v(" "),t("li",[a._v("(3) 在现代基础设施中使用服务网格")]),a._v(" "),t("li",[a._v("(4) 使用云服务")]),a._v(" "),t("li",[a._v("(5) 跨云部署")])])])]),a._v(" "),t("p",[a._v("在所有这些情况下，SkyWalking 应该运行良好。")]),a._v(" "),t("ul",[t("li",[t("strong",[a._v("可互操作")]),a._v(" 可观测性是一个庞大的领域， 即使有强大的社区， SkyWalking 不可能支持所有方方面面， 因此 SkyWalking 支持与其他运维支撑系统进行互操作， 主要是探针， 如 Zipkin， Jaeger， OpenTracing 和 OpenCensus。 SkyWalking 接收并理解他们的数据格式， 这对于终端用户来说是非常有用的， 因为不需要他们更换已有的库。")])]),a._v(" "),t("h2",{attrs:{id:"spring-cloud-使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#spring-cloud-使用"}},[a._v("#")]),a._v(" spring cloud 使用")]),a._v(" "),t("ol",[t("li",[a._v("下载skywalking-apm\n"),t("a",{attrs:{href:"https://skywalking.apache.org/downloads/",target:"_blank",rel:"noopener noreferrer"}},[a._v("apache-skywalking-apm-X.tar.gz"),t("OutboundLink")],1)]),a._v(" "),t("li",[a._v("下载skywalking java-agent.jar\n"),t("a",{attrs:{href:"(https://skywalking.apache.org/downloads/)"}},[a._v("apache-skywalking-java-agent-X.tgz")])]),a._v(" "),t("li",[a._v("skywalking-apm 服务端、UI和CLI设置\n"),t("a",{attrs:{href:"https://skyapm.github.io/document-cn-translation-of-skywalking/zh/8.0.0/setup/backend/backend-ui-setup.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("参考ui启动文档"),t("OutboundLink")],1)])]),a._v(" "),t("p",[a._v("SkyWalking 后端发布包主要分以下几块内容;")]),a._v(" "),t("ol",[t("li",[t("strong",[a._v("启动脚本")]),a._v(", "),t("code",[a._v("/bin")]),a._v(" 目录。 包含linux启动和Windows启动服务和UI的脚本。")]),a._v(" "),t("li",[t("strong",[a._v("配置文件")]),a._v(", "),t("code",[a._v("/config")]),a._v(" 目录。 包含以下配置文件。\n"),t("ul",[t("li",[t("code",[a._v("application.yml")])]),a._v(" "),t("li",[t("code",[a._v("log4j.xml")])]),a._v(" "),t("li",[t("code",[a._v("alarm-settings.yml")])])])]),a._v(" "),t("li",[t("strong",[a._v("引用Jar")]),a._v(", "),t("code",[a._v("/oap-libs")]),a._v(" 目录. 包含服务端所有依赖的jar包.")]),a._v(" "),t("li",[t("strong",[a._v("Webapp相关")]),a._v(", "),t("code",[a._v("webapp")]),a._v(" 目录. 包含UI界面的jar和 webapp.yml的配置文件")])]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),t("p",[t("code",[a._v("config/application.yml")]),a._v(" 的默认数据存储开启是的"),t("code",[a._v("h2")]),a._v("，这里我们需要修改数据存储为 "),t("code",[a._v("Elasticsearch")]),a._v("（在启动 SkyWalking 之前，"),t("strong",[a._v("确保 Elasticsearch 已启动")]),a._v("）\nSkyWalking 的启动包括两部分，一个是 "),t("code",[a._v("SkyWalking Collector（oapService）")]),a._v(" ，一个是 "),t("code",[a._v("SkyWalking UI（webappService）")]),a._v("。")])]),a._v(" "),t("p",[a._v("SkyWalking 解压后的 bin 目录如下图所示：\n"),t("img",{attrs:{src:"note-doc/img/dev/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/bin.png",alt:"SkyWalking"}})]),a._v(" "),t("p",[t("code",[a._v("bat")]),a._v(" 为 windows 环境使用，"),t("code",[a._v("sh")]),a._v(" 为 linux 环境使用，我们可以分别启动"),t("code",[a._v("oapService")]),a._v(" 和 "),t("code",[a._v("webappService")]),a._v("，也可以通过 "),t("code",[a._v("startup")]),a._v(" 一次性全部启动，从 startup 中的命令可以知道其实就是分别启动 oapService 和 webappService。")]),a._v(" "),t("p",[a._v("启动完成后，通过 "),t("a",{attrs:{href:"http://localhost:8080",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://localhost:8080"),t("OutboundLink")],1),a._v(" 来查看 SkyWalking UI 了（默认全是0，截图是测试效果），默认账号/密码："),t("code",[a._v("admin/admin")]),a._v("。")]),a._v(" "),t("h2",{attrs:{id:"java-agent"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#java-agent"}},[a._v("#")]),a._v(" java-agent")]),a._v(" "),t("h3",{attrs:{id:"idea-部署探针"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#idea-部署探针"}},[a._v("#")]),a._v(" IDEA 部署探针")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("解压java agent\n"),t("img",{attrs:{src:"note-doc/img/dev/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/agent.png",alt:"SkyWalking"}})])]),a._v(" "),t("li",[t("p",[a._v("修改项目的 VM 运行参数，点击菜单栏中的 "),t("code",[a._v("Run")]),a._v(" -> "),t("code",[a._v("EditConfigurations")]),a._v("...，此处我们以 "),t("code",[a._v("myapp-gateway")]),a._v(" 项目为例，修改参数如下:\n"),t("img",{attrs:{src:"note-doc/img/dev/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/jvm.png",alt:"SkyWalking"}})])])]),a._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("-javaagent:E:\\hz\\me\\spring-cloud-templete\\skywalking\\skywalking-agent.jar \n-Dskywalking.agent.service_name=myapp-gateway \n-Dskywalking.collector.backend_service=localhost:11800\n\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"center"}},[a._v("参数")]),a._v(" "),t("th",{staticStyle:{"text-align":"center"}},[a._v("描述")])])]),a._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"center"}},[a._v("-javaagent")]),a._v(" "),t("td",{staticStyle:{"text-align":"center"}},[a._v("用于指定探针路径")])]),a._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[a._v("-Dskywalking.agent.service_name")]),a._v(" "),t("td",{staticStyle:{"text-align":"center"}},[a._v("用于重写 agent/config/agent.config 配置文件中的服务名")])]),a._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[a._v("-Dskywalking.collector.backend_service")]),a._v(" "),t("td",{staticStyle:{"text-align":"center"}},[a._v("用于重写 agent/config/agent.config 配置文件中的服务地址")])])])]),a._v(" "),t("p",[a._v("启动项目，访问接口，再去("),t("a",{attrs:{href:"http://localhost:8080",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://localhost:8080 "),t("OutboundLink")],1),a._v(")看面板数据")]),a._v(" "),t("p",[t("img",{attrs:{src:"note-doc/img/dev/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/skywalking-index.png",alt:"SkyWalking"}})]),a._v(" "),t("h3",{attrs:{id:"链路跟踪"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#链路跟踪"}},[a._v("#")]),a._v(" 链路跟踪")]),a._v(" "),t("p",[a._v("当我们访问一个服务，而他会调用另一个服务的时候，点击拓扑图会出现下图的效果，这就是链路跟踪的效果")]),a._v(" "),t("p",[t("img",{attrs:{src:"note-doc/img/dev/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/skywalking-graph.png",alt:"SkyWalking"}})]),a._v(" "),t("h3",{attrs:{id:"追踪调用链"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#追踪调用链"}},[a._v("#")]),a._v(" 追踪调用链")]),a._v(" "),t("p",[a._v("在追踪界面，可以查看整个请求的具体调用链\n"),t("img",{attrs:{src:"note-doc/img/dev/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/skywalking-trace.png",alt:"SkyWalking"}})])])}),[],!1,null,null,null);t.default=v.exports}}]);