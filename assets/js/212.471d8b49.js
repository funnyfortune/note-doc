(window.webpackJsonp=window.webpackJsonp||[]).push([[212],{533:function(e,s,a){"use strict";a.r(s);var t=a(6),r=Object(t.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"spring-cloud-gateway-内置的过滤器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#spring-cloud-gateway-内置的过滤器"}},[e._v("#")]),e._v(" Spring Cloud Gateway 内置的过滤器")]),e._v(" "),s("p",[e._v("原文链接：https://blog.51cto.com/zero01/2430429")]),e._v(" "),s("h3",{attrs:{id:"内置的过滤器工厂"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内置的过滤器工厂"}},[e._v("#")]),e._v(" 内置的过滤器工厂")]),e._v(" "),s("p",[e._v("这里简单将 Spring Cloud Gateway 内置的所有过滤器工厂整理成了一张表格，虽然不是很详细，但能作为速览使用。如下：")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("过滤器工厂")]),e._v(" "),s("th",[e._v("作用")]),e._v(" "),s("th",[e._v("参数")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[e._v("AddRequestHeader")]),e._v(" "),s("td",[e._v("为原始请求添加 Header")]),e._v(" "),s("td",[e._v("Header 的名称及值")])]),e._v(" "),s("tr",[s("td",[e._v("AddRequestParameter")]),e._v(" "),s("td",[e._v("为原始请求添加请求参数")]),e._v(" "),s("td",[e._v("参数名称及值")])]),e._v(" "),s("tr",[s("td",[e._v("AddResponseHeader")]),e._v(" "),s("td",[e._v("为原始响应添加 Header")]),e._v(" "),s("td",[e._v("Header 的名称及值")])]),e._v(" "),s("tr",[s("td",[e._v("DedupeResponseHeader")]),e._v(" "),s("td",[e._v("剔除响应头中重复的值")]),e._v(" "),s("td",[e._v("需要去重的 Header 名称及去重策略")])]),e._v(" "),s("tr",[s("td",[e._v("Hystrix")]),e._v(" "),s("td",[e._v("为路由引入 Hystrix 的断路器保护")]),e._v(" "),s("td",[s("code",[e._v("HystrixCommand")]),e._v("的名称")])]),e._v(" "),s("tr",[s("td",[e._v("FallbackHeaders")]),e._v(" "),s("td",[e._v("为 fallbackUri 的请求头中添加具体的异常信息")]),e._v(" "),s("td",[e._v("Header 的名称")])]),e._v(" "),s("tr",[s("td",[e._v("PrefixPath")]),e._v(" "),s("td",[e._v("为原始请求路径添加前缀")]),e._v(" "),s("td",[e._v("前缀路径")])]),e._v(" "),s("tr",[s("td",[e._v("PreserveHostHeader")]),e._v(" "),s("td",[e._v("为请求添加一个 preserveHostHeader=true 的属性，路由过滤器会检查该属性以决定是否要发送原始的 Host")]),e._v(" "),s("td",[e._v("无")])]),e._v(" "),s("tr",[s("td",[e._v("RequestRateLimiter")]),e._v(" "),s("td",[e._v("用于对请求限流，限流算法为令牌桶")]),e._v(" "),s("td",[e._v("keyResolver、rateLimiter、statusCode、denyEmptyKey、emptyKeyStatus")])]),e._v(" "),s("tr",[s("td",[e._v("RedirectTo")]),e._v(" "),s("td",[e._v("将原始请求重定向到指定的 URL")]),e._v(" "),s("td",[e._v("http 状态码及重定向的 url")])]),e._v(" "),s("tr",[s("td",[e._v("RemoveHopByHopHeadersFilter")]),e._v(" "),s("td",[e._v("为原始请求删除 IETF 组织规定的一系列 Header")]),e._v(" "),s("td",[e._v("默认就会启用，可以通过配置指定仅删除哪些 Header")])]),e._v(" "),s("tr",[s("td",[e._v("RemoveRequestHeader")]),e._v(" "),s("td",[e._v("为原始请求删除某个 Header")]),e._v(" "),s("td",[e._v("Header 名称")])]),e._v(" "),s("tr",[s("td",[e._v("RemoveResponseHeader")]),e._v(" "),s("td",[e._v("为原始响应删除某个 Header")]),e._v(" "),s("td",[e._v("Header 名称")])]),e._v(" "),s("tr",[s("td",[e._v("RewritePath")]),e._v(" "),s("td",[e._v("重写原始的请求路径")]),e._v(" "),s("td",[e._v("原始路径正则表达式以及重写后路径的正则表达式")])]),e._v(" "),s("tr",[s("td",[e._v("RewriteResponseHeader")]),e._v(" "),s("td",[e._v("重写原始响应中的某个 Header")]),e._v(" "),s("td",[e._v("Header 名称，值的正则表达式，重写后的值")])]),e._v(" "),s("tr",[s("td",[e._v("SaveSession")]),e._v(" "),s("td",[e._v("在转发请求之前，强制执行"),s("code",[e._v("WebSession::save")]),e._v("操作")]),e._v(" "),s("td",[e._v("无")])]),e._v(" "),s("tr",[s("td",[e._v("secureHeaders")]),e._v(" "),s("td",[e._v("为原始响应添加一系列起安全作用的响应头")]),e._v(" "),s("td",[e._v("无，支持修改这些安全响应头的值")])]),e._v(" "),s("tr",[s("td",[e._v("SetPath")]),e._v(" "),s("td",[e._v("修改原始的请求路径")]),e._v(" "),s("td",[e._v("修改后的路径")])]),e._v(" "),s("tr",[s("td",[e._v("SetResponseHeader")]),e._v(" "),s("td",[e._v("修改原始响应中某个 Header 的值")]),e._v(" "),s("td",[e._v("Header 名称，修改后的值")])]),e._v(" "),s("tr",[s("td",[e._v("SetStatus")]),e._v(" "),s("td",[e._v("修改原始响应的状态码")]),e._v(" "),s("td",[e._v("HTTP 状态码，可以是数字，也可以是字符串")])]),e._v(" "),s("tr",[s("td",[e._v("StripPrefix")]),e._v(" "),s("td",[e._v("用于截断原始请求的路径")]),e._v(" "),s("td",[e._v("使用数字表示要截断的路径的数量")])]),e._v(" "),s("tr",[s("td",[e._v("Retry")]),e._v(" "),s("td",[e._v("针对不同的响应进行重试")]),e._v(" "),s("td",[e._v("retries、statuses、methods、series")])]),e._v(" "),s("tr",[s("td",[e._v("RequestSize")]),e._v(" "),s("td",[e._v("设置允许接收最大请求包的大小。如果请求包大小超过设置的值，则返回 "),s("code",[e._v("413 Payload Too Large")])]),e._v(" "),s("td",[e._v("请求包大小，单位为字节，默认值为 5M")])]),e._v(" "),s("tr",[s("td",[e._v("ModifyRequestBody")]),e._v(" "),s("td",[e._v("在转发请求之前修改原始请求体内容")]),e._v(" "),s("td",[e._v("修改后的请求体内容")])]),e._v(" "),s("tr",[s("td",[e._v("ModifyResponseBody")]),e._v(" "),s("td",[e._v("修改原始响应体的内容")]),e._v(" "),s("td",[e._v("修改后的响应体内容")])]),e._v(" "),s("tr",[s("td",[e._v("Default")]),e._v(" "),s("td",[e._v("为所有路由添加过滤器")]),e._v(" "),s("td",[e._v("过滤器工厂名称及值")])])])]),e._v(" "),s("p",[e._v("**Tips：**每个过滤器工厂都对应一个实现类，并且这些类的名称必须以"),s("code",[e._v("GatewayFilterFactory")]),e._v("结尾，这是 Spring Cloud Gateway 的一个约定，例如"),s("code",[e._v("AddRequestHeader")]),e._v("对应的实现类为"),s("code",[e._v("AddRequestHeaderGatewayFilterFactory")]),e._v("。对源码感兴趣的小伙伴就可以按照这个规律拼接出具体的类名，以此查找这些内置过滤器工厂的实现代码")]),e._v(" "),s("h4",{attrs:{id:"_1、addrequestheader-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、addrequestheader-gatewayfilter-factory"}},[e._v("#")]),e._v(" 1、AddRequestHeader GatewayFilter Factory")]),e._v(" "),s("p",[e._v("为原始请求添加 "),s("a",{attrs:{href:"https://so.csdn.net/so/search?q=Header&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"}},[e._v("Header"),s("OutboundLink")],1),e._v("，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: add_request_header_route\n        uri: https://example.org\n        filters:\n        - AddRequestHeader=X-Request-Foo, Bar\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("p",[e._v("为原始请求添加名为 "),s("code",[e._v("X-Request-Foo")]),e._v(" ，值为 "),s("code",[e._v("Bar")]),e._v(" 的请求头")]),e._v(" "),s("h4",{attrs:{id:"_2、addrequestparameter-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、addrequestparameter-gatewayfilter-factory"}},[e._v("#")]),e._v(" 2、AddRequestParameter GatewayFilter Factory")]),e._v(" "),s("p",[e._v("为原始请求添加请求参数及值，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: add_request_parameter_route\n        uri: https://example.org\n        filters:\n        - AddRequestParameter=foo, bar\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("p",[e._v("为原始请求添加名为 foo，值为 bar 的参数，即："),s("code",[e._v("foo=bar")])]),e._v(" "),s("h4",{attrs:{id:"_3、addresponseheader-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、addresponseheader-gatewayfilter-factory"}},[e._v("#")]),e._v(" 3、AddResponseHeader GatewayFilter Factory")]),e._v(" "),s("p",[e._v("为原始响应添加 Header，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: add_response_header_route\n        uri: https://example.org\n        filters:\n        - AddResponseHeader=X-Response-Foo, Bar\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("p",[e._v("为原始响应添加名为 "),s("code",[e._v("X-Request-Foo")]),e._v(" ，值为 "),s("code",[e._v("Bar")]),e._v(" 的响应头")]),e._v(" "),s("h4",{attrs:{id:"_4、deduperesponseheader-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、deduperesponseheader-gatewayfilter-factory"}},[e._v("#")]),e._v(" 4、DedupeResponseHeader GatewayFilter Factory")]),e._v(" "),s("p",[e._v("DedupeResponseHeader 可以根据配置的 Header 名称及去重策略剔除响应头中重复的值，这是 Spring Cloud Greenwich SR2 提供的新特性，低于这个版本无法使用。")]),e._v(" "),s("p",[e._v("我们在 Gateway 以及"),s("a",{attrs:{href:"https://so.csdn.net/so/search?q=%E5%BE%AE%E6%9C%8D%E5%8A%A1&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"}},[e._v("微服务"),s("OutboundLink")],1),e._v("上都设置了 CORS（解决跨域）Header 的话，如果不做任何配置，那么请求 -> 网关 -> 微服务，获得的 CORS Header 的值，就将会是这样的：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Access-Control-Allow-Credentials: true, true\nAccess-Control-Allow-Origin: https://musk.mars, https://musk.mars\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("可以看到这两个 Header 的值都重复了，若想把这两个 Header 的值去重的话，就需要使用到 DedupeResponseHeader，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: dedupe_response_header_route\n        uri: https://example.org\n        filters:\n        # 若需要去重的Header有多个，使用空格分隔\n        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("p",[e._v("去重策略：")]),e._v(" "),s("ul",[s("li",[e._v("RETAIN_FIRST：默认值，保留第一个值")]),e._v(" "),s("li",[e._v("RETAIN_LAST：保留最后一个值")]),e._v(" "),s("li",[e._v("RETAIN_UNIQUE：保留所有唯一值，以它们第一次出现的顺序保留")])]),e._v(" "),s("p",[e._v("若想对该过滤器工厂有个比较全面的了解的话，建议阅读该过滤器工厂的源码，因为源码里有详细的注释及示例，比官方文档写得还好："),s("code",[e._v("org.springframework.cloud.gateway.filter.factory.DedupeResponseHeaderGatewayFilterFactory")])]),e._v(" "),s("h4",{attrs:{id:"_5、hystrix-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5、hystrix-gatewayfilter-factory"}},[e._v("#")]),e._v(" 5、Hystrix GatewayFilter Factory")]),e._v(" "),s("p",[e._v("为路由引入 Hystrix 的断路器保护，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: hystrix_route\n        uri: https://example.org\n        filters:\n        - Hystrix=myCommandName\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("p",[e._v("Hystrix 是 Spring Cloud 第一代容错组件，不过已经进入维护模式，未来 Hystrix 会被 Spring Cloud 移除掉，取而代之的是 Alibaba Sentinel/Resilience4J。所以本文不做详细介绍了，感兴趣的话可以参考官方文档：")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fcloud.spring.io%2Fspring-cloud-static%2FGreenwich.SR2%2Fsingle%2Fspring-cloud.html%23hystrix",target:"_blank",rel:"noopener noreferrer"}},[e._v("Hystrix GatewayFilter Factory"),s("OutboundLink")],1)])]),e._v(" "),s("h4",{attrs:{id:"_6、fallbackheaders-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6、fallbackheaders-gatewayfilter-factory"}},[e._v("#")]),e._v(" 6、FallbackHeaders GatewayFilter Factory")]),e._v(" "),s("p",[e._v("同样是对 Hystrix 的支持，上一小节所介绍的过滤器工厂支持一个配置参数："),s("code",[e._v("fallbackUri")]),e._v("，该配置用于当发生异常时将请求转发到一个特定的 uri 上。而"),s("code",[e._v("FallbackHeaders")]),e._v("这个过滤工厂可以在转发请求到该 uri 时添加一个 Header，这个 Header 的值为具体的异常信息。配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: ingredients\n        uri: lb://ingredients\n        predicates:\n        - Path=//ingredients/**\n        filters:\n        - name: Hystrix\n          args:\n            name: fetchIngredients\n            fallbackUri: forward:/fallback\n      - id: ingredients-fallback\n        uri: http://localhost:9994\n        predicates:\n        - Path=/fallback\n        filters:\n        - name: FallbackHeaders\n          args:\n            executionExceptionTypeHeaderName: Test-Header\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br")])]),s("p",[e._v("这里也不做详细介绍了，感兴趣可以参考官方文档：")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fcloud.spring.io%2Fspring-cloud-static%2FGreenwich.SR2%2Fsingle%2Fspring-cloud.html%23fallback-headers",target:"_blank",rel:"noopener noreferrer"}},[e._v("FallbackHeaders GatewayFilter Factory"),s("OutboundLink")],1)])]),e._v(" "),s("h4",{attrs:{id:"_7、prefixpath-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7、prefixpath-gatewayfilter-factory"}},[e._v("#")]),e._v(" 7、PrefixPath GatewayFilter Factory")]),e._v(" "),s("p",[e._v("为原始的请求路径添加一个前缀路径，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: prefixpath_route\n        uri: https://example.org\n        filters:\n        - PrefixPath=/mypath\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("p",[e._v("该配置使访问"),s("code",[e._v("${GATEWAY_URL}/hello")]),e._v(" 会转发到"),s("code",[e._v("https://example.org/mypath/hello")])]),e._v(" "),s("h4",{attrs:{id:"_8、preservehostheader-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8、preservehostheader-gatewayfilter-factory"}},[e._v("#")]),e._v(" 8、PreserveHostHeader GatewayFilter Factory")]),e._v(" "),s("p",[e._v("为请求添加一个 preserveHostHeader=true 的属性，路由过滤器会检查该属性以决定是否要发送原始的 Host Header。配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: preserve_host_route\n        uri: https://example.org\n        filters:\n        - PreserveHostHeader\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("p",[e._v("如果不设置，那么名为 "),s("code",[e._v("Host")]),e._v(" 的 Header 将由 Http Client 控制")]),e._v(" "),s("h4",{attrs:{id:"_9、requestratelimiter-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9、requestratelimiter-gatewayfilter-factory"}},[e._v("#")]),e._v(" 9、RequestRateLimiter GatewayFilter Factory")]),e._v(" "),s("p",[e._v("用于对请求进行限流，限流算法为令牌桶。配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: requestratelimiter_route\n        uri: https://example.org\n        filters:\n        - name: RequestRateLimiter\n          args:\n            redis-rate-limiter.replenishRate: 10\n            redis-rate-limiter.burstCapacity: 20\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br")])]),s("p",[e._v("由于另一篇文章中已经介绍过如何使用该过滤器工厂实现"),s("a",{attrs:{href:"https://so.csdn.net/so/search?q=%E7%BD%91%E5%85%B3&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"}},[e._v("网关"),s("OutboundLink")],1),e._v("限流，所以这里就不再赘述了：")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fblog.51cto.com%2Fzero01%2F2430532",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring Cloud Gateway - 扩展"),s("OutboundLink")],1)])]),e._v(" "),s("p",[e._v("或者参考官方文档：")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fcloud.spring.io%2Fspring-cloud-static%2FGreenwich.SR2%2Fsingle%2Fspring-cloud.html%23_requestratelimiter_gatewayfilter_factory",target:"_blank",rel:"noopener noreferrer"}},[e._v("RequestRateLimiter GatewayFilter Factory"),s("OutboundLink")],1)])]),e._v(" "),s("h4",{attrs:{id:"_10、redirectto-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10、redirectto-gatewayfilter-factory"}},[e._v("#")]),e._v(" 10、RedirectTo GatewayFilter Factory")]),e._v(" "),s("p",[e._v("将原始请求重定向到指定的 Url，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: redirect_route\n        uri: https://example.org\n        filters:\n        - RedirectTo=302, https://acme.org\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("p",[e._v("该配置使访问 "),s("code",[e._v("${GATEWAY_URL}/hello")]),e._v(" 会被重定向到 "),s("code",[e._v("https://acme.org/hello")]),e._v(" ，并且携带一个 "),s("code",[e._v("Location:http://acme.org")]),e._v(" 的 Header，而返回客户端的 HTTP 状态码为 302")]),e._v(" "),s("p",[e._v("注意事项：")]),e._v(" "),s("ul",[s("li",[e._v("HTTP 状态码应为 3xx，例如 301")]),e._v(" "),s("li",[e._v("URL 必须是合法的 URL，该 URL 会作为"),s("code",[e._v("Location")]),e._v(" Header 的值")])]),e._v(" "),s("h4",{attrs:{id:"_11、removehopbyhopheadersfilter-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_11、removehopbyhopheadersfilter-gatewayfilter-factory"}},[e._v("#")]),e._v(" 11、RemoveHopByHopHeadersFilter GatewayFilter Factory")]),e._v(" "),s("p",[e._v("为原始请求删除 "),s("a",{attrs:{href:"https://links.jianshu.com/go?to=https%3A%2F%2Ftools.ietf.org%2Fhtml%2Fdraft-ietf-httpbis-p1-messaging-14%23section-7.1.3",target:"_blank",rel:"noopener noreferrer"}},[e._v("IETF"),s("OutboundLink")],1),e._v(" 组织规定的一系列 Header，默认删除的 Header 如下：")]),e._v(" "),s("ul",[s("li",[e._v("Connection")]),e._v(" "),s("li",[e._v("Keep-Alive")]),e._v(" "),s("li",[e._v("Proxy-Authenticate")]),e._v(" "),s("li",[e._v("Proxy-Authorization")]),e._v(" "),s("li",[e._v("TE")]),e._v(" "),s("li",[e._v("Trailer")]),e._v(" "),s("li",[e._v("Transfer-Encoding")]),e._v(" "),s("li",[e._v("Upgrade")])]),e._v(" "),s("p",[e._v("可以通过配置去指定仅删除哪些 Header，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      filter:\n        remove-hop-by-hop:\n          # 多个Header使用逗号（,）分隔\n          headers: Connection,Keep-Alive\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br")])]),s("h4",{attrs:{id:"_12、removerequestheader-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12、removerequestheader-gatewayfilter-factory"}},[e._v("#")]),e._v(" 12、RemoveRequestHeader GatewayFilter Factory")]),e._v(" "),s("p",[e._v("为原始请求删除某个 Header，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: removerequestheader_route\n        uri: https://example.org\n        filters:\n        - RemoveRequestHeader=X-Request-Foo\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("p",[e._v("删除原始请求中名为 "),s("code",[e._v("X-Request-Foo")]),e._v(" 的请求头")]),e._v(" "),s("h4",{attrs:{id:"_13、removeresponseheader-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_13、removeresponseheader-gatewayfilter-factory"}},[e._v("#")]),e._v(" 13、RemoveResponseHeader GatewayFilter Factory")]),e._v(" "),s("p",[e._v("为原始响应删除某个 Header，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: removeresponseheader_route\n        uri: https://example.org\n        filters:\n        - RemoveResponseHeader=X-Response-Foo\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("p",[e._v("删除原始响应中名为 "),s("code",[e._v("X-Request-Foo")]),e._v(" 的响应头")]),e._v(" "),s("h4",{attrs:{id:"_14、rewritepath-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_14、rewritepath-gatewayfilter-factory"}},[e._v("#")]),e._v(" 14、RewritePath GatewayFilter Factory")]),e._v(" "),s("p",[e._v("通过正则表达式重写原始的请求路径，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: rewritepath_route\n        uri: https://example.org\n        predicates:\n        - Path=/foo/**\n        filters:\n        # 参数1为原始路径的正则表达式，参数2为重写后路径的正则表达式\n        - RewritePath=/foo/(?<segment>.*), /$\\{segment}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br")])]),s("p",[e._v("该配置使得访问 "),s("code",[e._v("/foo/bar")]),e._v(" 时，会将路径重写为"),s("code",[e._v("/bar")]),e._v(" 再进行转发，也就是会转发到 "),s("code",[e._v("https://example.org/bar")]),e._v("。需要注意的是：由于 YAML 语法，需用"),s("code",[e._v("$\\")]),e._v(" 替换 "),s("code",[e._v("$")])]),e._v(" "),s("h4",{attrs:{id:"_15、rewriteresponseheader-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_15、rewriteresponseheader-gatewayfilter-factory"}},[e._v("#")]),e._v(" 15、RewriteResponseHeader GatewayFilter Factory")]),e._v(" "),s("p",[e._v("重写原始响应中的某个 Header，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: rewriteresponseheader_route\n        uri: https://example.org\n        filters:\n        # 参数1为Header名称，参数2为值的正则表达式，参数3为重写后的值\n        - RewriteResponseHeader=X-Response-Foo, password=[^&]+, password=***\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("p",[e._v("该配置的意义在于：如果响应头中 "),s("code",[e._v("X-Response-Foo")]),e._v(" 的值为"),s("code",[e._v("/42?user=ford&password=omg!what&flag=true")]),e._v("，那么就会被按照配置的值重写成"),s("code",[e._v("/42?user=ford&password=***&flag=true")]),e._v("，也就是把其中的"),s("code",[e._v("password=omg!what")]),e._v("重写成了"),s("code",[e._v("password=***")])]),e._v(" "),s("h4",{attrs:{id:"_16、savesession-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_16、savesession-gatewayfilter-factory"}},[e._v("#")]),e._v(" 16、SaveSession GatewayFilter Factory")]),e._v(" "),s("p",[e._v("在转发请求之前，强制执行"),s("code",[e._v("WebSession::save")]),e._v("操作，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: save_session\n        uri: https://example.org\n        predicates:\n        - Path=/foo/**\n        filters:\n        - SaveSession\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br")])]),s("p",[e._v("主要用在那种像 Spring Session 延迟数据存储（数据不是立刻持久化）的，并希望在请求转发前确保 session 状态保存情况。如果你将 Spring Secutiry 于 Spring Session 集成使用，并想确保安全信息都传到下游机器，你就需要配置这个 filter。")]),e._v(" "),s("h4",{attrs:{id:"_17、secureheaders-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_17、secureheaders-gatewayfilter-factory"}},[e._v("#")]),e._v(" 17、secureHeaders GatewayFilter Factory")]),e._v(" "),s("p",[e._v("secureHeaders 过滤器工厂主要是参考了"),s("a",{attrs:{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fblog.appcanary.com%2F2017%2Fhttp-security-headers.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("这篇博客"),s("OutboundLink")],1),e._v("中的建议，为原始响应添加了一系列起安全作用的响应头。默认会添加如下 Headers（包括值）：")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("X-Xss-Protection:1; mode=block")])]),e._v(" "),s("li",[s("code",[e._v("Strict-Transport-Security:max-age=631138519")])]),e._v(" "),s("li",[s("code",[e._v("X-Frame-Options:DENY")])]),e._v(" "),s("li",[s("code",[e._v("X-Content-Type-Options:nosniff")])]),e._v(" "),s("li",[s("code",[e._v("Referrer-Policy:no-referrer")])]),e._v(" "),s("li",[s("code",[e._v("Content-Security-Policy:default-src 'self' https:; font-src 'self' https: data:; img-src 'self' https: data:; object-src 'none'; script-src https:; style-src 'self' https: 'unsafe-inline'")])]),e._v(" "),s("li",[s("code",[e._v("X-Download-Options:noopen")])]),e._v(" "),s("li",[s("code",[e._v("X-Permitted-Cross-Domain-Policies:none")])])]),e._v(" "),s("p",[e._v("如果你想修改这些 Header 的值，那么就需要使用这些 Headers 对应的后缀，如下：")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("xss-protection-header")])]),e._v(" "),s("li",[s("code",[e._v("strict-transport-security")])]),e._v(" "),s("li",[s("code",[e._v("frame-options")])]),e._v(" "),s("li",[s("code",[e._v("content-type-options")])]),e._v(" "),s("li",[s("code",[e._v("referrer-policy")])]),e._v(" "),s("li",[s("code",[e._v("content-security-policy")])]),e._v(" "),s("li",[s("code",[e._v("download-options")])]),e._v(" "),s("li",[s("code",[e._v("permitted-cross-domain-policies")])])]),e._v(" "),s("p",[e._v("配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      filter:\n        secure-headers:\n          # 修改 X-Xss-Protection 的值为 2; mode=unblock\n          xss-protection-header: 2; mode=unblock\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br")])]),s("p",[e._v("如果想禁用某些 Header，可使用如下配置：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      filter:\n        secure-headers:\n          # 多个使用逗号（,）分隔\n          disable: frame-options,download-options\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br")])]),s("h4",{attrs:{id:"_18、setpath-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_18、setpath-gatewayfilter-factory"}},[e._v("#")]),e._v(" 18、SetPath GatewayFilter Factory")]),e._v(" "),s("p",[e._v("修改原始的请求路径，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: setpath_route\n        uri: https://example.org\n        predicates:\n        - Path=/foo/{segment}\n        filters:\n        - SetPath=/{segment}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br")])]),s("p",[e._v("该配置使访问 "),s("code",[e._v("${GATEWAY_URL}/foo/bar")]),e._v(" 时会转发到 "),s("code",[e._v("https://example.org/bar")]),e._v(" ，也就是原本的"),s("code",[e._v("/foo/bar")]),e._v("被修改为了"),s("code",[e._v("/bar")])]),e._v(" "),s("h4",{attrs:{id:"_19、setresponseheader-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_19、setresponseheader-gatewayfilter-factory"}},[e._v("#")]),e._v(" 19、SetResponseHeader GatewayFilter Factory")]),e._v(" "),s("p",[e._v("修改原始响应中某个 Header 的值，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: setresponseheader_route\n        uri: https://example.org\n        filters:\n        - SetResponseHeader=X-Response-Foo, Bar\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("p",[e._v("将原始响应中 "),s("code",[e._v("X-Response-Foo")]),e._v(" 的值修改为 "),s("code",[e._v("Bar")])]),e._v(" "),s("h4",{attrs:{id:"_20、setstatus-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_20、setstatus-gatewayfilter-factory"}},[e._v("#")]),e._v(" 20、SetStatus GatewayFilter Factory")]),e._v(" "),s("p",[e._v("修改原始响应的状态码，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: setstatusstring_route\n        uri: https://example.org\n        filters:\n        # 字符串形式\n        - SetStatus=BAD_REQUEST\n      - id: setstatusint_route\n        uri: https://example.org\n        filters:\n        # 数字形式\n        - SetStatus=401\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br")])]),s("p",[e._v("SetStatusd 的值可以是数字，也可以是字符串。但一定要是 Spring "),s("code",[e._v("HttpStatus")]),e._v(" 枚举类中的值。上面这两种配置都可以返回 401 这个 HTTP 状态码。")]),e._v(" "),s("h4",{attrs:{id:"_21、stripprefix-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_21、stripprefix-gatewayfilter-factory"}},[e._v("#")]),e._v(" 21、StripPrefix GatewayFilter Factory")]),e._v(" "),s("p",[e._v("用于截断原始请求的路径，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: nameRoot\n        uri: http://nameservice\n        predicates:\n        - Path=/name/**\n        filters:\n        # 数字表示要截断的路径的数量\n        - StripPrefix=2\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br")])]),s("p",[e._v("如上配置，如果请求的路径为 "),s("code",[e._v("/name/bar/foo")]),e._v(" ，那么则会截断成"),s("code",[e._v("/foo")]),e._v("后进行转发 ，也就是会截断 2 个路径。")]),e._v(" "),s("h4",{attrs:{id:"_22、retry-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_22、retry-gatewayfilter-factory"}},[e._v("#")]),e._v(" 22、Retry GatewayFilter Factory")]),e._v(" "),s("p",[e._v("针对不同的响应进行重试，例如可以针对 HTTP 状态码进行重试，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: retry_test\n        uri: http://localhost:8080/flakey\n        predicates:\n        - Host=*.retry.com\n        filters:\n        - name: Retry\n          args:\n            retries: 3\n            statuses: BAD_GATEWAY\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br")])]),s("p",[e._v("可配置如下参数：")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("retries")]),e._v("：重试次数")]),e._v(" "),s("li",[s("code",[e._v("statuses")]),e._v("：需要重试的状态码，取值在 "),s("code",[e._v("org.springframework.http.HttpStatus")]),e._v(" 中")]),e._v(" "),s("li",[s("code",[e._v("methods")]),e._v("：需要重试的请求方法，取值在 "),s("code",[e._v("org.springframework.http.HttpMethod")]),e._v(" 中")]),e._v(" "),s("li",[s("code",[e._v("series")]),e._v("：HTTP 状态码序列，取值在 "),s("code",[e._v("org.springframework.http.HttpStatus.Series")]),e._v(" 中")])]),e._v(" "),s("h4",{attrs:{id:"_23、requestsize-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_23、requestsize-gatewayfilter-factory"}},[e._v("#")]),e._v(" 23、RequestSize GatewayFilter Factory")]),e._v(" "),s("p",[e._v("设置允许接收最大请求包的大小，配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      routes:\n      - id: request_size_route\n      uri: http://localhost:8080/upload\n      predicates:\n      - Path=/upload\n      filters:\n      - name: RequestSize\n        args:\n          # 单位为字节\n          maxSize: 5000000\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br")])]),s("p",[e._v("如果请求包大小超过设置的值，则会返回 "),s("code",[e._v("413 Payload Too Large")]),e._v("以及一个"),s("code",[e._v("errorMessage")])]),e._v(" "),s("h4",{attrs:{id:"_24、modify-request-body-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_24、modify-request-body-gatewayfilter-factory"}},[e._v("#")]),e._v(" 24、Modify Request Body GatewayFilter Factory")]),e._v(" "),s("p",[e._v("在转发请求之前修改原始请求体内容，该过滤器工厂只能通过代码配置，不支持在配置文件中配置。代码示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('@Bean\npublic RouteLocator routes(RouteLocatorBuilder builder) {\n    return builder.routes()\n        .route("rewrite_request_obj", r -> r.host("*.rewriterequestobj.org")\n            .filters(f -> f.prefixPath("/httpbin")\n                .modifyRequestBody(String.class, Hello.class, MediaType.APPLICATION_JSON_VALUE,\n                    (exchange, s) -> return Mono.just(new Hello(s.toUpperCase())))).uri(uri))\n        .build();\n}\n \nstatic class Hello {\n    String message;\n \n    public Hello() { }\n \n    public Hello(String message) {\n        this.message = message;\n    }\n \n    public String getMessage() {\n        return message;\n    }\n \n    public void setMessage(String message) {\n        this.message = message;\n    }\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br"),s("span",{staticClass:"line-number"},[e._v("27")]),s("br")])]),s("p",[e._v("Tips：该过滤器工厂处于 "),s("strong",[e._v("BETA")]),e._v(" 状态，未来 API 可能会变化，生产环境请慎用")]),e._v(" "),s("h4",{attrs:{id:"_25、modify-response-body-gatewayfilter-factory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_25、modify-response-body-gatewayfilter-factory"}},[e._v("#")]),e._v(" 25、Modify Response Body GatewayFilter Factory")]),e._v(" "),s("p",[e._v("可用于修改原始响应体的内容，该过滤器工厂同样只能通过代码配置，不支持在配置文件中配置。代码示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('@Bean\npublic RouteLocator routes(RouteLocatorBuilder builder) {\n    return builder.routes()\n        .route("rewrite_response_upper", r -> r.host("*.rewriteresponseupper.org")\n            .filters(f -> f.prefixPath("/httpbin")\n                .modifyResponseBody(String.class, String.class,\n                    (exchange, s) -> Mono.just(s.toUpperCase()))).uri(uri)\n        .build();\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("p",[e._v("Tips：该过滤器工厂处于 "),s("strong",[e._v("BETA")]),e._v(" 状态，未来 API 可能会变化，生产环境请慎用")]),e._v(" "),s("h4",{attrs:{id:"_26、default-filters"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_26、default-filters"}},[e._v("#")]),e._v(" 26、Default Filters")]),e._v(" "),s("p",[e._v("Default Filters 用于为所有路由添加过滤器工厂，也就是说通过 Default Filter 所配置的过滤器工厂会作用到所有的路由上。配置示例：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("spring:\n  cloud:\n    gateway:\n      default-filters:\n      - AddResponseHeader=X-Response-Default-Foo, Default-Bar\n      - PrefixPath=/httpbin\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("p",[e._v("官方文档：")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fcloud.spring.io%2Fspring-cloud-static%2Fspring-cloud-gateway%2F2.1.0.RELEASE%2Fsingle%2Fspring-cloud-gateway.html%23_gatewayfilter_factories",target:"_blank",rel:"noopener noreferrer"}},[e._v("GatewayFilter Factories"),s("OutboundLink")],1)])]),e._v(" "),s("p",[e._v("原文："),s("a",{attrs:{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fblog.51cto.com%2Fzero01%2F2430429",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://blog.51cto.com/zero01/2430429"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=r.exports}}]);