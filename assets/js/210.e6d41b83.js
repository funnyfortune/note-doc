(window.webpackJsonp=window.webpackJsonp||[]).push([[210],{538:function(t,r,a){"use strict";a.r(r);var e=a(7),E=Object(e.a)({},(function(){var t=this,r=t._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("p",[t._v("目录")]),t._v(" "),r("p",[r("a",{attrs:{href:"#_1-%E9%85%8D%E7%BD%AE%E6%AD%A5%E9%AA%A4"}},[t._v("1. 配置步骤")])]),t._v(" "),r("p",[r("a",{attrs:{href:"#%E7%AC%AC%E4%B8%80%E6%AD%A5-%E7%94%B3%E8%AF%B7%E5%85%AC%E4%BC%97%E5%8F%B7-%E5%8F%AF%E9%80%89"}},[t._v("第一步，申请公众号（可选）")])]),t._v(" "),r("p",[r("a",{attrs:{href:"#%E7%AC%AC%E4%BA%8C%E6%AD%A5-%E6%B7%BB%E5%8A%A0%E5%85%AC%E4%BC%97%E5%8F%B7%E8%B4%A6%E5%8F%B7"}},[t._v("第二步，添加公众号账号")])]),t._v(" "),r("p",[r("a",{attrs:{href:"#%E7%AC%AC%E4%B8%89%E6%AD%A5-%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%85%A5%E4%BF%A1%E6%81%AF"}},[t._v("第三步，配置接入信息")])]),t._v(" "),r("p",[r("a",{attrs:{href:"#_2-%E5%AE%9E%E7%8E%B0%E4%BB%A3%E7%A0%81"}},[t._v("2. 实现代码")])]),t._v(" "),r("p",[r("a",{attrs:{href:"#_2-1-%E8%A1%A8%E7%BB%93%E6%9E%84"}},[t._v("2.1 表结构")])]),t._v(" "),r("p",[r("a",{attrs:{href:"#_2-2-%E8%B4%A6%E5%8F%B7%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2"}},[t._v("2.2 账号管理界面")])]),t._v(" "),r("p",[r("a",{attrs:{href:"#_2-3-%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%85%A5%E5%9B%9E%E8%B0%83"}},[t._v("2.3 配置接入回调")])]),t._v(" "),r("p",[r("a",{attrs:{href:"#_2-4-%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86"}},[t._v("2.4 消息处理")])]),t._v(" "),r("h1",{attrs:{id:"公众号接入"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#公众号接入"}},[t._v("#")]),t._v(" "),r("img",{attrs:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==",alt:"null"}}),t._v("公众号接入")]),t._v(" "),r("p",[t._v("本章节，讲解如果将你的公众号，接入到系统中。步骤如下：")]),t._v(" "),r("ul",[r("li",[r("p",[t._v("第一步，申请公众号（可选）")])]),t._v(" "),r("li",[r("p",[t._v("第二步，在系统中，添加公众号账号")])]),t._v(" "),r("li",[r("p",[t._v("第三步，在公众号中，配置接入信息")])])]),t._v(" "),r("h2",{attrs:{id:"_1-配置步骤"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置步骤"}},[t._v("#")]),t._v(" 1. 配置步骤")]),t._v(" "),r("p",[t._v("本小节，手把手教你如何将公众号接入到系统中。")]),t._v(" "),r("h3",{attrs:{id:"第一步-申请公众号-可选"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#第一步-申请公众号-可选"}},[t._v("#")]),t._v(" 第一步，申请公众号（可选）")]),t._v(" "),r("div",{staticClass:"custom-block tip"},[r("p",{staticClass:"custom-block-title"},[t._v("友情提示：如果你已经有公众号，可以忽略这一步。")])]),t._v(" "),r("p",[t._v("① 如果你还没有公众号，可以申请一个测试帐号。")]),t._v(" "),r("p",[r("img",{attrs:{src:"/note-doc/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E7%AC%AC%E4%B8%80%E6%AD%A5-%E7%94%B3%E8%AF%B7%E6%B5%8B%E8%AF%95%E5%B8%90%E5%8F%B7.png",alt:"申请测试账号"}})]),t._v(" "),r("p",[t._v("申请地址："),r("a",{attrs:{href:"https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信公众平台接口测试帐号申请 "),r("OutboundLink")],1)]),t._v(" "),r("p",[t._v("② 申请完成后，获得一个测试号。如下图所示：")]),t._v(" "),r("p",[r("img",{attrs:{src:"/note-doc/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E7%AC%AC%E4%B8%80%E6%AD%A5-%E6%B5%8B%E8%AF%95%E8%B4%A6%E5%8F%B7%E4%BF%A1%E6%81%AF.png",alt:"测试账号信息"}})]),t._v(" "),r("h3",{attrs:{id:"第二步-添加公众号账号"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#第二步-添加公众号账号"}},[t._v("#")]),t._v(" 第二步，添加公众号账号")]),t._v(" "),r("p",[t._v("点击 [公众号管理 -> 账号管理] 菜单，添加一个公众号账号。如下图所示：")]),t._v(" "),r("p",[r("img",{attrs:{src:"/note-doc/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E7%AC%AC%E4%BA%8C%E6%AD%A5-%E6%B7%BB%E5%8A%A0%E5%85%AC%E4%BC%97%E5%8F%B7%E8%B4%A6%E5%8F%B7.png",alt:"添加公众号账号"}})]),t._v(" "),r("h3",{attrs:{id:"第三步-配置接入信息"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#第三步-配置接入信息"}},[t._v("#")]),t._v(" 第三步，配置接入信息")]),t._v(" "),r("p",[t._v("① 找一个内网穿透工具，转发到本地的 48080 端口。例如说，"),r("a",{attrs:{href:"https://ngrok.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ngrok "),r("OutboundLink")],1),t._v("、"),r("a",{attrs:{href:"https://github.com/fatedier/frp",target:"_blank",rel:"noopener noreferrer"}},[t._v("frp "),r("OutboundLink")],1),t._v("、"),r("a",{attrs:{href:"https://natapp.cn/",target:"_blank",rel:"noopener noreferrer"}},[t._v("natapa "),r("OutboundLink")],1),t._v(" 等等。")]),t._v(" "),r("p",[t._v("这里，我们使用 natapp 作为内网传统工具。访问 "),r("a",{attrs:{href:"https://natapp.cn/tunnel/buy/free",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://natapp.cn/tunnel/buy/free "),r("OutboundLink")],1),t._v(" 地址，免费购买一个隧道。如下图所示：")]),t._v(" "),r("p",[r("img",{attrs:{src:"/note-doc/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E7%AC%AC%E4%B8%89%E6%AD%A5-%E5%85%8D%E8%B4%B9%E8%B4%AD%E4%B9%B0%E4%B8%80%E4%B8%AA%E9%9A%A7%E9%81%93.png",alt:"免费购买一个隧道"}})]),t._v(" "),r("p",[t._v("② 购买完成后，参考 "),r("a",{attrs:{href:"https://natapp.cn/article/natapp_newbie",target:"_blank",rel:"noopener noreferrer"}},[t._v("《NATAPP 1 分钟快速新手图文教程》 "),r("OutboundLink")],1),t._v(" 文档，将 natapp 进行启动。如下图所示：")]),t._v(" "),r("p",[r("img",{attrs:{src:"/note-doc/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E7%AC%AC%E4%B8%89%E6%AD%A5-%E5%90%AF%E5%8A%A8%E9%9A%A7%E9%81%93.png",alt:"启动隧道"}})]),t._v(" "),r("p",[t._v("③ 打开微信公众号界面，填写 URL 和 Token 信息。如下图所示：")]),t._v(" "),r("p",[r("img",{attrs:{src:"/note-doc/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E7%AC%AC%E4%B8%89%E6%AD%A5-%E5%A1%AB%E5%86%99URL%E5%92%8CToken.png",alt:"填写 URL 和 Token 信息"}})]),t._v(" "),r("p",[t._v("点击提交后，看到“配置成功”提示，说明配置成功。")]),t._v(" "),r("h2",{attrs:{id:"_2-实现代码"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-实现代码"}},[t._v("#")]),t._v(" 2. 实现代码")]),t._v(" "),r("p",[t._v("本小节，将介绍如何实现公众号接入的代码。")]),t._v(" "),r("h3",{attrs:{id:"_2-1-表结构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-表结构"}},[t._v("#")]),t._v(" 2.1 表结构")]),t._v(" "),r("p",[t._v("公众号账号对应  "),r("code",[t._v("mp_account")]),t._v("  表，结构如下图所示：")]),t._v(" "),r("p",[r("img",{attrs:{src:"/note-doc/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E8%A1%A8%E7%BB%93%E6%9E%84.png",alt:"表结构"}})]),t._v(" "),r("h3",{attrs:{id:"_2-2-账号管理界面"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-账号管理界面"}},[t._v("#")]),t._v(" 2.2 账号管理界面")]),t._v(" "),r("ul",[r("li",[r("p",[t._v("前端："),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-ui-admin/src/views/mp/account/index.vue",target:"_blank",rel:"noopener noreferrer"}},[t._v("/@views/mp/account "),r("OutboundLink")],1)])]),t._v(" "),r("li",[r("p",[t._v("后端："),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/controller/admin/account/MpAccountController.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("MpAccountController "),r("OutboundLink")],1)])])]),t._v(" "),r("h3",{attrs:{id:"_2-3-配置接入回调"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-配置接入回调"}},[t._v("#")]),t._v(" 2.3 配置接入回调")]),t._v(" "),r("p",[t._v("在 "),r("a",{attrs:{href:"#%E7%AC%AC%E4%B8%89%E6%AD%A5-%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%85%A5%E4%BF%A1%E6%81%AF"}},[t._v("第三步，配置接入信息")]),t._v(" 时，微信公众号会回调系统的  "),r("code",[t._v("GET /admin-api/mp/open/{appID}")]),t._v("  接口，进行接入配置的验证。对应 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/controller/admin/open/MpOpenController.java#L39-L57",target:"_blank",rel:"noopener noreferrer"}},[t._v("MpOpenController "),r("OutboundLink")],1),t._v(" 类的  "),r("code",[t._v("checkSignature")]),t._v("  方法，如下图所示：")]),t._v(" "),r("p",[r("img",{attrs:{src:"/note-doc/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%85%A5%E5%9B%9E%E8%B0%83.png",alt:"checkSignature 方法"}})]),t._v(" "),r("p",[t._v("对应 "),r("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/Basic_Information/Access_Overview.html#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E9%AA%8C%E8%AF%81%E6%B6%88%E6%81%AF%E7%9A%84%E7%A1%AE%E6%9D%A5%E8%87%AA%E5%BE%AE%E4%BF%A1%E6%9C%8D%E5%8A%A1%E5%99%A8",target:"_blank",rel:"noopener noreferrer"}},[t._v("《微信公众号官方文档 —— 接入指南》 "),r("OutboundLink")],1),t._v(" 文档。")]),t._v(" "),r("div",{staticClass:"custom-block tip"},[r("p",{staticClass:"custom-block-title"},[t._v("友情提示：")]),t._v(" "),r("p",[t._v("项目使用的微信工具开发包是 "),r("a",{attrs:{href:"https://github.com/Wechat-Group/WxJava/tree/develop/weixin-java-mp",target:"_blank",rel:"noopener noreferrer"}},[t._v("weixin-java-mp "),r("OutboundLink")],1),t._v("，超级好用！")])]),t._v(" "),r("h3",{attrs:{id:"_2-4-消息处理"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-消息处理"}},[t._v("#")]),t._v(" 2.4 消息处理")]),t._v(" "),r("p",[t._v("配置接入完成后，用户发给公众号的消息，公众号都会回调到  "),r("code",[t._v("POST /admin-api/mp/open/{appID}")]),t._v("  接口，进行消息的处理。对应 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/controller/admin/open/MpOpenController.java#L59-L114",target:"_blank",rel:"noopener noreferrer"}},[t._v("MpOpenController "),r("OutboundLink")],1),t._v(" 类的  "),r("code",[t._v("handleMessage")]),t._v("  方法，如下图所示：")]),t._v(" "),r("p",[r("img",{attrs:{src:"/note-doc/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86.png",alt:"handleMessage 方法"}})]),t._v(" "),r("p",[t._v("核心逻辑是第二步，再解析到消息后，交给 WxMpMessageRouter 进行消息的处理。WxMpMessageRouter 在 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/controller/admin/open/MpOpenController.java#L59-L114",target:"_blank",rel:"noopener noreferrer"}},[t._v("DefaultMpServiceFactory "),r("OutboundLink")],1),t._v(" 初始化，设置每种消息对应的 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/service/handler/",target:"_blank",rel:"noopener noreferrer"}},[t._v("handler "),r("OutboundLink")],1),t._v(" 处理器。如下图所示：")]),t._v(" "),r("p",[r("img",{attrs:{src:"/note-doc/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86%E5%99%A8.png",alt:"消息处理器"}})]),t._v(" "),r("p",[t._v("具体每个处理器的实现，后续每个章节单独详细讲解。")])])}),[],!1,null,null,null);r.default=E.exports}}]);