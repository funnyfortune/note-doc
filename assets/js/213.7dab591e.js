(window.webpackJsonp=window.webpackJsonp||[]).push([[213],{541:function(e,a,r){"use strict";r.r(a);var t=r(7),s=Object(t.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("p",[e._v("目录")]),e._v(" "),a("p",[a("a",{attrs:{href:"#_1-%E8%A1%A8%E7%BB%93%E6%9E%84"}},[e._v("1. 表结构")])]),e._v(" "),a("p",[a("a",{attrs:{href:"#_2-%E6%B6%88%E6%81%AF%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2"}},[e._v("2. 消息管理界面")])]),e._v(" "),a("p",[a("a",{attrs:{href:"#_3-%E3%80%90%E6%8E%A5%E6%94%B6%E3%80%91"}},[e._v("3.【接收】")])]),e._v(" "),a("p",[a("a",{attrs:{href:"#_3-1-%E6%8E%A5%E6%94%B6%E6%99%AE%E9%80%9A%E6%B6%88%E6%81%AF"}},[e._v("3.1 接收普通消息")])]),e._v(" "),a("p",[a("a",{attrs:{href:"#_3-2-%E6%8E%A5%E6%94%B6%E4%BA%8B%E4%BB%B6%E6%B6%88%E6%81%AF"}},[e._v("3.2 接收事件消息")])]),e._v(" "),a("p",[a("a",{attrs:{href:"#_4-%E3%80%90%E5%8F%91%E9%80%81%E3%80%91"}},[e._v("4.【发送】")])]),e._v(" "),a("p",[a("a",{attrs:{href:"#_4-1-%E8%A2%AB%E5%8A%A8%E5%9B%9E%E5%A4%8D%E7%94%A8%E6%88%B7%E6%B6%88%E6%81%AF"}},[e._v("4.1 被动回复用户消息")])]),e._v(" "),a("p",[a("a",{attrs:{href:"#_4-2-%E4%B8%BB%E5%8A%A8%E5%8F%91%E9%80%81%E5%AE%A2%E6%9C%8D%E6%B6%88%E6%81%AF"}},[e._v("4.2 主动发送客服消息")])]),e._v(" "),a("h1",{attrs:{id:"公众号消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#公众号消息"}},[e._v("#")]),e._v(" "),a("img",{attrs:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==",alt:"null"}}),e._v("公众号消息")]),e._v(" "),a("p",[e._v("本章节，讲解公众号消息的相关内容，对应 [公众号管理 -> 消息管理] 菜单。如下图所示：")]),e._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B6%88%E6%81%AF/%E7%95%8C%E9%9D%A2.png",alt:"消息管理"}})]),e._v(" "),a("h2",{attrs:{id:"_1-表结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-表结构"}},[e._v("#")]),e._v(" 1. 表结构")]),e._v(" "),a("p",[e._v("公众号消息对应  "),a("code",[e._v("mp_message")]),e._v("  表，结构如下图所示：")]),e._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B6%88%E6%81%AF/%E8%A1%A8%E7%BB%93%E6%9E%84.png",alt:"表结构"}})]),e._v(" "),a("p",[e._v("①  "),a("code",[e._v("type")]),e._v("  字段：消息类型，包括文本、图片、语音、视频、小视频、图文、音乐、地理位置、链接、事件等类型，对应  "),a("code",[e._v("mp_message_type")]),e._v("  字典。")]),e._v(" "),a("p",[e._v("②  "),a("code",[e._v("send_from")]),e._v("  字段：消息发送方，分成两类：")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("【接收】用户发送给公众号："),a("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Receiving_standard_messages.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("接收普通消息 "),a("OutboundLink")],1),e._v("、"),a("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Receiving_event_pushes.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("接收事件推送 "),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[e._v("【发送】公众号发给用户："),a("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Passive_user_reply_message.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("被动回复用户消息 "),a("OutboundLink")],1),e._v("、"),a("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Service_Center_messages.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("客服消息 "),a("OutboundLink")],1)])])]),e._v(" "),a("h2",{attrs:{id:"_2-消息管理界面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-消息管理界面"}},[e._v("#")]),e._v(" 2. 消息管理界面")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("前端："),a("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-ui-admin/src/views/mp/message/index.vue",target:"_blank",rel:"noopener noreferrer"}},[e._v("/@views/mp/message "),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[e._v("后端："),a("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/controller/admin/message/MpMessageController.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("MpMessageController "),a("OutboundLink")],1)])])]),e._v(" "),a("h2",{attrs:{id:"_3-【接收】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-【接收】"}},[e._v("#")]),e._v(" 3.【接收】")]),e._v(" "),a("h3",{attrs:{id:"_3-1-接收普通消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-接收普通消息"}},[e._v("#")]),e._v(" 3.1 接收普通消息")]),e._v(" "),a("blockquote",[a("p",[e._v("对应 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Receiving_standard_messages.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("《微信公众号官方文档 —— 接收普通消息》 "),a("OutboundLink")],1),e._v(" 文档。")])]),e._v(" "),a("p",[e._v("当用户向公众账号发消息时，会被 "),a("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/service/handler/message/MessageReceiveHandler.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("MessageReceiveHandler "),a("OutboundLink")],1),e._v(" 处理，记录到  "),a("code",[e._v("mp_message")]),e._v("  表，消息类型为文本、图片、语音、视频、小视频、地理位置、链接。如下图所示：")]),e._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B6%88%E6%81%AF/%E6%8E%A5%E6%94%B6%E6%99%AE%E9%80%9A%E6%B6%88%E6%81%AF.png",alt:"接收普通消息"}})]),e._v(" "),a("h3",{attrs:{id:"_3-2-接收事件消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-接收事件消息"}},[e._v("#")]),e._v(" 3.2 接收事件消息")]),e._v(" "),a("blockquote",[a("p",[e._v("对应 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Receiving_event_pushes.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("《微信公众号官方文档 —— 接收事件推送》 "),a("OutboundLink")],1),e._v(" 文档。")])]),e._v(" "),a("p",[e._v("在用户和公众号产交互的过程中，会被 "),a("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/service/handler/message/MessageReceiveHandler.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("MessageReceiveHandler "),a("OutboundLink")],1),e._v(" 处理，记录到  "),a("code",[e._v("mp_message")]),e._v("  表，消息类型仅为事件。")]),e._v(" "),a("h2",{attrs:{id:"_4-【发送】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-【发送】"}},[e._v("#")]),e._v(" 4.【发送】")]),e._v(" "),a("h3",{attrs:{id:"_4-1-被动回复用户消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-被动回复用户消息"}},[e._v("#")]),e._v(" 4.1 被动回复用户消息")]),e._v(" "),a("blockquote",[a("p",[e._v("对应 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Passive_user_reply_message.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("《微信公众号官方文档 —— 被动回复用户消息》 "),a("OutboundLink")],1),e._v(" 文档。")])]),e._v(" "),a("p",[e._v("在被动回复用户消息时，统一由 "),a("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/service/message/MpMessageServiceImpl.java#L85-L104",target:"_blank",rel:"noopener noreferrer"}},[e._v("MpMessageServiceImpl "),a("OutboundLink")],1),e._v(" 的  "),a("code",[e._v("sendOutMessage")]),e._v("  方法来构建回复消息，也会记录到  "),a("code",[e._v("mp_message")]),e._v("  表，消息类型为文本、图片、语音、视频、音乐、图文。如下图所示：")]),e._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B6%88%E6%81%AF/%E8%A2%AB%E5%8A%A8%E5%9B%9E%E5%A4%8D%E7%94%A8%E6%88%B7%E6%B6%88%E6%81%AF.png",alt:"被动回复用户消息"}})]),e._v(" "),a("h3",{attrs:{id:"_4-2-主动发送客服消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-主动发送客服消息"}},[e._v("#")]),e._v(" 4.2 主动发送客服消息")]),e._v(" "),a("blockquote",[a("p",[e._v("对应 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Service_Center_messages.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("《微信公众号官方文档 —— 客服消息》 "),a("OutboundLink")],1),e._v(" 文档。")])]),e._v(" "),a("p",[e._v("点击消息管理界面的【消息】按钮，可以主动发送客服消息给用户。如下图所示：")]),e._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B6%88%E6%81%AF/%E4%B8%BB%E5%8A%A8%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E7%BB%99%E7%94%A8%E6%88%B7.png",alt:"主动发送消息给用户"}})]),e._v(" "),a("p",[e._v("主动发送客服消息，统一由 "),a("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/service/message/MpMessageServiceImpl.java#L106-L130",target:"_blank",rel:"noopener noreferrer"}},[e._v("MpMessageServiceImpl "),a("OutboundLink")],1),e._v(" 的  "),a("code",[e._v("sendKefuMessage")]),e._v("  方法来构建客服消息，也会记录到  "),a("code",[e._v("mp_message")]),e._v("  表，消息类型为文本、图片、语音、视频、音乐、图文。如下图所示：")]),e._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%B6%88%E6%81%AF/%E5%AE%A2%E6%9C%8D%E6%B6%88%E6%81%AF.png",alt:"客服消息"}})])])}),[],!1,null,null,null);a.default=s.exports}}]);