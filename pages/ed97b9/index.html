<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>分库分表 | X_SaaS快速开发平台</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/note-doc/img/favicon.ico">
    <meta name="description" content="基于spring cloud alibaba 微服务搭建的快速开发平台">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#fff">
    
    <link rel="preload" href="/note-doc/assets/css/0.styles.e218e477.css" as="style"><link rel="preload" href="/note-doc/assets/js/app.76332d15.js" as="script"><link rel="preload" href="/note-doc/assets/js/2.d14532d0.js" as="script"><link rel="preload" href="/note-doc/assets/js/100.e8f88cce.js" as="script"><link rel="prefetch" href="/note-doc/assets/js/10.4a1253f5.js"><link rel="prefetch" href="/note-doc/assets/js/101.43cf0cee.js"><link rel="prefetch" href="/note-doc/assets/js/102.ae5a8844.js"><link rel="prefetch" href="/note-doc/assets/js/103.f949e820.js"><link rel="prefetch" href="/note-doc/assets/js/104.16a83917.js"><link rel="prefetch" href="/note-doc/assets/js/105.1c7f3fbf.js"><link rel="prefetch" href="/note-doc/assets/js/106.14d552fa.js"><link rel="prefetch" href="/note-doc/assets/js/107.4d8041b4.js"><link rel="prefetch" href="/note-doc/assets/js/108.5584984e.js"><link rel="prefetch" href="/note-doc/assets/js/109.11719334.js"><link rel="prefetch" href="/note-doc/assets/js/11.9fe2c6c8.js"><link rel="prefetch" href="/note-doc/assets/js/110.e51f099f.js"><link rel="prefetch" href="/note-doc/assets/js/111.7c84461a.js"><link rel="prefetch" href="/note-doc/assets/js/112.f6fdcd02.js"><link rel="prefetch" href="/note-doc/assets/js/113.906e4a8c.js"><link rel="prefetch" href="/note-doc/assets/js/114.f1d9c373.js"><link rel="prefetch" href="/note-doc/assets/js/115.2dc9b3ac.js"><link rel="prefetch" href="/note-doc/assets/js/116.2ddd88ba.js"><link rel="prefetch" href="/note-doc/assets/js/117.380428a6.js"><link rel="prefetch" href="/note-doc/assets/js/118.481d2ea8.js"><link rel="prefetch" href="/note-doc/assets/js/119.3d62f8a2.js"><link rel="prefetch" href="/note-doc/assets/js/12.c12df886.js"><link rel="prefetch" href="/note-doc/assets/js/120.44c7ce6b.js"><link rel="prefetch" href="/note-doc/assets/js/121.d8a9b15c.js"><link rel="prefetch" href="/note-doc/assets/js/122.6f8f4774.js"><link rel="prefetch" href="/note-doc/assets/js/123.300d72d9.js"><link rel="prefetch" href="/note-doc/assets/js/124.79ade574.js"><link rel="prefetch" href="/note-doc/assets/js/125.bd7db387.js"><link rel="prefetch" href="/note-doc/assets/js/126.e3f9929f.js"><link rel="prefetch" href="/note-doc/assets/js/127.08879315.js"><link rel="prefetch" href="/note-doc/assets/js/128.bf7740a9.js"><link rel="prefetch" href="/note-doc/assets/js/129.cdb8f0c0.js"><link rel="prefetch" href="/note-doc/assets/js/13.5b82ae54.js"><link rel="prefetch" href="/note-doc/assets/js/130.62762a89.js"><link rel="prefetch" href="/note-doc/assets/js/131.54d2a475.js"><link rel="prefetch" href="/note-doc/assets/js/132.f4dbef93.js"><link rel="prefetch" href="/note-doc/assets/js/133.26fde23c.js"><link rel="prefetch" href="/note-doc/assets/js/134.e0d4ef0a.js"><link rel="prefetch" href="/note-doc/assets/js/135.6d0c8d0e.js"><link rel="prefetch" href="/note-doc/assets/js/136.b3f7a6f4.js"><link rel="prefetch" href="/note-doc/assets/js/137.e7f859a3.js"><link rel="prefetch" href="/note-doc/assets/js/138.4c8942f0.js"><link rel="prefetch" href="/note-doc/assets/js/139.bc84f2c5.js"><link rel="prefetch" href="/note-doc/assets/js/14.382aab7c.js"><link rel="prefetch" href="/note-doc/assets/js/140.854a3328.js"><link rel="prefetch" href="/note-doc/assets/js/141.9b94e52a.js"><link rel="prefetch" href="/note-doc/assets/js/142.1adb2e6d.js"><link rel="prefetch" href="/note-doc/assets/js/143.7fa13808.js"><link rel="prefetch" href="/note-doc/assets/js/144.535da3fa.js"><link rel="prefetch" href="/note-doc/assets/js/145.5fb54ac0.js"><link rel="prefetch" href="/note-doc/assets/js/146.69f6c252.js"><link rel="prefetch" href="/note-doc/assets/js/147.5f74062e.js"><link rel="prefetch" href="/note-doc/assets/js/148.bb1d6f22.js"><link rel="prefetch" href="/note-doc/assets/js/149.a03c75d7.js"><link rel="prefetch" href="/note-doc/assets/js/15.0ae18e8f.js"><link rel="prefetch" href="/note-doc/assets/js/150.e1548ae9.js"><link rel="prefetch" href="/note-doc/assets/js/151.70484961.js"><link rel="prefetch" href="/note-doc/assets/js/152.b15d460d.js"><link rel="prefetch" href="/note-doc/assets/js/153.005375d7.js"><link rel="prefetch" href="/note-doc/assets/js/154.34677e07.js"><link rel="prefetch" href="/note-doc/assets/js/155.636544c6.js"><link rel="prefetch" href="/note-doc/assets/js/156.b5037bbc.js"><link rel="prefetch" href="/note-doc/assets/js/157.3c258e80.js"><link rel="prefetch" href="/note-doc/assets/js/158.78bbb53f.js"><link rel="prefetch" href="/note-doc/assets/js/159.8a93e619.js"><link rel="prefetch" href="/note-doc/assets/js/16.7e2aa4bf.js"><link rel="prefetch" href="/note-doc/assets/js/160.2c934ac6.js"><link rel="prefetch" href="/note-doc/assets/js/161.dbb23b15.js"><link rel="prefetch" href="/note-doc/assets/js/162.c399b76f.js"><link rel="prefetch" href="/note-doc/assets/js/163.74983364.js"><link rel="prefetch" href="/note-doc/assets/js/164.2e19ec09.js"><link rel="prefetch" href="/note-doc/assets/js/165.00161650.js"><link rel="prefetch" href="/note-doc/assets/js/166.a3c41859.js"><link rel="prefetch" href="/note-doc/assets/js/167.782cad13.js"><link rel="prefetch" href="/note-doc/assets/js/168.47982a5a.js"><link rel="prefetch" href="/note-doc/assets/js/169.d34dc5e3.js"><link rel="prefetch" href="/note-doc/assets/js/17.e6616b94.js"><link rel="prefetch" href="/note-doc/assets/js/170.cb53876f.js"><link rel="prefetch" href="/note-doc/assets/js/171.bbb5cb68.js"><link rel="prefetch" href="/note-doc/assets/js/172.526520ee.js"><link rel="prefetch" href="/note-doc/assets/js/173.e71d6530.js"><link rel="prefetch" href="/note-doc/assets/js/174.7134b9ad.js"><link rel="prefetch" href="/note-doc/assets/js/175.aa6747bb.js"><link rel="prefetch" href="/note-doc/assets/js/176.30a5f341.js"><link rel="prefetch" href="/note-doc/assets/js/177.290f2970.js"><link rel="prefetch" href="/note-doc/assets/js/178.c36eb04f.js"><link rel="prefetch" href="/note-doc/assets/js/179.fbc03d2d.js"><link rel="prefetch" href="/note-doc/assets/js/18.9b0b2f8b.js"><link rel="prefetch" href="/note-doc/assets/js/180.fac524ee.js"><link rel="prefetch" href="/note-doc/assets/js/181.150657b4.js"><link rel="prefetch" href="/note-doc/assets/js/182.26842501.js"><link rel="prefetch" href="/note-doc/assets/js/183.7c58c336.js"><link rel="prefetch" href="/note-doc/assets/js/184.076fbf1d.js"><link rel="prefetch" href="/note-doc/assets/js/185.c83d1552.js"><link rel="prefetch" href="/note-doc/assets/js/186.3e1b1268.js"><link rel="prefetch" href="/note-doc/assets/js/187.df3ea268.js"><link rel="prefetch" href="/note-doc/assets/js/188.56b22a6e.js"><link rel="prefetch" href="/note-doc/assets/js/189.60820431.js"><link rel="prefetch" href="/note-doc/assets/js/19.7935d160.js"><link rel="prefetch" href="/note-doc/assets/js/190.006cecf4.js"><link rel="prefetch" href="/note-doc/assets/js/191.3f110afc.js"><link rel="prefetch" href="/note-doc/assets/js/192.86afc19e.js"><link rel="prefetch" href="/note-doc/assets/js/193.3b3488ac.js"><link rel="prefetch" href="/note-doc/assets/js/194.746e2381.js"><link rel="prefetch" href="/note-doc/assets/js/195.6135607b.js"><link rel="prefetch" href="/note-doc/assets/js/196.d9030c68.js"><link rel="prefetch" href="/note-doc/assets/js/197.6d42af88.js"><link rel="prefetch" href="/note-doc/assets/js/198.db22e83e.js"><link rel="prefetch" href="/note-doc/assets/js/199.43c5b85f.js"><link rel="prefetch" href="/note-doc/assets/js/20.ad58bbfd.js"><link rel="prefetch" href="/note-doc/assets/js/200.843aa803.js"><link rel="prefetch" href="/note-doc/assets/js/201.51d52d1e.js"><link rel="prefetch" href="/note-doc/assets/js/202.6fe650ff.js"><link rel="prefetch" href="/note-doc/assets/js/203.e78af7ea.js"><link rel="prefetch" href="/note-doc/assets/js/204.c88e6e9b.js"><link rel="prefetch" href="/note-doc/assets/js/205.fd4b1455.js"><link rel="prefetch" href="/note-doc/assets/js/206.a74c0b9e.js"><link rel="prefetch" href="/note-doc/assets/js/207.f2c583d5.js"><link rel="prefetch" href="/note-doc/assets/js/208.685a1d56.js"><link rel="prefetch" href="/note-doc/assets/js/209.43764a0d.js"><link rel="prefetch" href="/note-doc/assets/js/21.d3202235.js"><link rel="prefetch" href="/note-doc/assets/js/210.92373eef.js"><link rel="prefetch" href="/note-doc/assets/js/211.4234e66a.js"><link rel="prefetch" href="/note-doc/assets/js/212.a32ea32f.js"><link rel="prefetch" href="/note-doc/assets/js/213.fb3e37df.js"><link rel="prefetch" href="/note-doc/assets/js/214.135cf65c.js"><link rel="prefetch" href="/note-doc/assets/js/215.a724528f.js"><link rel="prefetch" href="/note-doc/assets/js/216.e7cfb9da.js"><link rel="prefetch" href="/note-doc/assets/js/217.201a0533.js"><link rel="prefetch" href="/note-doc/assets/js/218.e4945620.js"><link rel="prefetch" href="/note-doc/assets/js/219.b87d6cbe.js"><link rel="prefetch" href="/note-doc/assets/js/22.6ea51e22.js"><link rel="prefetch" href="/note-doc/assets/js/220.4e1b65e5.js"><link rel="prefetch" href="/note-doc/assets/js/221.910037e9.js"><link rel="prefetch" href="/note-doc/assets/js/222.49ceb42d.js"><link rel="prefetch" href="/note-doc/assets/js/223.0b430e81.js"><link rel="prefetch" href="/note-doc/assets/js/224.48a29322.js"><link rel="prefetch" href="/note-doc/assets/js/225.094345b0.js"><link rel="prefetch" href="/note-doc/assets/js/226.760a3d51.js"><link rel="prefetch" href="/note-doc/assets/js/227.bd3be95e.js"><link rel="prefetch" href="/note-doc/assets/js/228.8b93b711.js"><link rel="prefetch" href="/note-doc/assets/js/229.3bece87b.js"><link rel="prefetch" href="/note-doc/assets/js/23.c3a283df.js"><link rel="prefetch" href="/note-doc/assets/js/230.49456b2e.js"><link rel="prefetch" href="/note-doc/assets/js/231.4cd0f3f0.js"><link rel="prefetch" href="/note-doc/assets/js/232.184f34c0.js"><link rel="prefetch" href="/note-doc/assets/js/233.11dbe871.js"><link rel="prefetch" href="/note-doc/assets/js/234.10817397.js"><link rel="prefetch" href="/note-doc/assets/js/235.c965f1c9.js"><link rel="prefetch" href="/note-doc/assets/js/236.d5d78375.js"><link rel="prefetch" href="/note-doc/assets/js/237.126e7b9d.js"><link rel="prefetch" href="/note-doc/assets/js/238.794a6bec.js"><link rel="prefetch" href="/note-doc/assets/js/239.d68e9afd.js"><link rel="prefetch" href="/note-doc/assets/js/24.973d6289.js"><link rel="prefetch" href="/note-doc/assets/js/240.96291bc7.js"><link rel="prefetch" href="/note-doc/assets/js/241.7e8b42c3.js"><link rel="prefetch" href="/note-doc/assets/js/242.21cd82e8.js"><link rel="prefetch" href="/note-doc/assets/js/243.a0ca74fd.js"><link rel="prefetch" href="/note-doc/assets/js/244.07864beb.js"><link rel="prefetch" href="/note-doc/assets/js/245.33585880.js"><link rel="prefetch" href="/note-doc/assets/js/246.41f927ac.js"><link rel="prefetch" href="/note-doc/assets/js/247.f7165346.js"><link rel="prefetch" href="/note-doc/assets/js/248.e8843359.js"><link rel="prefetch" href="/note-doc/assets/js/249.810213a1.js"><link rel="prefetch" href="/note-doc/assets/js/25.9552261a.js"><link rel="prefetch" href="/note-doc/assets/js/250.05c4d767.js"><link rel="prefetch" href="/note-doc/assets/js/251.f863128d.js"><link rel="prefetch" href="/note-doc/assets/js/252.977a9f7e.js"><link rel="prefetch" href="/note-doc/assets/js/253.7d2a7564.js"><link rel="prefetch" href="/note-doc/assets/js/254.d62d430a.js"><link rel="prefetch" href="/note-doc/assets/js/255.dda088c4.js"><link rel="prefetch" href="/note-doc/assets/js/256.b7fd5feb.js"><link rel="prefetch" href="/note-doc/assets/js/257.72208a6a.js"><link rel="prefetch" href="/note-doc/assets/js/258.c8c6d676.js"><link rel="prefetch" href="/note-doc/assets/js/259.552f6359.js"><link rel="prefetch" href="/note-doc/assets/js/26.5191e482.js"><link rel="prefetch" href="/note-doc/assets/js/260.6fcf6d84.js"><link rel="prefetch" href="/note-doc/assets/js/261.5620800a.js"><link rel="prefetch" href="/note-doc/assets/js/262.92e0da04.js"><link rel="prefetch" href="/note-doc/assets/js/263.72bd99f7.js"><link rel="prefetch" href="/note-doc/assets/js/264.8ddf21cb.js"><link rel="prefetch" href="/note-doc/assets/js/265.369c5c77.js"><link rel="prefetch" href="/note-doc/assets/js/266.6647e67b.js"><link rel="prefetch" href="/note-doc/assets/js/267.17857a80.js"><link rel="prefetch" href="/note-doc/assets/js/268.32ada997.js"><link rel="prefetch" href="/note-doc/assets/js/269.c6270fcb.js"><link rel="prefetch" href="/note-doc/assets/js/27.267ea29d.js"><link rel="prefetch" href="/note-doc/assets/js/270.44b8acab.js"><link rel="prefetch" href="/note-doc/assets/js/271.f5a82250.js"><link rel="prefetch" href="/note-doc/assets/js/272.79454d5b.js"><link rel="prefetch" href="/note-doc/assets/js/273.92141531.js"><link rel="prefetch" href="/note-doc/assets/js/274.e802e6d2.js"><link rel="prefetch" href="/note-doc/assets/js/275.c91e2ac0.js"><link rel="prefetch" href="/note-doc/assets/js/276.bedfd0d0.js"><link rel="prefetch" href="/note-doc/assets/js/277.21dbe71d.js"><link rel="prefetch" href="/note-doc/assets/js/278.62d03c1f.js"><link rel="prefetch" href="/note-doc/assets/js/279.da68c9dd.js"><link rel="prefetch" href="/note-doc/assets/js/28.4a260fbf.js"><link rel="prefetch" href="/note-doc/assets/js/280.47cca433.js"><link rel="prefetch" href="/note-doc/assets/js/281.4da65068.js"><link rel="prefetch" href="/note-doc/assets/js/282.4ed8673c.js"><link rel="prefetch" href="/note-doc/assets/js/283.f115ab1a.js"><link rel="prefetch" href="/note-doc/assets/js/284.7f0e686e.js"><link rel="prefetch" href="/note-doc/assets/js/285.1e9f2326.js"><link rel="prefetch" href="/note-doc/assets/js/286.a4924dc6.js"><link rel="prefetch" href="/note-doc/assets/js/287.405d42a5.js"><link rel="prefetch" href="/note-doc/assets/js/288.c9bc8921.js"><link rel="prefetch" href="/note-doc/assets/js/289.05f709a3.js"><link rel="prefetch" href="/note-doc/assets/js/29.b32b7da0.js"><link rel="prefetch" href="/note-doc/assets/js/290.c4db0ec7.js"><link rel="prefetch" href="/note-doc/assets/js/291.641e1515.js"><link rel="prefetch" href="/note-doc/assets/js/292.c43a5f48.js"><link rel="prefetch" href="/note-doc/assets/js/293.84838063.js"><link rel="prefetch" href="/note-doc/assets/js/294.9103fe0c.js"><link rel="prefetch" href="/note-doc/assets/js/295.b14927dc.js"><link rel="prefetch" href="/note-doc/assets/js/296.4632845c.js"><link rel="prefetch" href="/note-doc/assets/js/297.f4a53537.js"><link rel="prefetch" href="/note-doc/assets/js/298.85d0ca45.js"><link rel="prefetch" href="/note-doc/assets/js/299.257c8648.js"><link rel="prefetch" href="/note-doc/assets/js/3.b56b3350.js"><link rel="prefetch" href="/note-doc/assets/js/30.f1ff9e23.js"><link rel="prefetch" href="/note-doc/assets/js/300.95ce3dd3.js"><link rel="prefetch" href="/note-doc/assets/js/301.863b90b9.js"><link rel="prefetch" href="/note-doc/assets/js/302.0f2fbb3d.js"><link rel="prefetch" href="/note-doc/assets/js/303.56c82540.js"><link rel="prefetch" href="/note-doc/assets/js/304.0b148e1e.js"><link rel="prefetch" href="/note-doc/assets/js/305.8fc16165.js"><link rel="prefetch" href="/note-doc/assets/js/306.5d736330.js"><link rel="prefetch" href="/note-doc/assets/js/307.5fd737da.js"><link rel="prefetch" href="/note-doc/assets/js/308.1d340421.js"><link rel="prefetch" href="/note-doc/assets/js/309.9daaec86.js"><link rel="prefetch" href="/note-doc/assets/js/31.249e7cbe.js"><link rel="prefetch" href="/note-doc/assets/js/310.60340d22.js"><link rel="prefetch" href="/note-doc/assets/js/311.d57a2e0b.js"><link rel="prefetch" href="/note-doc/assets/js/312.fa9fc596.js"><link rel="prefetch" href="/note-doc/assets/js/313.2222a426.js"><link rel="prefetch" href="/note-doc/assets/js/314.0fd8192d.js"><link rel="prefetch" href="/note-doc/assets/js/315.3a7fe6f3.js"><link rel="prefetch" href="/note-doc/assets/js/316.66a4ff6f.js"><link rel="prefetch" href="/note-doc/assets/js/317.40f68969.js"><link rel="prefetch" href="/note-doc/assets/js/318.e8fe1692.js"><link rel="prefetch" href="/note-doc/assets/js/319.1e0f6a8b.js"><link rel="prefetch" href="/note-doc/assets/js/32.ac2b64f0.js"><link rel="prefetch" href="/note-doc/assets/js/320.f8a8f2c6.js"><link rel="prefetch" href="/note-doc/assets/js/321.5ed4bbbd.js"><link rel="prefetch" href="/note-doc/assets/js/322.8cedc046.js"><link rel="prefetch" href="/note-doc/assets/js/323.8b5884e5.js"><link rel="prefetch" href="/note-doc/assets/js/324.6478ecbf.js"><link rel="prefetch" href="/note-doc/assets/js/325.d1695391.js"><link rel="prefetch" href="/note-doc/assets/js/326.57dd4340.js"><link rel="prefetch" href="/note-doc/assets/js/327.67a21f9b.js"><link rel="prefetch" href="/note-doc/assets/js/328.79d896d2.js"><link rel="prefetch" href="/note-doc/assets/js/329.3c6da537.js"><link rel="prefetch" href="/note-doc/assets/js/33.6966d67c.js"><link rel="prefetch" href="/note-doc/assets/js/330.46132a95.js"><link rel="prefetch" href="/note-doc/assets/js/331.f1a34587.js"><link rel="prefetch" href="/note-doc/assets/js/332.6128360f.js"><link rel="prefetch" href="/note-doc/assets/js/333.1efa2476.js"><link rel="prefetch" href="/note-doc/assets/js/334.c6f577cb.js"><link rel="prefetch" href="/note-doc/assets/js/335.e57b8205.js"><link rel="prefetch" href="/note-doc/assets/js/336.36aa2313.js"><link rel="prefetch" href="/note-doc/assets/js/337.38df87d9.js"><link rel="prefetch" href="/note-doc/assets/js/338.8ab6d751.js"><link rel="prefetch" href="/note-doc/assets/js/339.90e00d63.js"><link rel="prefetch" href="/note-doc/assets/js/34.71d51816.js"><link rel="prefetch" href="/note-doc/assets/js/340.58bd4ac4.js"><link rel="prefetch" href="/note-doc/assets/js/341.92b02fa7.js"><link rel="prefetch" href="/note-doc/assets/js/342.818db87d.js"><link rel="prefetch" href="/note-doc/assets/js/343.b9736a56.js"><link rel="prefetch" href="/note-doc/assets/js/344.31d7549c.js"><link rel="prefetch" href="/note-doc/assets/js/345.adea29d3.js"><link rel="prefetch" href="/note-doc/assets/js/346.20b4dd93.js"><link rel="prefetch" href="/note-doc/assets/js/347.902b128c.js"><link rel="prefetch" href="/note-doc/assets/js/348.2ffeb515.js"><link rel="prefetch" href="/note-doc/assets/js/349.907df173.js"><link rel="prefetch" href="/note-doc/assets/js/35.a764cf93.js"><link rel="prefetch" href="/note-doc/assets/js/350.bb6bf140.js"><link rel="prefetch" href="/note-doc/assets/js/351.4a5daec5.js"><link rel="prefetch" href="/note-doc/assets/js/352.ed5eb728.js"><link rel="prefetch" href="/note-doc/assets/js/353.7bad473f.js"><link rel="prefetch" href="/note-doc/assets/js/354.fb6a48fa.js"><link rel="prefetch" href="/note-doc/assets/js/355.1bf63d0b.js"><link rel="prefetch" href="/note-doc/assets/js/356.63441e9e.js"><link rel="prefetch" href="/note-doc/assets/js/357.8c4a8a16.js"><link rel="prefetch" href="/note-doc/assets/js/358.bf0ad691.js"><link rel="prefetch" href="/note-doc/assets/js/359.893da531.js"><link rel="prefetch" href="/note-doc/assets/js/36.387417dc.js"><link rel="prefetch" href="/note-doc/assets/js/360.23374153.js"><link rel="prefetch" href="/note-doc/assets/js/361.333ef35d.js"><link rel="prefetch" href="/note-doc/assets/js/362.d657339b.js"><link rel="prefetch" href="/note-doc/assets/js/363.c601fba2.js"><link rel="prefetch" href="/note-doc/assets/js/364.fc8ca98f.js"><link rel="prefetch" href="/note-doc/assets/js/365.d730899b.js"><link rel="prefetch" href="/note-doc/assets/js/366.4a5a1619.js"><link rel="prefetch" href="/note-doc/assets/js/367.7a1d9730.js"><link rel="prefetch" href="/note-doc/assets/js/368.33a8b6aa.js"><link rel="prefetch" href="/note-doc/assets/js/369.2e63c99a.js"><link rel="prefetch" href="/note-doc/assets/js/37.58efcbf6.js"><link rel="prefetch" href="/note-doc/assets/js/370.9999c265.js"><link rel="prefetch" href="/note-doc/assets/js/371.87ebcee5.js"><link rel="prefetch" href="/note-doc/assets/js/38.28eb9a79.js"><link rel="prefetch" href="/note-doc/assets/js/39.2d6c3ece.js"><link rel="prefetch" href="/note-doc/assets/js/4.b4b049ae.js"><link rel="prefetch" href="/note-doc/assets/js/40.a09fe0b7.js"><link rel="prefetch" href="/note-doc/assets/js/41.8d386363.js"><link rel="prefetch" href="/note-doc/assets/js/42.4d4cb285.js"><link rel="prefetch" href="/note-doc/assets/js/43.0c7cb113.js"><link rel="prefetch" href="/note-doc/assets/js/44.7f957cea.js"><link rel="prefetch" href="/note-doc/assets/js/45.80da5177.js"><link rel="prefetch" href="/note-doc/assets/js/46.ff8710be.js"><link rel="prefetch" href="/note-doc/assets/js/47.f2c6a34b.js"><link rel="prefetch" href="/note-doc/assets/js/48.5b61e305.js"><link rel="prefetch" href="/note-doc/assets/js/49.88eb1968.js"><link rel="prefetch" href="/note-doc/assets/js/5.9c16d105.js"><link rel="prefetch" href="/note-doc/assets/js/50.baf8cea0.js"><link rel="prefetch" href="/note-doc/assets/js/51.6c0e58cb.js"><link rel="prefetch" href="/note-doc/assets/js/52.f6d3ebfc.js"><link rel="prefetch" href="/note-doc/assets/js/53.bbbce875.js"><link rel="prefetch" href="/note-doc/assets/js/54.afdcb479.js"><link rel="prefetch" href="/note-doc/assets/js/55.0100b434.js"><link rel="prefetch" href="/note-doc/assets/js/56.d923c31c.js"><link rel="prefetch" href="/note-doc/assets/js/57.8ad416c4.js"><link rel="prefetch" href="/note-doc/assets/js/58.97287596.js"><link rel="prefetch" href="/note-doc/assets/js/59.4428478a.js"><link rel="prefetch" href="/note-doc/assets/js/6.d0fedae6.js"><link rel="prefetch" href="/note-doc/assets/js/60.31446299.js"><link rel="prefetch" href="/note-doc/assets/js/61.138933e2.js"><link rel="prefetch" href="/note-doc/assets/js/62.4b733df1.js"><link rel="prefetch" href="/note-doc/assets/js/63.cf0323dd.js"><link rel="prefetch" href="/note-doc/assets/js/64.92e41724.js"><link rel="prefetch" href="/note-doc/assets/js/65.fc1fcfdb.js"><link rel="prefetch" href="/note-doc/assets/js/66.bcd2d7eb.js"><link rel="prefetch" href="/note-doc/assets/js/67.d3e6bef5.js"><link rel="prefetch" href="/note-doc/assets/js/68.253902e4.js"><link rel="prefetch" href="/note-doc/assets/js/69.77691dba.js"><link rel="prefetch" href="/note-doc/assets/js/7.0c68a5be.js"><link rel="prefetch" href="/note-doc/assets/js/70.05c503f2.js"><link rel="prefetch" href="/note-doc/assets/js/71.f4301ce4.js"><link rel="prefetch" href="/note-doc/assets/js/72.d9e81f7b.js"><link rel="prefetch" href="/note-doc/assets/js/73.176225e9.js"><link rel="prefetch" href="/note-doc/assets/js/74.6fa292e5.js"><link rel="prefetch" href="/note-doc/assets/js/75.aaf69f80.js"><link rel="prefetch" href="/note-doc/assets/js/76.fa769710.js"><link rel="prefetch" href="/note-doc/assets/js/77.6e61210a.js"><link rel="prefetch" href="/note-doc/assets/js/78.9aa677e6.js"><link rel="prefetch" href="/note-doc/assets/js/79.91ec4936.js"><link rel="prefetch" href="/note-doc/assets/js/8.4a23a032.js"><link rel="prefetch" href="/note-doc/assets/js/80.ed82f0f3.js"><link rel="prefetch" href="/note-doc/assets/js/81.7aa71d7f.js"><link rel="prefetch" href="/note-doc/assets/js/82.11124891.js"><link rel="prefetch" href="/note-doc/assets/js/83.8e516001.js"><link rel="prefetch" href="/note-doc/assets/js/84.7ad131cd.js"><link rel="prefetch" href="/note-doc/assets/js/85.cff98e86.js"><link rel="prefetch" href="/note-doc/assets/js/86.9cb78ba0.js"><link rel="prefetch" href="/note-doc/assets/js/87.0c7a8f9e.js"><link rel="prefetch" href="/note-doc/assets/js/88.a038b507.js"><link rel="prefetch" href="/note-doc/assets/js/89.4a9ccfe8.js"><link rel="prefetch" href="/note-doc/assets/js/9.27fe38e2.js"><link rel="prefetch" href="/note-doc/assets/js/90.342409fd.js"><link rel="prefetch" href="/note-doc/assets/js/91.88deae66.js"><link rel="prefetch" href="/note-doc/assets/js/92.49d193ee.js"><link rel="prefetch" href="/note-doc/assets/js/93.b9964f97.js"><link rel="prefetch" href="/note-doc/assets/js/94.13b71cdc.js"><link rel="prefetch" href="/note-doc/assets/js/95.bba2f83c.js"><link rel="prefetch" href="/note-doc/assets/js/96.58594290.js"><link rel="prefetch" href="/note-doc/assets/js/97.bed0064c.js"><link rel="prefetch" href="/note-doc/assets/js/98.52adb65d.js"><link rel="prefetch" href="/note-doc/assets/js/99.b185a1c9.js">
    <link rel="stylesheet" href="/note-doc/assets/css/0.styles.e218e477.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note-doc/" class="home-link router-link-active"><img src="/img/logo.png" alt="X_SaaS快速开发平台" class="logo"> <span class="site-name can-hide">X_SaaS快速开发平台</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note-doc/dev/" class="nav-link">开发指南</a></div><div class="nav-item"><a href="/note-doc/operate/" class="nav-link">操作手册</a></div><div class="nav-item"><a href="/note-doc/dev-rule/" class="nav-link">开发规范</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java全栈知识" class="dropdown-title"><a href="/note-doc/web/" class="link-title">java全栈知识</a> <span class="title" style="display:none;">java全栈知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-doc/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>页面</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-doc/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/note-doc/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-doc/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/note-doc/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/note-doc/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li><li class="dropdown-item"><h4>技术</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-doc/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-subitem"><a href="/note-doc/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/note-doc/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-doc/pages/f2a556/" class="nav-link">学习方法</a></li><li class="dropdown-item"><!----> <a href="/note-doc/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li></ul></div></div><div class="nav-item"><a href="/note-doc/about/" class="nav-link">关于</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/note-doc/dev/" class="nav-link">开发指南</a></div><div class="nav-item"><a href="/note-doc/operate/" class="nav-link">操作手册</a></div><div class="nav-item"><a href="/note-doc/dev-rule/" class="nav-link">开发规范</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java全栈知识" class="dropdown-title"><a href="/note-doc/web/" class="link-title">java全栈知识</a> <span class="title" style="display:none;">java全栈知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-doc/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>页面</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-doc/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/note-doc/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-doc/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/note-doc/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/note-doc/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li><li class="dropdown-item"><h4>技术</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-doc/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-subitem"><a href="/note-doc/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/note-doc/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-doc/pages/f2a556/" class="nav-link">学习方法</a></li><li class="dropdown-item"><!----> <a href="/note-doc/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li></ul></div></div><div class="nav-item"><a href="/note-doc/about/" class="nav-link">关于</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>项目手册</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>开发指南</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>快速入门</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading open"><span>微服务</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note-doc/pages/88b04d/" class="sidebar-link">统一网关</a></li><li><a href="/note-doc/pages/05eabd/" class="sidebar-link">权限认证</a></li><li><a href="/note-doc/pages/921eef/" class="sidebar-link">服务发现</a></li><li><a href="/note-doc/pages/22126f/" class="sidebar-link">配置中心</a></li><li><a href="/note-doc/pages/350fd5/" class="sidebar-link">服务调用</a></li><li><a href="/note-doc/pages/7ca45c/" class="sidebar-link">限流熔断</a></li><li><a href="/note-doc/pages/c42fe4/" class="sidebar-link">消息驱动</a></li><li><a href="/note-doc/pages/008939/" class="sidebar-link">服务监控</a></li><li><a href="/note-doc/pages/dcb32e/" class="sidebar-link">服务接口</a></li><li><a href="/note-doc/pages/b6f673/" class="sidebar-link">单元测试</a></li><li><a href="/note-doc/pages/6edd47/" class="sidebar-link">链路追踪</a></li><li><a href="/note-doc/pages/ed97b9/" aria-current="page" class="active sidebar-link">分库分表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/note-doc/pages/ed97b9/#产品优势" class="sidebar-link">产品优势</a></li><li class="sidebar-sub-header level2"><a href="/note-doc/pages/ed97b9/#使用手册" class="sidebar-link">使用手册</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/note-doc/pages/ed97b9/#数据分配" class="sidebar-link">数据分配</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/ed97b9/#读写分离" class="sidebar-link">读写分离</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/ed97b9/#强制路由" class="sidebar-link">强制路由</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/ed97b9/#数据治理" class="sidebar-link">数据治理</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/ed97b9/#分布式事务" class="sidebar-link">分布式事务</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/note-doc/pages/ed97b9/#sharding-proxy" class="sidebar-link">Sharding-Proxy</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/note-doc/pages/ed97b9/#应用场景" class="sidebar-link">应用场景</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/ed97b9/#使用手册-2" class="sidebar-link">使用手册</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/note-doc/pages/ed97b9/#配置手册" class="sidebar-link">配置手册</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/note-doc/pages/ed97b9/#java-参考" class="sidebar-link">java 参考</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/ed97b9/#yaml-参考" class="sidebar-link">yaml 参考</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/ed97b9/#properties-参考" class="sidebar-link">properties 参考</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/ed97b9/#springboot配置" class="sidebar-link">SpringBoot配置</a></li></ul></li></ul></li><li><a href="/note-doc/pages/fe3ddc/" class="sidebar-link">分布式事务</a></li><li><a href="/note-doc/dev/server/dynamic-datasource/" class="sidebar-link">多数据源</a></li><li><a href="/note-doc/pages/552fed/" class="sidebar-link">文件存储</a></li><li><a href="/note-doc/pages/b53fd8/" class="sidebar-link">分布式锁</a></li><li><a href="/note-doc/pages/419513/" class="sidebar-link">分布式日志</a></li><li><a href="/note-doc/dev/server/job/" class="sidebar-link">定时任务</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>后端手册</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>前端手册Vue2</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>前端手册Vue3</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>运维手册</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>大屏手册</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>更新日志</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>操作指南</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开发规范</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/note-doc/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/note-doc/categories/?category=%E6%96%87%E6%A1%A3%E6%89%8B%E5%86%8C" title="分类" data-v-06225672>文档手册</a></li><li data-v-06225672><a href="/note-doc/categories/?category=%E9%A1%B9%E7%9B%AE%E6%89%8B%E5%86%8C" title="分类" data-v-06225672>项目手册</a></li><li data-v-06225672><a href="/note-doc/categories/?category=%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97" title="分类" data-v-06225672>开发指南</a></li><li data-v-06225672><a href="/note-doc/categories/?category=%E5%BE%AE%E6%9C%8D%E5%8A%A1" title="分类" data-v-06225672>微服务</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/simpleguan" target="_blank" title="作者" class="beLink" data-v-06225672>TC</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-08-11</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">分库分表<!----></h1>  <div class="theme-vdoing-content content__default"><div class="custom-block tip"><p class="custom-block-title">介绍</p> <h3 id="什么是分库分表"><a href="#什么是分库分表" class="header-anchor">#</a> 什么是分库分表</h3> <p>当我们使用读写分离、索引、缓存后，数据库的压力还是很大的时候，这就需要使用到数据库拆分了。</p> <p>分库：从单个数据库拆分成多个数据库的过程，将数据散落在多个数据库中。</p> <p>分表：从单张表拆分成多张表的过程，将数据散落在多张表内。</p> <h3 id="为什么要使用分库分表"><a href="#为什么要使用分库分表" class="header-anchor">#</a> 为什么要使用分库分表</h3> <p>分库分表可以提升系统的稳定性跟负载能力，不存在单库/单表大数据。增加了系统高并发能力和可用性。缺点是分库无法 <code>join</code> ，只能通过接口方式解决，增加了系统复杂度。</p> <h3 id="什么是-shardingsphere"><a href="#什么是-shardingsphere" class="header-anchor">#</a> 什么是 ShardingSphere</h3> <p>Apache ShardingSphere 是一款开源的分布式数据库生态项目，由 JDBC 和 Proxy 两款产品组成。其核心采用微内核+可插拔架构，通过插件开放扩展功能。它提供多源异构数据库增强平台，进而围绕其上层构建生态。</p> <p>Apache ShardingSphere 设计哲学为 Database Plus，旨在构建异构数据库上层的标准和生态。它关注如何充分合理地利用数据库的计算和存储能力，而并非实现一个全新的数据库。它站在数据库的上层视角，关注它们之间的协作多于数据库自身。</p> <h4 id="shardingsphere-jdbc"><a href="#shardingsphere-jdbc" class="header-anchor">#</a> ShardingSphere-JDBC</h4> <p>ShardingSphere-JDBC 定位为轻量级 Java 框架，在 Java 的 JDBC 层提供的额外服务。</p> <h4 id="shardingsphere-proxy"><a href="#shardingsphere-proxy" class="header-anchor">#</a> ShardingSphere-Proxy</h4> <p>ShardingSphere-Proxy 定位为透明化的数据库代理端，通过实现数据库二进制协议，对异构语言提供支持。</p> <div class="custom-block right"><p>来自<a href="https://shardingsphere.apache.org/document/current/cn/overview/" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></div> <h2 id="产品优势"><a href="#产品优势" class="header-anchor">#</a> 产品优势</h2> <ul><li>极致性能</li></ul> <p>驱动程序端历经长年打磨，效率接近原生 JDBC，性能极致。</p> <ul><li>生态兼容</li></ul> <p>代理端支持任何通过 MySQL/PostgreSQL 协议的应用访问，驱动程序端可对接任意实现 JDBC 规范的数据库。</p> <ul><li>业务零侵入</li></ul> <p>面对数据库替换场景，ShardingSphere 可满足业务无需改造，实现平滑业务迁移。</p> <ul><li>运维低成本</li></ul> <p>在保留原技术栈不变前提下，对 DBA 学习、管理成本低，交互友好。</p> <ul><li>安全稳定</li></ul> <p>基于成熟数据库底座之上提供增量能力，兼顾安全性及稳定性。</p> <ul><li><p>弹性扩展
具备计算、存储平滑在线扩展能力，可满足业务多变的需求。</p></li> <li><p>开放生态</p></li></ul> <p>通过多层次（内核、功能、生态）插件化能力，为用户提供可定制满足自身特殊需求的独有系统。</p> <p>下面是 <code>ShardingSphere</code> 的架构图：
<img src="https://shardingsphere.apache.org/document/current/img/overview_cn.png" alt="shardingsphere"> <img src="https://shardingsphere.apache.org/document/current/img/shardingsphere-jdbc_v3.png" alt="shardingsphere"></p> <h2 id="使用手册"><a href="#使用手册" class="header-anchor">#</a> 使用手册</h2> <p>本部分是介绍 Sharding-JDBC 相关使用。建议参考官方文档学习<a href="https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/" target="_blank" rel="noopener noreferrer">shardingsphere-jdbc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="数据分配"><a href="#数据分配" class="header-anchor">#</a> 数据分配</h3> <p><strong>引入Maven依赖</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- for spring boot --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${sharding-sphere.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- for spring namespace --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-spring-namespace<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${sharding-sphere.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>基于Java编码的规则配置</strong></p> <p><code>Sharding-JDBC</code> 的分库分表通过规则配置描述，以下例子是根据 <code>user_id</code> 取模分库, 且根据 <code>order_id</code> 取模分表的两库两表的配置。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 配置真实数据源</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">DataSource</span><span class="token punctuation">&gt;</span></span> dataSourceMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 配置第一个数据源</span>
<span class="token class-name">BasicDataSource</span> dataSource1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataSource1<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span><span class="token string">&quot;com.mysql.jdbc.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataSource1<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:mysql://localhost:3306/ds0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataSource1<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataSource1<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataSourceMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ds0&quot;</span><span class="token punctuation">,</span> dataSource1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 配置第二个数据源</span>
<span class="token class-name">BasicDataSource</span> dataSource2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataSource2<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span><span class="token string">&quot;com.mysql.jdbc.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataSource2<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:mysql://localhost:3306/ds1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataSource2<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataSource2<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataSourceMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ds1&quot;</span><span class="token punctuation">,</span> dataSource2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 配置Order表规则</span>
<span class="token class-name">TableRuleConfiguration</span> orderTableRuleConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TableRuleConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
orderTableRuleConfig<span class="token punctuation">.</span><span class="token function">setLogicTable</span><span class="token punctuation">(</span><span class="token string">&quot;t_order&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
orderTableRuleConfig<span class="token punctuation">.</span><span class="token function">setActualDataNodes</span><span class="token punctuation">(</span><span class="token string">&quot;ds${0..1}.t_order${0..1}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 配置分库 + 分表策略</span>
orderTableRuleConfig<span class="token punctuation">.</span><span class="token function">setDatabaseShardingStrategyConfig</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InlineShardingStrategyConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;user_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ds${user_id % 2}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
orderTableRuleConfig<span class="token punctuation">.</span><span class="token function">setTableShardingStrategyConfig</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InlineShardingStrategyConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;order_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;t_order${order_id % 2}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 配置分片规则</span>
<span class="token class-name">ShardingRuleConfiguration</span> shardingRuleConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShardingRuleConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
shardingRuleConfig<span class="token punctuation">.</span><span class="token function">getTableRuleConfigs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderTableRuleConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 省略配置order_item表规则...</span>
<span class="token comment">// ...</span>

<span class="token comment">// 获取数据源对象</span>
<span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> <span class="token class-name">ShardingDataSourceFactory</span><span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span>dataSourceMap<span class="token punctuation">,</span> shardingRuleConfig<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p><strong>基于Yaml的规则配置</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
 <span class="token key atrule">ds0</span><span class="token punctuation">:</span> <span class="token tag">!!org.apache.commons.dbcp.BasicDataSource</span>
   <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
   <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/ds0
   <span class="token key atrule">username</span><span class="token punctuation">:</span> root
   <span class="token key atrule">password</span><span class="token punctuation">:</span> 
 <span class="token key atrule">ds1</span><span class="token punctuation">:</span> <span class="token tag">!!org.apache.commons.dbcp.BasicDataSource</span>
   <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
   <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/ds1
   <span class="token key atrule">username</span><span class="token punctuation">:</span> root
   <span class="token key atrule">password</span><span class="token punctuation">:</span> 

<span class="token key atrule">tables</span><span class="token punctuation">:</span>
 <span class="token key atrule">t_order</span><span class="token punctuation">:</span> 
   <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> ds$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>.t_order$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>
   <span class="token key atrule">databaseStrategy</span><span class="token punctuation">:</span> 
     <span class="token key atrule">inline</span><span class="token punctuation">:</span>
       <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> user_id
       <span class="token key atrule">algorithmInlineExpression</span><span class="token punctuation">:</span> ds$<span class="token punctuation">{</span>user_id % 2<span class="token punctuation">}</span>
   <span class="token key atrule">tableStrategy</span><span class="token punctuation">:</span> 
     <span class="token key atrule">inline</span><span class="token punctuation">:</span>
       <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> order_id
       <span class="token key atrule">algorithmInlineExpression</span><span class="token punctuation">:</span> t_order$<span class="token punctuation">{</span>order_id % 2<span class="token punctuation">}</span>
 <span class="token key atrule">t_order_item</span><span class="token punctuation">:</span> 
   <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> ds$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>.t_order_item$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>
   <span class="token key atrule">databaseStrategy</span><span class="token punctuation">:</span> 
     <span class="token key atrule">inline</span><span class="token punctuation">:</span>
       <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> user_id
       <span class="token key atrule">algorithmInlineExpression</span><span class="token punctuation">:</span> ds$<span class="token punctuation">{</span>user_id % 2<span class="token punctuation">}</span>
   <span class="token key atrule">tableStrategy</span><span class="token punctuation">:</span> 
     <span class="token key atrule">inline</span><span class="token punctuation">:</span>
       <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> order_id
       <span class="token key atrule">algorithmInlineExpression</span><span class="token punctuation">:</span> t_order_item$<span class="token punctuation">{</span>order_id % 2<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p><strong>基于 Spring 的规则配置</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
 <span class="token key atrule">shardingsphere</span><span class="token punctuation">:</span>
     <span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
       <span class="token key atrule">ds0</span><span class="token punctuation">:</span> 
         <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
         <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
         <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/ds0
         <span class="token key atrule">username</span><span class="token punctuation">:</span> root
         <span class="token key atrule">password</span><span class="token punctuation">:</span> 
       <span class="token key atrule">ds1</span><span class="token punctuation">:</span> 
         <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
         <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
         <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/ds1
         <span class="token key atrule">username</span><span class="token punctuation">:</span> root
         <span class="token key atrule">password</span><span class="token punctuation">:</span> 
     <span class="token key atrule">sharding</span><span class="token punctuation">:</span>
        <span class="token key atrule">tables</span><span class="token punctuation">:</span>
          <span class="token key atrule">t_order</span><span class="token punctuation">:</span> 
            <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> ds$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>.t_order$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>
            <span class="token key atrule">table-strategy</span><span class="token punctuation">:</span> 
              <span class="token key atrule">inline</span><span class="token punctuation">:</span>
                <span class="token key atrule">sharding-column</span><span class="token punctuation">:</span> user_id
                <span class="token key atrule">algorithmInlineExpression</span><span class="token punctuation">:</span> ds$<span class="token punctuation">{</span>user_id % 2<span class="token punctuation">}</span>
            <span class="token key atrule">table-strategy</span><span class="token punctuation">:</span> 
              <span class="token key atrule">inline</span><span class="token punctuation">:</span>
                <span class="token key atrule">sharding-column</span><span class="token punctuation">:</span> order_id
                <span class="token key atrule">algorithm-inline-expression</span><span class="token punctuation">:</span> t_order$<span class="token punctuation">{</span>order_id % 2<span class="token punctuation">}</span>
          <span class="token key atrule">t_order_item</span><span class="token punctuation">:</span> 
            <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> ds$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>.t_order_item$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>
            <span class="token key atrule">databaseStrategy</span><span class="token punctuation">:</span> 
              <span class="token key atrule">inline</span><span class="token punctuation">:</span>
                <span class="token key atrule">sharding-column</span><span class="token punctuation">:</span> user_id
                <span class="token key atrule">algorithm-inline-expression</span><span class="token punctuation">:</span> ds$<span class="token punctuation">{</span>user_id % 2<span class="token punctuation">}</span>
            <span class="token key atrule">table-strategy</span><span class="token punctuation">:</span> 
              <span class="token key atrule">inline</span><span class="token punctuation">:</span>
                <span class="token key atrule">sharding-column</span><span class="token punctuation">:</span> order_id
                <span class="token key atrule">algorithm-inline-expression</span><span class="token punctuation">:</span> t_order_item$<span class="token punctuation">{</span>order_id % 2<span class="token punctuation">}</span>
  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h3 id="读写分离"><a href="#读写分离" class="header-anchor">#</a> 读写分离</h3> <p><strong>引入Maven依赖</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- for spring boot --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${sharding-sphere.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- for spring namespace --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-spring-namespace<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${sharding-sphere.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>基于Java编码的规则配置</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 配置真实数据源</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">DataSource</span><span class="token punctuation">&gt;</span></span> dataSourceMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 配置主库</span>
<span class="token class-name">BasicDataSource</span> masterDataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
masterDataSource<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span><span class="token string">&quot;com.mysql.jdbc.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
masterDataSource<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:mysql://localhost:3306/ds_master&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
masterDataSource<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
masterDataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataSourceMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ds_master&quot;</span><span class="token punctuation">,</span> masterDataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 配置第一个从库</span>
<span class="token class-name">BasicDataSource</span> slaveDataSource1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
slaveDataSource1<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span><span class="token string">&quot;com.mysql.jdbc.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
slaveDataSource1<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:mysql://localhost:3306/ds_slave0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
slaveDataSource1<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
slaveDataSource1<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataSourceMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ds_slave0&quot;</span><span class="token punctuation">,</span> slaveDataSource1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 配置第二个从库</span>
<span class="token class-name">BasicDataSource</span> slaveDataSource2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
slaveDataSource2<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span><span class="token string">&quot;com.mysql.jdbc.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
slaveDataSource2<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:mysql://localhost:3306/ds_slave1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
slaveDataSource2<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
slaveDataSource2<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataSourceMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ds_slave1&quot;</span><span class="token punctuation">,</span> slaveDataSource2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 配置读写分离规则</span>
<span class="token class-name">MasterSlaveRuleConfiguration</span> masterSlaveRuleConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MasterSlaveRuleConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;ds_master_slave&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ds_master&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;ds_slave0&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ds_slave1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取数据源对象</span>
<span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> <span class="token class-name">MasterSlaveDataSourceFactory</span><span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span><span class="token function">createDataSourceMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> masterSlaveRuleConfig<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p><strong>基于Yaml的规则配置</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
 <span class="token key atrule">ds_master</span><span class="token punctuation">:</span> <span class="token tag">!!org.apache.commons.dbcp.BasicDataSource</span>
   <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
   <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/ds_master
   <span class="token key atrule">username</span><span class="token punctuation">:</span> root
   <span class="token key atrule">password</span><span class="token punctuation">:</span> 
 <span class="token key atrule">ds_slave0</span><span class="token punctuation">:</span> <span class="token tag">!!org.apache.commons.dbcp.BasicDataSource</span>
   <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
   <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/ds_slave0
   <span class="token key atrule">username</span><span class="token punctuation">:</span> root
   <span class="token key atrule">password</span><span class="token punctuation">:</span>
 <span class="token key atrule">ds_slave1</span><span class="token punctuation">:</span> <span class="token tag">!!org.apache.commons.dbcp.BasicDataSource</span>
   <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
   <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/ds_slave1
   <span class="token key atrule">username</span><span class="token punctuation">:</span> root
   <span class="token key atrule">password</span><span class="token punctuation">:</span> 

<span class="token key atrule">masterSlaveRule</span><span class="token punctuation">:</span>
 <span class="token key atrule">name</span><span class="token punctuation">:</span> ds_ms
 <span class="token key atrule">masterDataSourceName</span><span class="token punctuation">:</span> ds_master
 <span class="token key atrule">slaveDataSourceNames</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>ds_slave0<span class="token punctuation">,</span> ds_slave1<span class="token punctuation">]</span>
 
 <span class="token key atrule">props</span><span class="token punctuation">:</span>
     <span class="token key atrule">sql.show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
 <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
     <span class="token key atrule">key1</span><span class="token punctuation">:</span> value1

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="强制路由"><a href="#强制路由" class="header-anchor">#</a> 强制路由</h3> <p><code>ShardingSphere</code> 使用 <code>ThreadLocal</code> 管理分片键值进行 <code>Hint</code> 强制路由。可以通过编程的方式向 <code>HintManager</code> 中添加分片条件，该分片条件仅在当前线程内生效。</p> <p>1.分片字段不存在SQL中、数据库表结构中，而存在于外部业务逻辑。因此，通过Hint实现外部指定分片结果进行数据操作。</p> <p>2.强制在主库进行某些数据操作。</p> <p><strong>配置</strong></p> <p>使用hint进行强制数据分片，需要使用HintManager搭配分片策略配置共同使用。若DatabaseShardingStrategy配置了Hint分片算法，则可使用HintManager进行分库路由结果的注入。同理，若TableShardingStrategy配置了Hint分片算法，则同样可 使用HintManager进行分表路由结果的注入。所以使用Hint之前，需要配置Hint分片算法。</p> <p>参考配置如下：</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">shardingRule</span><span class="token punctuation">:</span>
 <span class="token key atrule">tables</span><span class="token punctuation">:</span>
  <span class="token key atrule">t_order</span><span class="token punctuation">:</span>
       <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> demo_ds_$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>.t_order_$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>
       <span class="token key atrule">databaseStrategy</span><span class="token punctuation">:</span>
         <span class="token key atrule">hint</span><span class="token punctuation">:</span>
           <span class="token key atrule">algorithmClassName</span><span class="token punctuation">:</span> io.shardingsphere.userAlgo.HintAlgorithm
       <span class="token key atrule">tableStrategy</span><span class="token punctuation">:</span>
         <span class="token key atrule">hint</span><span class="token punctuation">:</span>
           <span class="token key atrule">algorithmClassName</span><span class="token punctuation">:</span> io.shardingsphere.userAlgo.HintAlgorithm
 <span class="token key atrule">defaultTableStrategy</span><span class="token punctuation">:</span>
   <span class="token key atrule">none</span><span class="token punctuation">:</span>
 <span class="token key atrule">defaultKeyGeneratorClassName</span><span class="token punctuation">:</span> io.shardingsphere.core.keygen.DefaultKeyGenerator
 <span class="token key atrule">props</span><span class="token punctuation">:</span>
     <span class="token key atrule">sql.show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>实例化</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">HintManager</span> hintManager <span class="token operator">=</span> <span class="token class-name">HintManager</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>添加分片键值</strong></p> <ul><li><p>使用hintManager.addDatabaseShardingValue来添加数据源分片键值。</p></li> <li><p>使用hintManager.addTableShardingValue来添加表分片键值。</p></li></ul> <blockquote><p>分库不分表情况下，强制路由至某一个分库时，可使用hintManager.setDatabaseShardingValue方式添加分片。通过此方式添加分片键值后，将跳过SQL解析和改写阶段，从而提高整体执行效率。</p></blockquote> <p><strong>清除分片键值</strong></p> <p>分片键值保存在ThreadLocal中，所以需要在操作结束时调用hintManager.close()来清除ThreadLocal中的内容。</p> <p>hintManager实现了AutoCloseable接口，可推荐使用try with resource自动关闭。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Sharding database and table with using hintManager.</span>
<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;SELECT * FROM t_order&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">HintManager</span> hintManager <span class="token operator">=</span> <span class="token class-name">HintManager</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Connection</span> conn <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   hintManager<span class="token punctuation">.</span><span class="token function">addDatabaseShardingValue</span><span class="token punctuation">(</span><span class="token string">&quot;t_order&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   hintManager<span class="token punctuation">.</span><span class="token function">addTableShardingValue</span><span class="token punctuation">(</span><span class="token string">&quot;t_order&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   	<span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   		<span class="token comment">// ...</span>
   	<span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Sharding database without sharding table and routing to only one database with using hintManger.</span>
<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;SELECT * FROM t_order&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">HintManager</span> hintManager <span class="token operator">=</span> <span class="token class-name">HintManager</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Connection</span> conn <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   hintManager<span class="token punctuation">.</span><span class="token function">setDatabaseShardingValue</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   	<span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   		<span class="token comment">// ...</span>
   	<span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><strong>基于暗示(Hint)的强制主库路由</strong></p> <p>实例化</p> <ul><li>与基于暗示(Hint)的数据分片相同。</li></ul> <p>设置主库路由</p> <ul><li>使用hintManager.setMasterRouteOnly设置主库路由。</li></ul> <p>清除分片键值</p> <ul><li>与基于暗示(Hint)的数据分片相同。</li></ul> <p>完整代码示例</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;SELECT * FROM t_order&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">(</span>
       <span class="token class-name">HintManager</span> hintManager <span class="token operator">=</span> <span class="token class-name">HintManager</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">Connection</span> conn <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   hintManager<span class="token punctuation">.</span><span class="token function">setMasterRouteOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">// ...</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="数据治理"><a href="#数据治理" class="header-anchor">#</a> 数据治理</h3> <p>使用数据治理功能需要指定一个注册中心。配置将全部存入注册中心，可以在每次启动时使用本地配置覆盖注册中心配置，也可以只通过注册中心读取配置。</p> <p><strong>引入Maven依赖</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- for spring boot --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-orchestration-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${sharding-sphere.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--若使用zookeeper, 请加入下面Maven坐标--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-orchestration-reg-zookeeper-curator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${sharding-sphere.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--若使用etcd, 请加入下面Maven坐标--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-orchestration-reg-etcd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${sharding-sphere.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong>基于Java编码的规则配置</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 省略配置dataSourceMap以及shardingRuleConfig</span>
<span class="token comment">// ...</span>

<span class="token comment">// 配置注册中心</span>
<span class="token class-name">RegistryCenterConfiguration</span> regConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegistryCenterConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
regConfig<span class="token punctuation">.</span><span class="token function">setServerLists</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
regConfig<span class="token punctuation">.</span><span class="token function">setNamespace</span><span class="token punctuation">(</span><span class="token string">&quot;sharding-sphere-orchestration&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 配置数据治理</span>
<span class="token class-name">OrchestrationConfiguration</span> orchConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrchestrationConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;orchestration-sharding-data-source&quot;</span><span class="token punctuation">,</span> regConfig<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取数据源对象</span>
<span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> <span class="token class-name">OrchestrationShardingDataSourceFactory</span><span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span>dataSourceMap<span class="token punctuation">,</span> shardingRuleConfig<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orchConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>基于Yaml的规则配置</strong></p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>orchestration:
 name: orchestration-sharding-data-source
 overwrite: false
 registry:
   serverLists: localhost:2181
   namespace: sharding-sphere-orchestration

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="分布式事务"><a href="#分布式事务" class="header-anchor">#</a> 分布式事务</h3> <p><strong>引入Maven依赖</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-transaction-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${sharding-sphere.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-aop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring-boot.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>连接池配置</strong></p> <p>ShardingSphere 支持将普通的数据库连接池，转换为支持 XA 事务的连接池，对 HikariCP, Druid 和 DBCP2 连接池内置支持，无需额外配置。 其它连接池需要用户实现 <code>DataSourceMapConverter</code> 的 SPI 接口进行扩展，可以参考 <code>io.shardingsphere.transaction.xa.convert.swap.HikariParameterSwapper</code> 的实现。 若 ShardingSphere 无法找到合适的实现，则会按默认的配置创建 XA 事务连接池。默认属性如下：</p> <table><thead><tr><th style="text-align:center;">属性名称</th> <th style="text-align:center;">默认值</th></tr></thead> <tbody><tr><td style="text-align:center;">connectionTimeoutMilliseconds</td> <td style="text-align:center;">30 * 1000</td></tr> <tr><td style="text-align:center;">idleTimeoutMilliseconds</td> <td style="text-align:center;">60 * 1000</td></tr> <tr><td style="text-align:center;">maintenanceIntervalMilliseconds</td> <td style="text-align:center;">30 * 1000</td></tr> <tr><td style="text-align:center;">maxLifetimeMilliseconds</td> <td style="text-align:center;">0 (无限制)</td></tr> <tr><td style="text-align:center;">maxPoolSize</td> <td style="text-align:center;">50</td></tr> <tr><td style="text-align:center;">minPoolSize</td> <td style="text-align:center;">1</td></tr></tbody></table> <p><strong>事务类型切换</strong></p> <p><code>ShardingSphere</code> 的事务类型存放在 <code>TransactionTypeHolder</code> 的本地线程变量中，因此在数据库连接创建前修改此值，可以达到自由切换事务类型的效果。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>数据库连接创建之后，事务类型将无法更改。</p></div> <p><strong>API方式</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">TransactionTypeHolder</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">TransactionType</span><span class="token punctuation">.</span>LOCAL<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>或</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">TransactionTypeHolder</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">TransactionType</span><span class="token punctuation">.</span>XA<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>AutoConfiguration配置</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">JtaAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;io.shardingsphere.transaction.aspect&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StartMain</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>业务代码</strong></p> <p>在需要事务的方法或类中添加相关注解即可，例如：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@ShardingTransactionType</span><span class="token punctuation">(</span><span class="token class-name">TransactionType</span><span class="token punctuation">.</span>LOCAL<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Transactional</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>或</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@ShardingTransactionType</span><span class="token punctuation">(</span><span class="token class-name">TransactionType</span><span class="token punctuation">.</span>XA<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Transactional</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>@ShardingTransactionType 需要同 Spring 的 @Transactional 配套使用，事务才会生效。</p></div> <p><strong>Atomikos参数配置</strong></p> <p>ShardingSphere 默认的XA事务管理器为 Atomikos。 可以通过在项目的 classpath 中添加 <code>jta.properties</code> 来定制化 Atomikos 配置项。 具体的配置规则请参考 <a href="https://www.atomikos.com/Documentation/JtaProperties" target="_blank" rel="noopener noreferrer">Atomikos <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的官方文档。</p> <h2 id="sharding-proxy"><a href="#sharding-proxy" class="header-anchor">#</a> Sharding-Proxy</h2> <p><a href="https://shardingsphere.apache.org/document/current/cn/quick-start/shardingsphere-proxy-quick-start/" target="_blank" rel="noopener noreferrer">ShardingSphere-Proxy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 提供基于 YAML 的配置方式，并使用 DistSQL 进行交互。 通过配置，应用开发者可以灵活的使用数据分片、读写分离、数据加密、影子库等功能，并且能够叠加使用。</p> <p>规则配置部分与 ShardingSphere-JDBC 的 YAML 配置完全一致。 DistSQL 与 YAML 配置能够相互取代。</p> <h3 id="应用场景"><a href="#应用场景" class="header-anchor">#</a> 应用场景</h3> <p><img src="https://shardingsphere.apache.org/document/current/img/shardingsphere-proxy_v2.png" alt="Sharding-Proxy"></p> <p>ShardingSphere-Proxy 的定位为透明化的数据库代理，理论上支持任何使用 MySQL、PostgreSQL、openGauss 协议的客户端操作数据，对异构语言、运维场景更友好。</p> <h3 id="使用手册-2"><a href="#使用手册-2" class="header-anchor">#</a> 使用手册</h3> <p>参考官网 <a href="https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/" target="_blank" rel="noopener noreferrer">使用手册<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="配置手册"><a href="#配置手册" class="header-anchor">#</a> 配置手册</h2> <p>本部分是Sharding-JDBC的配置参考手册，需要时可当做字典查阅。</p> <h3 id="java-参考"><a href="#java-参考" class="header-anchor">#</a> java 参考</h3> <p><strong>配置项说明</strong></p> <blockquote><p>数据分片</p></blockquote> <p>ShardingDataSourceFactory 数据分片的数据源创建工厂。</p> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">数据类型</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">dataSourceMap</td> <td style="text-align:center;"><code>Map&lt;String, DataSource&gt;</code></td> <td style="text-align:center;">数据源配置</td></tr> <tr><td style="text-align:center;">shardingRuleConfig</td> <td style="text-align:center;"><code>ShardingRuleConfiguration</code></td> <td style="text-align:center;">数据分片配置规则</td></tr> <tr><td style="text-align:center;">configMap</td> <td style="text-align:center;"><code>Map&lt;String, Object&gt;</code></td> <td style="text-align:center;">用户自定义配置</td></tr> <tr><td style="text-align:center;">props</td> <td style="text-align:center;"><code>Properties</code></td> <td style="text-align:center;">属性配置</td></tr></tbody></table> <p>ShardingRuleConfiguration 分片规则配置对象。</p> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">数据类型</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">tableRuleConfigs</td> <td style="text-align:center;"><code>Collection&lt;TableRuleConfiguration&gt;</code></td> <td style="text-align:center;">分片规则列表</td></tr> <tr><td style="text-align:center;">bindingTableGroups</td> <td style="text-align:center;"><code>Collection&lt;String&gt;</code></td> <td style="text-align:center;">绑定表规则列表</td></tr> <tr><td style="text-align:center;">broadcastTables</td> <td style="text-align:center;"><code>Collection&lt;String&gt;</code></td> <td style="text-align:center;">广播表规则列表</td></tr> <tr><td style="text-align:center;">defaultDataSourceName</td> <td style="text-align:center;"><code>String</code></td> <td style="text-align:center;">未配置分片规则的表将通过默认数据源定位</td></tr> <tr><td style="text-align:center;">defaultDatabaseShardingStrategyConfig</td> <td style="text-align:center;"><code>ShardingStrategyConfiguration</code></td> <td style="text-align:center;">默认分库策略</td></tr> <tr><td style="text-align:center;">defaultTableShardingStrategyConfig</td> <td style="text-align:center;"><code>ShardingStrategyConfiguration</code></td> <td style="text-align:center;">默认分表策略</td></tr> <tr><td style="text-align:center;">defaultKeyGenerator</td> <td style="text-align:center;"><code>KeyGenerator</code></td> <td style="text-align:center;">默认自增列值生成器，缺省使用DefaultKeyGenerator</td></tr> <tr><td style="text-align:center;">masterSlaveRuleConfigs</td> <td style="text-align:center;"><code>Collection&lt;MasterSlaveRuleConfiguration&gt;</code></td> <td style="text-align:center;">读写分离规则，缺省表示不使用读写分离</td></tr></tbody></table> <p>TableRuleConfiguration 表分片规则配置对象。</p> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">数据类型</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">logicTable</td> <td style="text-align:center;"><code>String</code></td> <td style="text-align:center;">逻辑表名称</td></tr> <tr><td style="text-align:center;">actualDataNodes</td> <td style="text-align:center;"><code>String</code></td> <td style="text-align:center;">由数据源名 + 表名组成，以小数点分隔。多个表以逗号分隔，支持inline表达式。缺省表示使用已知数据源与逻辑表名称生成数据节点。用于广播表（即每个库中都需要一个同样的表用于关联查询，多为字典表）或只分库不分表且所有库的表结构完全一致的情况</td></tr> <tr><td style="text-align:center;">databaseShardingStrategyConfig</td> <td style="text-align:center;"><code>ShardingStrategyConfiguration</code></td> <td style="text-align:center;">分库策略，缺省表示使用默认分库策略</td></tr> <tr><td style="text-align:center;">tableShardingStrategyConfig</td> <td style="text-align:center;"><code>ShardingStrategyConfiguration</code></td> <td style="text-align:center;">分表策略，缺省表示使用默认分表策略</td></tr> <tr><td style="text-align:center;">logicIndex</td> <td style="text-align:center;"><code>String</code></td> <td style="text-align:center;">逻辑索引名称，对于分表的Oracle/PostgreSQL数据库中DROP INDEX XXX语句，需要通过配置逻辑索引名称定位所执行SQL的真实分表</td></tr> <tr><td style="text-align:center;">keyGeneratorColumnName</td> <td style="text-align:center;"><code>String</code></td> <td style="text-align:center;">自增列名称，缺省表示不使用自增主键生成器</td></tr> <tr><td style="text-align:center;">keyGenerator</td> <td style="text-align:center;"><code>KeyGenerator</code></td> <td style="text-align:center;">自增列值生成器，缺省表示使用默认自增主键生成器</td></tr></tbody></table> <p>StandardShardingStrategyConfiguration</p> <p>ShardingStrategyConfiguration的实现类，用于单分片键的标准分片场景。</p> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">数据类型</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">shardingColumn</td> <td style="text-align:center;"><code>String</code></td> <td style="text-align:center;">分片列名称</td></tr> <tr><td style="text-align:center;">preciseShardingAlgorithm</td> <td style="text-align:center;"><code>PreciseShardingAlgorithm</code></td> <td style="text-align:center;">精确分片算法，用于=和IN</td></tr> <tr><td style="text-align:center;">rangeShardingAlgorithm</td> <td style="text-align:center;"><code>RangeShardingAlgorithm</code></td> <td style="text-align:center;">范围分片算法，用于BETWEEN</td></tr></tbody></table> <p>ComplexShardingStrategyConfiguration</p> <p>ShardingStrategyConfiguration的实现类，用于多分片键的复合分片场景。</p> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">数据类型</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">shardingColumns</td> <td style="text-align:center;"><code>String</code></td> <td style="text-align:center;">分片列名称，多个列以逗号分隔</td></tr> <tr><td style="text-align:center;">shardingAlgorithm</td> <td style="text-align:center;"><code>ComplexKeysShardingAlgorithm</code></td> <td style="text-align:center;">复合分片算法</td></tr></tbody></table> <p>InlineShardingStrategyConfiguration</p> <p>ShardingStrategyConfiguration的实现类，用于配置行表达式分片策略。</p> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">数据类型</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">shardingColumn</td> <td style="text-align:center;"><code>String</code></td> <td style="text-align:center;">分片列名称</td></tr> <tr><td style="text-align:center;">algorithmExpression</td> <td style="text-align:center;"><code>String</code></td> <td style="text-align:center;">分片算法行表达式，需符合groovy语法，详情请参考 <a href="https://shardingsphere.apache.org/document/legacy/3.x/document/cn/features/sharding/other-features/inline-expression/" target="_blank" rel="noopener noreferrer">行表达式 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td></tr></tbody></table> <p>HintShardingStrategyConfiguration</p> <p>ShardingStrategyConfiguration的实现类，用于配置Hint方式分片策略。</p> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">数据类型</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">shardingAlgorithm</td> <td style="text-align:center;"><code>HintShardingAlgorithm</code></td> <td style="text-align:center;">Hint分片算法</td></tr></tbody></table> <p>NoneShardingStrategyConfiguration</p> <p>ShardingStrategyConfiguration的实现类，用于配置不分片的策略。</p> <p>PropertiesConstant</p> <p>属性配置项，可以为以下属性。</p> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">数据类型</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">sql.show</td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;">是否开启SQL显示，默认值: false</td></tr> <tr><td style="text-align:center;">executor.size</td> <td style="text-align:center;"><code>int</code></td> <td style="text-align:center;">工作线程数量，默认值: CPU核数</td></tr> <tr><td style="text-align:center;">max.connections.size.per.query</td> <td style="text-align:center;"><code>int</code></td> <td style="text-align:center;">每个物理数据库为每次查询分配的最大连接数量。默认值: 1</td></tr> <tr><td style="text-align:center;">check.table.metadata.enabled</td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;">是否在启动时检查分表元数据一致性，默认值: false</td></tr></tbody></table> <p>configMap</p> <p>用户自定义配置。</p> <blockquote><p>读写分离</p></blockquote> <p>MasterSlaveDataSourceFactory 读写分离的数据源创建工厂。</p> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">数据类型</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">dataSourceMap</td> <td style="text-align:center;"><code>Map&lt;String, DataSource&gt;</code></td> <td style="text-align:center;">数据源与其名称的映射</td></tr> <tr><td style="text-align:center;">masterSlaveRuleConfig</td> <td style="text-align:center;"><code>MasterSlaveRuleConfiguration</code></td> <td style="text-align:center;">读写分离规则</td></tr> <tr><td style="text-align:center;">configMap</td> <td style="text-align:center;"><code>Map&lt;String, Object&gt;</code></td> <td style="text-align:center;">用户自定义配置</td></tr> <tr><td style="text-align:center;">props</td> <td style="text-align:center;"><code>Properties</code></td> <td style="text-align:center;">属性配置</td></tr></tbody></table> <p>MasterSlaveRuleConfiguration 读写分离规则配置对象。</p> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">数据类型</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">name</td> <td style="text-align:center;"><code>String</code></td> <td style="text-align:center;">读写分离数据源名称</td></tr> <tr><td style="text-align:center;">masterDataSourceName</td> <td style="text-align:center;"><code>String</code></td> <td style="text-align:center;">主库数据源名称</td></tr> <tr><td style="text-align:center;">slaveDataSourceNames</td> <td style="text-align:center;"><code>Collection&lt;String&gt;</code></td> <td style="text-align:center;">从库数据源名称列表</td></tr> <tr><td style="text-align:center;">loadBalanceAlgorithm</td> <td style="text-align:center;"><code>MasterSlaveLoadBalanceAlgorithm</code></td> <td style="text-align:center;">从库负载均衡算法</td></tr></tbody></table> <p>configMap</p> <p>用户自定义配置。</p> <p>PropertiesConstant</p> <p>属性配置项，可以为以下属性。</p> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">数据类型</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">sql.show</td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;">是否开启SQL显示，默认值: false</td></tr> <tr><td style="text-align:center;">executor.size</td> <td style="text-align:center;"><code>int</code></td> <td style="text-align:center;">用于SQL执行的工作线程数量，为零则表示无限制。默认值: 0</td></tr> <tr><td style="text-align:center;">max.connections.size.per.query</td> <td style="text-align:center;"><code>int</code></td> <td style="text-align:center;">每个物理数据库为每次查询分配的最大连接数量。默认值: 1</td></tr> <tr><td style="text-align:center;">check.table.metadata.enabled</td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;">是否在启动时检查分表元数据一致性，默认值: false</td></tr></tbody></table> <blockquote><p>数据治理</p></blockquote> <p>OrchestrationShardingDataSourceFactory</p> <p>数据分片 + 数据治理的数据源工厂。</p> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">数据类型</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">dataSourceMap</td> <td style="text-align:center;"><code>Map&lt;String, DataSource&gt;</code></td> <td style="text-align:center;">同ShardingDataSourceFactory</td></tr> <tr><td style="text-align:center;">shardingRuleConfig</td> <td style="text-align:center;"><code>ShardingRuleConfiguration</code></td> <td style="text-align:center;">同ShardingDataSourceFactory</td></tr> <tr><td style="text-align:center;">configMap</td> <td style="text-align:center;"><code>Map&lt;String, Object&gt;</code></td> <td style="text-align:center;">同ShardingDataSourceFactory</td></tr> <tr><td style="text-align:center;">props</td> <td style="text-align:center;"><code>Properties</code></td> <td style="text-align:center;">同ShardingDataSourceFactory</td></tr> <tr><td style="text-align:center;">orchestrationConfig</td> <td style="text-align:center;"><code>OrchestrationConfiguration</code></td> <td style="text-align:center;">数据治理规则配置</td></tr></tbody></table> <p>OrchestrationMasterSlaveDataSourceFactory</p> <p>读写分离 + 数据治理的数据源工厂。</p> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">数据类型</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">dataSourceMap</td> <td style="text-align:center;"><code>Map&lt;String, DataSource&gt;</code></td> <td style="text-align:center;">同MasterSlaveDataSourceFactory</td></tr> <tr><td style="text-align:center;">masterSlaveRuleConfig</td> <td style="text-align:center;"><code>MasterSlaveRuleConfiguration</code></td> <td style="text-align:center;">同MasterSlaveDataSourceFactory</td></tr> <tr><td style="text-align:center;">configMap</td> <td style="text-align:center;"><code>Map&lt;String, Object&gt;</code></td> <td style="text-align:center;">同MasterSlaveDataSourceFactory</td></tr> <tr><td style="text-align:center;">props</td> <td style="text-align:center;"><code>Properties</code></td> <td style="text-align:center;">同MasterSlaveDataSourceFactory</td></tr> <tr><td style="text-align:center;">orchestrationConfig</td> <td style="text-align:center;"><code>OrchestrationConfiguration</code></td> <td style="text-align:center;">数据治理规则配置</td></tr></tbody></table> <p>OrchestrationConfiguration</p> <p>数据治理规则配置对象。</p> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">数据类型</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">name</td> <td style="text-align:center;"><code>String</code></td> <td style="text-align:center;">数据治理实例名称</td></tr> <tr><td style="text-align:center;">overwrite</td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;">本地配置是否覆盖注册中心配置，如果可覆盖，每次启动都以本地配置为准</td></tr> <tr><td style="text-align:center;">regCenterConfig</td> <td style="text-align:center;"><code>RegistryCenterConfiguration</code></td> <td style="text-align:center;">注册中心配置</td></tr></tbody></table> <p>RegistryCenterConfiguration</p> <p>用于配置注册中心。</p> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">数据类型</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">serverLists</td> <td style="text-align:center;"><code>String</code></td> <td style="text-align:center;">连接注册中心服务器的列表。包括IP地址和端口号。多个地址用逗号分隔。如: host1:2181,host2:2181</td></tr> <tr><td style="text-align:center;">namespace</td> <td style="text-align:center;"><code>String</code></td> <td style="text-align:center;">注册中心的命名空间</td></tr> <tr><td style="text-align:center;">digest</td> <td style="text-align:center;"><code>String</code></td> <td style="text-align:center;">连接注册中心的权限令牌。缺省为不需要权限验证</td></tr> <tr><td style="text-align:center;">operationTimeoutMilliseconds</td> <td style="text-align:center;"><code>int</code></td> <td style="text-align:center;">操作超时的毫秒数，默认500毫秒</td></tr> <tr><td style="text-align:center;">maxRetries</td> <td style="text-align:center;"><code>int</code></td> <td style="text-align:center;">连接失败后的最大重试次数，默认3次</td></tr> <tr><td style="text-align:center;">retryIntervalMilliseconds</td> <td style="text-align:center;"><code>int</code></td> <td style="text-align:center;">重试间隔毫秒数，默认500毫秒</td></tr> <tr><td style="text-align:center;">timeToLiveSeconds</td> <td style="text-align:center;"><code>int</code></td> <td style="text-align:center;">临时节点存活秒数，默认60秒</td></tr></tbody></table> <h3 id="yaml-参考"><a href="#yaml-参考" class="header-anchor">#</a> yaml 参考</h3> <p><strong>配置项说明</strong>
config-xxx.yaml 数据分片+读写分离</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token comment"># 以下配置截止版本为3.1</span>
<span class="token comment"># 配置文件中,必须配置的项目为schemaName,dataSources,并且sharidngRule,masterSlaveRule,配置其中一个(注意,除非server.yaml中定义了Orchestration,否则必须至少有一个config-xxxx配置文件),除此之外的其他项目为可选项</span>
<span class="token key atrule">schemaName</span><span class="token punctuation">:</span> test <span class="token comment"># schema名称,每个文件都是单独的schema,多个schema则是多个yaml文件,yaml文件命名要求是config-xxxx.yaml格式,虽然没有强制要求,但推荐名称中的xxxx与配置的schemaName保持一致,方便维护</span>

<span class="token key atrule">dataSources</span><span class="token punctuation">:</span> <span class="token comment"># 配置数据源列表,必须是有效的jdbc配置,目前仅支持MySQL与PostgreSQL,另外通过一些未公开(代码中可查,但可能会在未来有变化)的变量,可以配置来兼容其他支持JDBC的数据库,但由于没有足够的测试支持,可能会有严重的兼容性问题,配置时候要求至少有一个</span>
 <span class="token key atrule">master_ds_0</span><span class="token punctuation">:</span> <span class="token comment"># 数据源名称,可以是合法的字符串,目前的校验规则中,没有强制性要求,只要是合法的yaml字符串即可,但如果要用于分库分表配置,则需要有有意义的标志(在分库分表配置中详述),以下为目前公开的合法配置项目,不包含内部配置参数</span>
   <span class="token comment"># 以下参数为必备参数</span>
   <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/demo_ds_slave_1<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;amp;useSSL=false</span> <span class="token comment"># 这里的要求合法的jdbc连接串即可,目前尚未兼容MySQL 8.x,需要在maven编译时候,升级MySQL JDBC版本到5.1.46或者47版本(不建议升级到JDBC的8.x系列版本,需要修改源代码,并且无法通过很多测试case)</span>
   <span class="token key atrule">username</span><span class="token punctuation">:</span> root <span class="token comment"># MySQL用户名</span>
   <span class="token key atrule">password</span><span class="token punctuation">:</span> password <span class="token comment"># MySQL用户的明文密码</span>
   <span class="token comment"># 以下参数为可选参数,给出示例为默认配置,主要用于连接池控制</span>
   <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span> <span class="token comment">#连接超时控制</span>
   <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span> <span class="token comment"># 连接空闲时间设置</span>
   <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token comment"># 连接的最大持有时间,0为无限制</span>
   <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span> <span class="token comment"># 连接池中最大维持的连接数量</span>
   <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># 连接池的最小连接数量</span>
   <span class="token key atrule">maintenanceIntervalMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span> <span class="token comment"># 连接维护的时间间隔 atomikos框架需求</span>
 <span class="token comment"># 以下配置的假设是,3307是3306的从库,3309,3310是3308的从库</span>
 <span class="token key atrule">slave_ds_0</span><span class="token punctuation">:</span>
   <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3307/demo_ds_slave_1<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;amp;useSSL=false</span>
   <span class="token key atrule">username</span><span class="token punctuation">:</span> root
   <span class="token key atrule">password</span><span class="token punctuation">:</span> password
 <span class="token key atrule">master_ds_1</span><span class="token punctuation">:</span>
   <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3308/demo_ds_slave_1<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;amp;useSSL=false</span>
   <span class="token key atrule">username</span><span class="token punctuation">:</span> root
   <span class="token key atrule">password</span><span class="token punctuation">:</span> password
 <span class="token key atrule">slave_ds_1</span><span class="token punctuation">:</span>
   <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3309/demo_ds_slave_1<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;amp;useSSL=false</span>
   <span class="token key atrule">username</span><span class="token punctuation">:</span> root
   <span class="token key atrule">password</span><span class="token punctuation">:</span> password
 <span class="token key atrule">slave_ds_1_slave2</span><span class="token punctuation">:</span>
   <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3310/demo_ds_slave_1<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;amp;useSSL=false</span>
   <span class="token key atrule">username</span><span class="token punctuation">:</span> root
   <span class="token key atrule">password</span><span class="token punctuation">:</span> password
<span class="token key atrule">masterSlaveRule</span><span class="token punctuation">:</span> <span class="token comment"># 这里配置这个规则的话,相当于是全局读写分离配置</span>
 <span class="token key atrule">name</span><span class="token punctuation">:</span> ds_rw <span class="token comment"># 名称,合法的字符串即可,但如果涉及到在读写分离的基础上设置分库分表,则名称需要有意义才可以,另外,虽然目前没有强制要求,但主从库配置需要配置在实际关联的主从库上,如果配置的数据源之间主从是断开的状态,那么可能会发生写入的数据对于只读会话无法读取到的问题</span>
 <span class="token comment"># 如果一个会话发生了写入并且没有提交(显式打开事务),sharidng sphere在后续的路由中,select都会在主库执行,直到会话提交</span>
 <span class="token key atrule">masterDataSourceName</span><span class="token punctuation">:</span> master_ds_0 <span class="token comment"># 主库的DataSource名称</span>
 <span class="token key atrule">slaveDataSourceNames</span><span class="token punctuation">:</span> <span class="token comment"># 从库的DataSource列表,至少需要有一个</span>
   <span class="token punctuation">-</span> slave_ds_0
 <span class="token key atrule">loadBalanceAlgorithmClassName</span><span class="token punctuation">:</span> io.shardingsphere.api.algorithm.masterslave <span class="token comment"># MasterSlaveLoadBalanceAlgorithm接口的实现类,允许自定义实现 默认提供两个,配置路径为io.shardingsphere.api.algorithm.masterslave下的RandomMasterSlaveLoadBalanceAlgorithm(随机Random)与RoundRobinMasterSlaveLoadBalanceAlgorithm(轮询:次数%从库数量)</span>
 <span class="token key atrule">loadBalanceAlgorithmType</span><span class="token punctuation">:</span> <span class="token comment">#从库负载均衡算法类型，可选值：ROUND_ROBIN，RANDOM。若loadBalanceAlgorithmClassName存在则忽略该配置,默认为ROUND_ROBIN</span>

<span class="token key atrule">shardingRule</span><span class="token punctuation">:</span> <span class="token comment"># sharding的配置</span>
 <span class="token comment"># 配置主要分两类,一类是对整个sharding规则所有表生效的默认配置,一个是sharing具体某张表时候的配置</span>
 <span class="token comment"># 首先说默认配置</span>
 <span class="token key atrule">masterSlaveRules</span><span class="token punctuation">:</span> <span class="token comment"># 在shardingRule中也可以配置shardingRule,对分片生效,具体内容与全局masterSlaveRule一致,但语法为:</span>
   <span class="token key atrule">master_test_0</span><span class="token punctuation">:</span>
     <span class="token key atrule">masterDataSourceName</span><span class="token punctuation">:</span> master_ds_0
     <span class="token key atrule">slaveDataSourceNames</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> slave_ds_0
   <span class="token key atrule">master_test_1</span><span class="token punctuation">:</span>
     <span class="token key atrule">masterDataSourceName</span><span class="token punctuation">:</span> master_ds_1
     <span class="token key atrule">slaveDataSourceNames</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> slave_ds_1
       <span class="token punctuation">-</span> slave_ds_1_slave2
 <span class="token key atrule">defaultDataSourceName</span><span class="token punctuation">:</span> master_test_0 <span class="token comment"># 这里的数据源允许是dataSources的配置项目或者masterSlaveRules配置的名称,配置为masterSlaveRule的话相当于就是配置读写分离了</span>
 <span class="token key atrule">broadcastTables</span><span class="token punctuation">:</span> <span class="token comment"># 广播表 这里配置的表列表,对于发生的所有数据变更,都会不经sharidng处理,而是直接发送到所有数据节点,注意此处为列表,每个项目为一个表名称</span>
   <span class="token punctuation">-</span> broad_1
   <span class="token punctuation">-</span> broad_2
 <span class="token key atrule">bindingTables</span><span class="token punctuation">:</span> <span class="token comment"># 绑定表,也就是实际上哪些配置的sharidng表规则需要实际生效的列表,配置为yaml列表,并且允许单个条目中以逗号切割,所配置表必须已经配置为逻辑表</span>
   <span class="token punctuation">-</span> sharding_t1
   <span class="token punctuation">-</span> sharding_t2<span class="token punctuation">,</span>sharding_t3
 <span class="token key atrule">defaultDatabaseShardingStrategy</span><span class="token punctuation">:</span> <span class="token comment"># 默认库级别sharidng规则,对应代码中ShardingStrategy接口的实现类,目前支持none,inline,hint,complex,standard五种配置 注意此处默认配置仅可以配置五个中的一个</span>
 <span class="token comment"># 规则配置同样适合表sharding配置,同样是在这些算法中选择</span>
   <span class="token key atrule">none</span><span class="token punctuation">:</span> <span class="token comment"># 不配置任何规则,SQL会被发给所有节点去执行,这个规则没有子项目可以配置</span>
   <span class="token key atrule">inline</span><span class="token punctuation">:</span> <span class="token comment"># 行表达式分片</span>
     <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> test_id <span class="token comment"># 分片列名称</span>
     <span class="token key atrule">algorithmExpression</span><span class="token punctuation">:</span> master_test_$<span class="token punctuation">{</span>test_id % 2<span class="token punctuation">}</span> <span class="token comment"># 分片表达式,根据指定的表达式计算得到需要路由到的数据源名称 需要是合法的groovy表达式,示例配置中,取余为0则语句路由到master_test_0,取余为1则路由到master_test_1</span>
   <span class="token key atrule">hint</span><span class="token punctuation">:</span> <span class="token comment">#基于标记的sharding分片</span>
     <span class="token key atrule">shardingAlgorithm</span><span class="token punctuation">:</span> <span class="token comment"># 需要是HintShardingAlgorithm接口的实现,目前代码中,仅有为测试目的实现的OrderDatabaseHintShardingAlgorithm,没有生产环境可用的实现</span>
   <span class="token key atrule">complex</span><span class="token punctuation">:</span> <span class="token comment"># 支持多列的shariding,目前无生产可用实现</span>
     <span class="token key atrule">shardingColumns</span><span class="token punctuation">:</span> <span class="token comment"># 逗号切割的列</span>
     <span class="token key atrule">shardingAlgorithm</span><span class="token punctuation">:</span> <span class="token comment"># ComplexKeysShardingAlgorithm接口的实现类</span>
   <span class="token key atrule">standard</span><span class="token punctuation">:</span> <span class="token comment"># 单列sharidng算法,需要配合对应的preciseShardingAlgorithm,rangeShardingAlgorithm接口的实现使用,目前无生产可用实现</span>
     <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> <span class="token comment"># 列名,允许单列</span>
     <span class="token key atrule">preciseShardingAlgorithm</span><span class="token punctuation">:</span> <span class="token comment"># preciseShardingAlgorithm接口的实现类</span>
     <span class="token key atrule">rangeShardingAlgorithm</span><span class="token punctuation">:</span> <span class="token comment"># rangeShardingAlgorithm接口的实现类</span>
 <span class="token key atrule">defaultTableStrategy</span><span class="token punctuation">:</span> <span class="token comment">#配置参考defaultDatabaseShardingStrategy,区别在于,inline算法的配置中,algorithmExpression的配置算法结果需要是实际的物理表名称,而非数据源名称</span>
 <span class="token key atrule">defaultKeyGenerator</span><span class="token punctuation">:</span> <span class="token comment">#默认的主键生成算法 如果没有设置,默认为SNOWFLAKE算法</span>
   <span class="token key atrule">column</span><span class="token punctuation">:</span> <span class="token comment"># 自增键对应的列名称</span>
   <span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token comment">#自增键的类型,主要用于调用内置的主键生成算法有三个可用值:SNOWFLAKE(时间戳+worker id+自增id),UUID(java.util.UUID类生成的随机UUID),LEAF,其中Snowflake算法与UUID算法已经实现,LEAF目前(2018-01-14)尚未实现</span>
   <span class="token key atrule">className</span><span class="token punctuation">:</span> <span class="token comment"># 非内置的其他实现了KeyGenerator接口的类,需要注意,如果设置这个,就不能设置type,否则type的设置会覆盖class的设置</span>
   <span class="token key atrule">props</span><span class="token punctuation">:</span>
     <span class="token comment"># 定制算法需要设置的参数,比如SNOWFLAKE算法的worker.id与max.tolerate.time.difference.milliseconds</span>
 <span class="token key atrule">tables</span><span class="token punctuation">:</span> <span class="token comment">#配置表sharding的主要位置</span>
   <span class="token key atrule">sharding_t1</span><span class="token punctuation">:</span>
     <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> master_test_$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>.t_order$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span> <span class="token comment"># sharidng 表对应的数据源以及物理名称,需要用表达式处理,表示表实际上在哪些数据源存在,配置示例中,意思是总共存在4个分片master_test_0.t_order0,master_test_0.t_order1,master_test_1.t_order0,master_test_1.t_order1</span>
     <span class="token comment"># 需要注意的是,必须保证设置databaseStrategy可以路由到唯一的dataSource,tableStrategy可以路由到dataSource中唯一的物理表上,否则可能导致错误:一个insert语句被插入到多个实际物理表中</span>
     <span class="token key atrule">databaseStrategy</span><span class="token punctuation">:</span> <span class="token comment"># 局部设置会覆盖全局设置,参考defaultDatabaseShardingStrategy</span>
     <span class="token key atrule">tableStrategy</span><span class="token punctuation">:</span> <span class="token comment"># 局部设置会覆盖全局设置,参考defaultTableStrategy</span>
     <span class="token key atrule">keyGenerator</span><span class="token punctuation">:</span> <span class="token comment"># 局部设置会覆盖全局设置,参考defaultKeyGenerator</span>
     <span class="token key atrule">logicIndex</span><span class="token punctuation">:</span> <span class="token comment"># 逻辑索引名称 由于Oracle,PG这种数据库中,索引与表共用命名空间,如果接受到drop index语句,执行之前,会通过这个名称配置的确定对应的实际物理表名称</span>
<span class="token key atrule">props</span><span class="token punctuation">:</span>
 <span class="token key atrule">sql.show</span><span class="token punctuation">:</span> <span class="token comment">#是否开启SQL显示，默认值: false</span>
 <span class="token key atrule">acceptor.size</span><span class="token punctuation">:</span> <span class="token comment"># accept连接的线程数量,默认为cpu核数2倍</span>
 <span class="token key atrule">executor.size</span><span class="token punctuation">:</span> <span class="token comment">#工作线程数量最大，默认值: 无限制</span>
 <span class="token key atrule">max.connections.size.per.query</span><span class="token punctuation">:</span> <span class="token comment"># 每个查询可以打开的最大连接数量,默认为1</span>
 <span class="token key atrule">proxy.frontend.flush.threshold</span><span class="token punctuation">:</span> <span class="token comment"># proxy的服务时候,对于单个大查询,每多少个网络包返回一次</span>
 <span class="token key atrule">check.table.metadata.enabled</span><span class="token punctuation">:</span> <span class="token comment">#是否在启动时检查分表元数据一致性，默认值: false</span>
 <span class="token key atrule">proxy.transaction.type</span><span class="token punctuation">:</span> <span class="token comment"># 默认LOCAL,proxy的事务模型 允许LOCAL,XA,BASE三个值 LOCAL无分布式事务,XA则是采用atomikos实现的分布式事务 BASE目前尚未实现</span>
 <span class="token key atrule">proxy.opentracing.enabled</span><span class="token punctuation">:</span> <span class="token comment"># 是否启用opentracing</span>
 <span class="token key atrule">proxy.backend.use.nio</span><span class="token punctuation">:</span> <span class="token comment"># 是否采用netty的NIO机制连接后端数据库,默认False ,使用epoll机制</span>
 <span class="token key atrule">proxy.backend.max.connections</span><span class="token punctuation">:</span> <span class="token comment"># 使用NIO而非epoll的话,proxy后台连接每个netty客户端允许的最大连接数量(注意不是数据库连接限制) 默认为8</span>
 <span class="token key atrule">proxy.backend.connection.timeout.seconds</span><span class="token punctuation">:</span> <span class="token comment">#使用nio而非epoll的话,proxy后台连接的超时时间,默认60s</span>
 <span class="token key atrule">check.table.metadata.enabled</span><span class="token punctuation">:</span> <span class="token comment"># 是否在启动时候,检查sharing的表的实际元数据是否一致,默认False</span>

 
<span class="token key atrule">configMap</span><span class="token punctuation">:</span> <span class="token comment">#用户自定义配置</span>
 <span class="token key atrule">key1</span><span class="token punctuation">:</span> value1
 <span class="token key atrule">key2</span><span class="token punctuation">:</span> value2
 <span class="token key atrule">keyx</span><span class="token punctuation">:</span> valuex

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br></div></div><p><strong>读写分离</strong></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">dataSources</span><span class="token punctuation">:</span> <span class="token comment">#省略数据源配置，与数据分片一致</span>

<span class="token key atrule">masterSlaveRule</span><span class="token punctuation">:</span>
 <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token comment">#读写分离数据源名称</span>
 <span class="token key atrule">masterDataSourceName</span><span class="token punctuation">:</span> <span class="token comment">#主库数据源名称</span>
 <span class="token key atrule">slaveDataSourceNames</span><span class="token punctuation">:</span> <span class="token comment">#从库数据源名称列表</span>
   <span class="token punctuation">-</span> &lt;data_source_name1<span class="token punctuation">&gt;</span>
   <span class="token punctuation">-</span> &lt;data_source_name2<span class="token punctuation">&gt;</span>
   <span class="token punctuation">-</span> &lt;data_source_name_x<span class="token punctuation">&gt;</span>
 <span class="token key atrule">loadBalanceAlgorithmClassName</span><span class="token punctuation">:</span> <span class="token comment">#从库负载均衡算法类名称。该类需实现MasterSlaveLoadBalanceAlgorithm接口且提供无参数构造器</span>
 <span class="token key atrule">loadBalanceAlgorithmType</span><span class="token punctuation">:</span> <span class="token comment">#从库负载均衡算法类型，可选值：ROUND_ROBIN，RANDOM。若`loadBalanceAlgorithmClassName`存在则忽略该配置</span>
   
<span class="token key atrule">props</span><span class="token punctuation">:</span> <span class="token comment">#属性配置</span>
 <span class="token key atrule">sql.show</span><span class="token punctuation">:</span> <span class="token comment">#是否开启SQL显示，默认值: false</span>
 <span class="token key atrule">executor.size</span><span class="token punctuation">:</span> <span class="token comment">#工作线程数量，默认值: CPU核数</span>
 <span class="token key atrule">check.table.metadata.enabled</span><span class="token punctuation">:</span> <span class="token comment">#是否在启动时检查分表元数据一致性，默认值: false</span>
 
<span class="token key atrule">configMap</span><span class="token punctuation">:</span> <span class="token comment">#用户自定义配置</span>
 <span class="token key atrule">key1</span><span class="token punctuation">:</span> value1
 <span class="token key atrule">key2</span><span class="token punctuation">:</span> value2
 <span class="token key atrule">keyx</span><span class="token punctuation">:</span> valuex

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><strong>数据治理</strong></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">dataSources</span><span class="token punctuation">:</span> <span class="token comment">#省略数据源配置</span>
<span class="token key atrule">shardingRule</span><span class="token punctuation">:</span> <span class="token comment">#省略分片规则配置</span>
<span class="token key atrule">masterSlaveRule</span><span class="token punctuation">:</span> <span class="token comment">#省略读写分离规则配置</span>

<span class="token key atrule">orchestration</span><span class="token punctuation">:</span>
 <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token comment">#数据治理实例名称</span>
 <span class="token key atrule">overwrite</span><span class="token punctuation">:</span> <span class="token comment">#本地配置是否覆盖注册中心配置。如果可覆盖，每次启动都以本地配置为准</span>
 <span class="token key atrule">registry</span><span class="token punctuation">:</span> <span class="token comment">#注册中心配置</span>
   <span class="token key atrule">serverLists</span><span class="token punctuation">:</span> <span class="token comment">#连接注册中心服务器的列表。包括IP地址和端口号。多个地址用逗号分隔。如: host1:2181,host2:2181</span>
   <span class="token key atrule">namespace</span><span class="token punctuation">:</span> <span class="token comment">#注册中心的命名空间</span>
   <span class="token key atrule">digest</span><span class="token punctuation">:</span> <span class="token comment">#连接注册中心的权限令牌。缺省为不需要权限验证</span>
   <span class="token key atrule">operationTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token comment">#操作超时的毫秒数，默认500毫秒</span>
   <span class="token key atrule">maxRetries</span><span class="token punctuation">:</span> <span class="token comment">#连接失败后的最大重试次数，默认3次</span>
   <span class="token key atrule">retryIntervalMilliseconds</span><span class="token punctuation">:</span> <span class="token comment">#重试间隔毫秒数，默认500毫秒</span>
   <span class="token key atrule">timeToLiveSeconds</span><span class="token punctuation">:</span> <span class="token comment">#临时节点存活秒数，默认60秒</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>Yaml语法说明</strong></p> <p><code>!!</code>  表示实例化该类</p> <p><code>-</code>  表示可以包含一个或多个</p> <p><code>[]</code>  表示数组，可以与减号相互替换使用</p> <h3 id="properties-参考"><a href="#properties-参考" class="header-anchor">#</a> properties 参考</h3> <p><strong>数据分片</strong></p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">sharding.jdbc.datasource.names</span><span class="token punctuation">=</span> <span class="token value attr-value">#数据源名称，多数据源以逗号分隔</span>

<span class="token key attr-name">sharding.jdbc.datasource.&lt;data-source-name&gt;.type</span><span class="token punctuation">=</span> <span class="token value attr-value">#数据库连接池类名称</span>
<span class="token key attr-name">sharding.jdbc.datasource.&lt;data-source-name&gt;.driver-class-name</span><span class="token punctuation">=</span> <span class="token value attr-value">#数据库驱动类名</span>
<span class="token key attr-name">sharding.jdbc.datasource.&lt;data-source-name&gt;.url</span><span class="token punctuation">=</span> <span class="token value attr-value">#数据库url连接</span>
<span class="token key attr-name">sharding.jdbc.datasource.&lt;data-source-name&gt;.username</span><span class="token punctuation">=</span> <span class="token value attr-value">#数据库用户名</span>
<span class="token key attr-name">sharding.jdbc.datasource.&lt;data-source-name&gt;.password</span><span class="token punctuation">=</span> <span class="token value attr-value">#数据库密码</span>
<span class="token key attr-name">sharding.jdbc.datasource.&lt;data-source-name&gt;.xxx</span><span class="token punctuation">=</span> <span class="token value attr-value">#数据库连接池的其它属性</span>

<span class="token key attr-name">sharding.jdbc.config.sharding.tables.&lt;logic-table-name&gt;.actual-data-nodes</span><span class="token punctuation">=</span> <span class="token value attr-value">#由数据源名 + 表名组成，以小数点分隔。多个表以逗号分隔，支持inline表达式。缺省表示使用已知数据源与逻辑表名称生成数据节点。用于广播表（即每个库中都需要一个同样的表用于关联查询，多为字典表）或只分库不分表且所有库的表结构完全一致的情况</span>

<span class="token comment">#分库策略，缺省表示使用默认分库策略，以下的分片策略只能选其一</span>

<span class="token comment">#用于单分片键的标准分片场景</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.tables.&lt;logic-table-name&gt;.database-strategy.standard.sharding-column</span><span class="token punctuation">=</span> <span class="token value attr-value">#分片列名称</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.tables.&lt;logic-table-name&gt;.database-strategy.standard.precise-algorithm-class-name</span><span class="token punctuation">=</span> <span class="token value attr-value">#精确分片算法类名称，用于=和IN。该类需实现PreciseShardingAlgorithm接口并提供无参数的构造器</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.tables.&lt;logic-table-name&gt;.database-strategy.standard.range-algorithm-class-name</span><span class="token punctuation">=</span> <span class="token value attr-value">#范围分片算法类名称，用于BETWEEN，可选。该类需实现RangeShardingAlgorithm接口并提供无参数的构造器</span>

<span class="token comment">#用于多分片键的复合分片场景</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.tables.&lt;logic-table-name&gt;.database-strategy.complex.sharding-columns</span><span class="token punctuation">=</span> <span class="token value attr-value">#分片列名称，多个列以逗号分隔</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.tables.&lt;logic-table-name&gt;.database-strategy.complex.algorithm-class-name</span><span class="token punctuation">=</span> <span class="token value attr-value">#复合分片算法类名称。该类需实现ComplexKeysShardingAlgorithm接口并提供无参数的构造器</span>

<span class="token comment">#行表达式分片策略</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.tables.&lt;logic-table-name&gt;.database-strategy.inline.sharding-column</span><span class="token punctuation">=</span> <span class="token value attr-value">#分片列名称</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.tables.&lt;logic-table-name&gt;.database-strategy.inline.algorithm-expression</span><span class="token punctuation">=</span> <span class="token value attr-value">#分片算法行表达式，需符合groovy语法</span>

<span class="token comment">#Hint分片策略</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.tables.&lt;logic-table-name&gt;.database-strategy.hint.algorithm-class-name</span><span class="token punctuation">=</span> <span class="token value attr-value">#Hint分片算法类名称。该类需实现HintShardingAlgorithm接口并提供无参数的构造器</span>

<span class="token comment">#分表策略，同分库策略</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.tables.&lt;logic-table-name&gt;.table-strategy.xxx</span><span class="token punctuation">=</span> <span class="token value attr-value">#省略</span>

<span class="token key attr-name">sharding.jdbc.config.sharding.tables.&lt;logic-table-name&gt;.key-generator-column-name</span><span class="token punctuation">=</span> <span class="token value attr-value">#自增列名称，缺省表示不使用自增主键生成器</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.tables.&lt;logic-table-name&gt;.key-generator-class-name</span><span class="token punctuation">=</span> <span class="token value attr-value">#自增列值生成器类名称，缺省表示使用默认自增列值生成器。该类需提供无参数的构造器</span>

<span class="token key attr-name">sharding.jdbc.config.sharding.tables.&lt;logic-table-name&gt;.logic-index</span><span class="token punctuation">=</span> <span class="token value attr-value">#逻辑索引名称，对于分表的Oracle/PostgreSQL数据库中DROP INDEX XXX语句，需要通过配置逻辑索引名称定位所执行SQL的真实分表</span>

<span class="token key attr-name">sharding.jdbc.config.sharding.binding-tables[0]</span><span class="token punctuation">=</span> <span class="token value attr-value">#绑定表规则列表</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.binding-tables[1]</span><span class="token punctuation">=</span> <span class="token value attr-value">#绑定表规则列表</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.binding-tables[x]</span><span class="token punctuation">=</span> <span class="token value attr-value">#绑定表规则列表</span>

<span class="token key attr-name">sharding.jdbc.config.sharding.broadcast-tables[0]</span><span class="token punctuation">=</span> <span class="token value attr-value">#广播表规则列表</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.broadcast-tables[1]</span><span class="token punctuation">=</span> <span class="token value attr-value">#广播表规则列表</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.broadcast-tables[x]</span><span class="token punctuation">=</span> <span class="token value attr-value">#广播表规则列表</span>

<span class="token key attr-name">sharding.jdbc.config.sharding.default-data-source-name</span><span class="token punctuation">=</span> <span class="token value attr-value">#未配置分片规则的表将通过默认数据源定位</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.default-database-strategy.xxx</span><span class="token punctuation">=</span> <span class="token value attr-value">#默认数据库分片策略，同分库策略</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.default-table-strategy.xxx</span><span class="token punctuation">=</span> <span class="token value attr-value">#默认表分片策略，同分表策略</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.default-key-generator-class-name</span><span class="token punctuation">=</span> <span class="token value attr-value">#默认自增列值生成器类名称，缺省使用io.shardingsphere.core.keygen.DefaultKeyGenerator。该类需实现KeyGenerator接口并提供无参数的构造器</span>

<span class="token key attr-name">sharding.jdbc.config.sharding.master-slave-rules.&lt;master-slave-data-source-name&gt;.master-data-source-name</span><span class="token punctuation">=</span> <span class="token value attr-value">#详见读写分离部分</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.master-slave-rules.&lt;master-slave-data-source-name&gt;.slave-data-source-names[0]</span><span class="token punctuation">=</span> <span class="token value attr-value">#详见读写分离部分</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.master-slave-rules.&lt;master-slave-data-source-name&gt;.slave-data-source-names[1]</span><span class="token punctuation">=</span> <span class="token value attr-value">#详见读写分离部分</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.master-slave-rules.&lt;master-slave-data-source-name&gt;.slave-data-source-names[x]</span><span class="token punctuation">=</span> <span class="token value attr-value">#详见读写分离部分</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.master-slave-rules.&lt;master-slave-data-source-name&gt;.load-balance-algorithm-class-name</span><span class="token punctuation">=</span> <span class="token value attr-value">#详见读写分离部分</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.master-slave-rules.&lt;master-slave-data-source-name&gt;.load-balance-algorithm-type</span><span class="token punctuation">=</span> <span class="token value attr-value">#详见读写分离部分</span>
<span class="token key attr-name">sharding.jdbc.config.config.map.key1</span><span class="token punctuation">=</span> <span class="token value attr-value">#详见读写分离部分</span>
<span class="token key attr-name">sharding.jdbc.config.config.map.key2</span><span class="token punctuation">=</span> <span class="token value attr-value">#详见读写分离部分</span>
<span class="token key attr-name">sharding.jdbc.config.config.map.keyx</span><span class="token punctuation">=</span> <span class="token value attr-value">#详见读写分离部分</span>

<span class="token key attr-name">sharding.jdbc.config.props.sql.show</span><span class="token punctuation">=</span> <span class="token value attr-value">#是否开启SQL显示，默认值: false</span>
<span class="token key attr-name">sharding.jdbc.config.props.executor.size</span><span class="token punctuation">=</span> <span class="token value attr-value">#工作线程数量，默认值: CPU核数</span>

<span class="token key attr-name">sharding.jdbc.config.config.map.key1</span><span class="token punctuation">=</span> <span class="token value attr-value">#用户自定义配置</span>
<span class="token key attr-name">sharding.jdbc.config.config.map.key2</span><span class="token punctuation">=</span> <span class="token value attr-value">#用户自定义配置</span>
<span class="token key attr-name">sharding.jdbc.config.config.map.keyx</span><span class="token punctuation">=</span> <span class="token value attr-value">#用户自定义配置</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><p><strong>读写分离</strong></p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#省略数据源配置，与数据分片一致</span>

<span class="token key attr-name">sharding.jdbc.config.sharding.master-slave-rules.&lt;master-slave-data-source-name&gt;.master-data-source-name</span><span class="token punctuation">=</span> <span class="token value attr-value">#主库数据源名称</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.master-slave-rules.&lt;master-slave-data-source-name&gt;.slave-data-source-names[0]</span><span class="token punctuation">=</span> <span class="token value attr-value">#从库数据源名称列表</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.master-slave-rules.&lt;master-slave-data-source-name&gt;.slave-data-source-names[1]</span><span class="token punctuation">=</span> <span class="token value attr-value">#从库数据源名称列表</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.master-slave-rules.&lt;master-slave-data-source-name&gt;.slave-data-source-names[x]</span><span class="token punctuation">=</span> <span class="token value attr-value">#从库数据源名称列表</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.master-slave-rules.&lt;master-slave-data-source-name&gt;.load-balance-algorithm-class-name</span><span class="token punctuation">=</span> <span class="token value attr-value">#从库负载均衡算法类名称。该类需实现MasterSlaveLoadBalanceAlgorithm接口且提供无参数构造器</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.master-slave-rules.&lt;master-slave-data-source-name&gt;.load-balance-algorithm-type</span><span class="token punctuation">=</span> <span class="token value attr-value">#从库负载均衡算法类型，可选值：ROUND_ROBIN，RANDOM。若`load-balance-algorithm-class-name`存在则忽略该配置</span>

<span class="token key attr-name">sharding.jdbc.config.config.map.key1</span><span class="token punctuation">=</span> <span class="token value attr-value">#用户自定义配置</span>
<span class="token key attr-name">sharding.jdbc.config.config.map.key2</span><span class="token punctuation">=</span> <span class="token value attr-value">#用户自定义配置</span>
<span class="token key attr-name">sharding.jdbc.config.config.map.keyx</span><span class="token punctuation">=</span> <span class="token value attr-value">#用户自定义配置</span>

<span class="token key attr-name">sharding.jdbc.config.props.sql.show</span><span class="token punctuation">=</span> <span class="token value attr-value">#是否开启SQL显示，默认值: false</span>
<span class="token key attr-name">sharding.jdbc.config.props.executor.size</span><span class="token punctuation">=</span> <span class="token value attr-value">#工作线程数量，默认值: CPU核数</span>
<span class="token key attr-name">sharding.jdbc.config.props.check.table.metadata.enabled</span><span class="token punctuation">=</span> <span class="token value attr-value">#是否在启动时检查分表元数据一致性，默认值: false</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>数据治理</strong></p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#省略数据源、数据分片和读写分离配置</span>

<span class="token key attr-name">sharding.jdbc.config.sharding.orchestration.name</span><span class="token punctuation">=</span> <span class="token value attr-value">#数据治理实例名称</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.orchestration.overwrite</span><span class="token punctuation">=</span> <span class="token value attr-value">#本地配置是否覆盖注册中心配置。如果可覆盖，每次启动都以本地配置为准</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.orchestration.registry.server-lists</span><span class="token punctuation">=</span> <span class="token value attr-value">#连接注册中心服务器的列表。包括IP地址和端口号。多个地址用逗号分隔。如: host1:2181,host2:2181</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.orchestration.registry.namespace</span><span class="token punctuation">=</span> <span class="token value attr-value">#注册中心的命名空间</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.orchestration.registry.digest</span><span class="token punctuation">=</span> <span class="token value attr-value">#连接注册中心的权限令牌。缺省为不需要权限验证</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.orchestration.registry.operation-timeout-milliseconds</span><span class="token punctuation">=</span> <span class="token value attr-value">#操作超时的毫秒数，默认500毫秒</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.orchestration.registry.max-retries</span><span class="token punctuation">=</span> <span class="token value attr-value">#连接失败后的最大重试次数，默认3次</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.orchestration.registry.retry-interval-milliseconds</span><span class="token punctuation">=</span> <span class="token value attr-value">#重试间隔毫秒数，默认500毫秒</span>
<span class="token key attr-name">sharding.jdbc.config.sharding.orchestration.registry.time-to-live-seconds</span><span class="token punctuation">=</span> <span class="token value attr-value">#临时节点存活秒数，默认60秒</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="springboot配置"><a href="#springboot配置" class="header-anchor">#</a> SpringBoot配置</h3> <div class="custom-block warning"><p class="custom-block-title">注意事项</p> <p>行表达式标识符可以使用${...}或$-&gt;{...}，但前者与Spring本身的属性文件占位符冲突，因此在Spring环境中使用行表达式标识符建议使用$-&gt;{...}。</p></div></div></div>  <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/note-doc/pages/6edd47/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">链路追踪</div></a> <a href="/note-doc/pages/fe3ddc/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">分布式事务</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/note-doc/pages/6edd47/" class="prev">链路追踪</a></span> <span class="next"><a href="/note-doc/pages/fe3ddc/">分布式事务</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/note-doc/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/note-doc/pages/4107ab/"><div>
            Spring Boot 模式启动
            <!----></div></a> <span class="date">02-19</span></dt></dl><dl><dd>02</dd> <dt><a href="/note-doc/pages/1e8031/"><div>
            kubeSphere【推荐】
            <!----></div></a> <span class="date">02-18</span></dt></dl><dl><dd>03</dd> <dt><a href="/note-doc/pages/13a3cf/"><div>
            k8s 部署
            <!----></div></a> <span class="date">02-18</span></dt></dl> <dl><dd></dd> <dt><a href="/note-doc/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>Evan Xu | <a href="https://github.com/simpleguan/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/note-doc/assets/js/app.76332d15.js" defer></script><script src="/note-doc/assets/js/2.d14532d0.js" defer></script><script src="/note-doc/assets/js/100.e8f88cce.js" defer></script>
  </body>
</html>
