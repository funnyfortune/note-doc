<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>统一网关 | X_SaaS快速开发平台</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/note-doc/img/favicon.ico">
    <meta name="description" content="基于spring cloud alibaba 微服务搭建的快速开发平台">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#fff">
    
    <link rel="preload" href="/note-doc/assets/css/0.styles.35b16e35.css" as="style"><link rel="preload" href="/note-doc/assets/js/app.b1b91d6a.js" as="script"><link rel="preload" href="/note-doc/assets/js/2.d4cb6c72.js" as="script"><link rel="preload" href="/note-doc/assets/js/85.333a9d04.js" as="script"><link rel="prefetch" href="/note-doc/assets/js/10.5aa33579.js"><link rel="prefetch" href="/note-doc/assets/js/100.ca9ae552.js"><link rel="prefetch" href="/note-doc/assets/js/101.8fc4ef47.js"><link rel="prefetch" href="/note-doc/assets/js/102.51343bfa.js"><link rel="prefetch" href="/note-doc/assets/js/103.6ae0cf88.js"><link rel="prefetch" href="/note-doc/assets/js/104.610809ae.js"><link rel="prefetch" href="/note-doc/assets/js/105.1718dcf2.js"><link rel="prefetch" href="/note-doc/assets/js/106.4f4c8cb9.js"><link rel="prefetch" href="/note-doc/assets/js/107.609ed995.js"><link rel="prefetch" href="/note-doc/assets/js/108.bbd4b384.js"><link rel="prefetch" href="/note-doc/assets/js/109.a5bf802c.js"><link rel="prefetch" href="/note-doc/assets/js/11.5bed9a4b.js"><link rel="prefetch" href="/note-doc/assets/js/110.29fdbe94.js"><link rel="prefetch" href="/note-doc/assets/js/111.9f22a53c.js"><link rel="prefetch" href="/note-doc/assets/js/112.9977b6af.js"><link rel="prefetch" href="/note-doc/assets/js/113.5790c7e1.js"><link rel="prefetch" href="/note-doc/assets/js/114.50442162.js"><link rel="prefetch" href="/note-doc/assets/js/115.b4c19ea5.js"><link rel="prefetch" href="/note-doc/assets/js/116.0970edb5.js"><link rel="prefetch" href="/note-doc/assets/js/117.9834106f.js"><link rel="prefetch" href="/note-doc/assets/js/118.c04e528d.js"><link rel="prefetch" href="/note-doc/assets/js/119.2376ea9c.js"><link rel="prefetch" href="/note-doc/assets/js/12.71974b97.js"><link rel="prefetch" href="/note-doc/assets/js/120.de2d0446.js"><link rel="prefetch" href="/note-doc/assets/js/121.ae2c9f7e.js"><link rel="prefetch" href="/note-doc/assets/js/122.f1a018ec.js"><link rel="prefetch" href="/note-doc/assets/js/123.97072ca7.js"><link rel="prefetch" href="/note-doc/assets/js/124.f6abed14.js"><link rel="prefetch" href="/note-doc/assets/js/125.3e7c848d.js"><link rel="prefetch" href="/note-doc/assets/js/126.7db7230c.js"><link rel="prefetch" href="/note-doc/assets/js/127.0f08e66f.js"><link rel="prefetch" href="/note-doc/assets/js/128.f61fd0e4.js"><link rel="prefetch" href="/note-doc/assets/js/129.5448aa46.js"><link rel="prefetch" href="/note-doc/assets/js/13.e16fb1bb.js"><link rel="prefetch" href="/note-doc/assets/js/130.af69a24b.js"><link rel="prefetch" href="/note-doc/assets/js/131.fba05d14.js"><link rel="prefetch" href="/note-doc/assets/js/132.882ede3f.js"><link rel="prefetch" href="/note-doc/assets/js/133.86075aaa.js"><link rel="prefetch" href="/note-doc/assets/js/134.229c02a4.js"><link rel="prefetch" href="/note-doc/assets/js/135.f3ad5f2a.js"><link rel="prefetch" href="/note-doc/assets/js/136.6792f0be.js"><link rel="prefetch" href="/note-doc/assets/js/137.9a61f03f.js"><link rel="prefetch" href="/note-doc/assets/js/138.b2dd491b.js"><link rel="prefetch" href="/note-doc/assets/js/139.977a7b86.js"><link rel="prefetch" href="/note-doc/assets/js/14.3f491760.js"><link rel="prefetch" href="/note-doc/assets/js/140.83035043.js"><link rel="prefetch" href="/note-doc/assets/js/141.0fe99d34.js"><link rel="prefetch" href="/note-doc/assets/js/142.771ce42f.js"><link rel="prefetch" href="/note-doc/assets/js/143.86d51656.js"><link rel="prefetch" href="/note-doc/assets/js/144.2ecc0293.js"><link rel="prefetch" href="/note-doc/assets/js/145.d1617690.js"><link rel="prefetch" href="/note-doc/assets/js/146.9d48885a.js"><link rel="prefetch" href="/note-doc/assets/js/147.2c90816a.js"><link rel="prefetch" href="/note-doc/assets/js/148.dc9fbb45.js"><link rel="prefetch" href="/note-doc/assets/js/149.08acc37a.js"><link rel="prefetch" href="/note-doc/assets/js/15.fb768417.js"><link rel="prefetch" href="/note-doc/assets/js/150.bc8eda13.js"><link rel="prefetch" href="/note-doc/assets/js/151.5a711bfb.js"><link rel="prefetch" href="/note-doc/assets/js/152.3501e59b.js"><link rel="prefetch" href="/note-doc/assets/js/153.eb843e81.js"><link rel="prefetch" href="/note-doc/assets/js/154.d5720f0b.js"><link rel="prefetch" href="/note-doc/assets/js/155.cf368d3d.js"><link rel="prefetch" href="/note-doc/assets/js/156.ce543dd2.js"><link rel="prefetch" href="/note-doc/assets/js/157.3d56aa14.js"><link rel="prefetch" href="/note-doc/assets/js/158.26f86c3b.js"><link rel="prefetch" href="/note-doc/assets/js/159.c18262bd.js"><link rel="prefetch" href="/note-doc/assets/js/16.a24a8555.js"><link rel="prefetch" href="/note-doc/assets/js/160.daf58495.js"><link rel="prefetch" href="/note-doc/assets/js/161.afe579ea.js"><link rel="prefetch" href="/note-doc/assets/js/162.3a7fb740.js"><link rel="prefetch" href="/note-doc/assets/js/163.569c23cd.js"><link rel="prefetch" href="/note-doc/assets/js/164.161cb2a2.js"><link rel="prefetch" href="/note-doc/assets/js/165.c23e2ef5.js"><link rel="prefetch" href="/note-doc/assets/js/166.f6d15089.js"><link rel="prefetch" href="/note-doc/assets/js/167.4f03f121.js"><link rel="prefetch" href="/note-doc/assets/js/168.747ce73c.js"><link rel="prefetch" href="/note-doc/assets/js/169.da2e25b4.js"><link rel="prefetch" href="/note-doc/assets/js/17.a8ddadcb.js"><link rel="prefetch" href="/note-doc/assets/js/170.0182540b.js"><link rel="prefetch" href="/note-doc/assets/js/171.9dc7c22e.js"><link rel="prefetch" href="/note-doc/assets/js/172.ba55a1e9.js"><link rel="prefetch" href="/note-doc/assets/js/173.bd7d0390.js"><link rel="prefetch" href="/note-doc/assets/js/174.516f9274.js"><link rel="prefetch" href="/note-doc/assets/js/175.520c869b.js"><link rel="prefetch" href="/note-doc/assets/js/176.7a46572e.js"><link rel="prefetch" href="/note-doc/assets/js/177.789fe5cc.js"><link rel="prefetch" href="/note-doc/assets/js/178.d61d293b.js"><link rel="prefetch" href="/note-doc/assets/js/179.bd88486d.js"><link rel="prefetch" href="/note-doc/assets/js/18.81ea516c.js"><link rel="prefetch" href="/note-doc/assets/js/180.51daaae2.js"><link rel="prefetch" href="/note-doc/assets/js/181.4589864c.js"><link rel="prefetch" href="/note-doc/assets/js/182.8bf9301d.js"><link rel="prefetch" href="/note-doc/assets/js/183.7c420100.js"><link rel="prefetch" href="/note-doc/assets/js/184.64a6f9ba.js"><link rel="prefetch" href="/note-doc/assets/js/185.2341e0d9.js"><link rel="prefetch" href="/note-doc/assets/js/186.cf2daf79.js"><link rel="prefetch" href="/note-doc/assets/js/187.525dfb22.js"><link rel="prefetch" href="/note-doc/assets/js/188.b9b0ffa1.js"><link rel="prefetch" href="/note-doc/assets/js/189.f97e9323.js"><link rel="prefetch" href="/note-doc/assets/js/19.ead2f5f0.js"><link rel="prefetch" href="/note-doc/assets/js/190.a2237ad5.js"><link rel="prefetch" href="/note-doc/assets/js/191.6064a1a8.js"><link rel="prefetch" href="/note-doc/assets/js/192.f7f03746.js"><link rel="prefetch" href="/note-doc/assets/js/193.54b7d74a.js"><link rel="prefetch" href="/note-doc/assets/js/194.f347eb57.js"><link rel="prefetch" href="/note-doc/assets/js/195.38be7684.js"><link rel="prefetch" href="/note-doc/assets/js/196.5a2d91f5.js"><link rel="prefetch" href="/note-doc/assets/js/197.1b392ce1.js"><link rel="prefetch" href="/note-doc/assets/js/198.d5cdc9fb.js"><link rel="prefetch" href="/note-doc/assets/js/199.c668f312.js"><link rel="prefetch" href="/note-doc/assets/js/20.7f4f327d.js"><link rel="prefetch" href="/note-doc/assets/js/200.657a6eaa.js"><link rel="prefetch" href="/note-doc/assets/js/201.9eccfdc4.js"><link rel="prefetch" href="/note-doc/assets/js/202.094810e5.js"><link rel="prefetch" href="/note-doc/assets/js/203.436f869a.js"><link rel="prefetch" href="/note-doc/assets/js/204.76bd5f95.js"><link rel="prefetch" href="/note-doc/assets/js/205.e94805f6.js"><link rel="prefetch" href="/note-doc/assets/js/206.10eec253.js"><link rel="prefetch" href="/note-doc/assets/js/207.4a87c366.js"><link rel="prefetch" href="/note-doc/assets/js/208.85c8e3d7.js"><link rel="prefetch" href="/note-doc/assets/js/209.c09c0f92.js"><link rel="prefetch" href="/note-doc/assets/js/21.a5c296a4.js"><link rel="prefetch" href="/note-doc/assets/js/210.e6d41b83.js"><link rel="prefetch" href="/note-doc/assets/js/211.188f24df.js"><link rel="prefetch" href="/note-doc/assets/js/212.93c4b09e.js"><link rel="prefetch" href="/note-doc/assets/js/213.7dab591e.js"><link rel="prefetch" href="/note-doc/assets/js/214.bc1fee29.js"><link rel="prefetch" href="/note-doc/assets/js/215.a1cca0b8.js"><link rel="prefetch" href="/note-doc/assets/js/216.544ae556.js"><link rel="prefetch" href="/note-doc/assets/js/217.ff20be53.js"><link rel="prefetch" href="/note-doc/assets/js/218.3524a8b4.js"><link rel="prefetch" href="/note-doc/assets/js/219.8bcdf610.js"><link rel="prefetch" href="/note-doc/assets/js/22.f4d24e8a.js"><link rel="prefetch" href="/note-doc/assets/js/220.8f71dda7.js"><link rel="prefetch" href="/note-doc/assets/js/221.59f9b0a5.js"><link rel="prefetch" href="/note-doc/assets/js/222.51cc35c4.js"><link rel="prefetch" href="/note-doc/assets/js/223.6dad3360.js"><link rel="prefetch" href="/note-doc/assets/js/224.9a9743d8.js"><link rel="prefetch" href="/note-doc/assets/js/225.033b8fa2.js"><link rel="prefetch" href="/note-doc/assets/js/226.8bcd2382.js"><link rel="prefetch" href="/note-doc/assets/js/227.a220cf35.js"><link rel="prefetch" href="/note-doc/assets/js/228.3c943345.js"><link rel="prefetch" href="/note-doc/assets/js/229.704dea1b.js"><link rel="prefetch" href="/note-doc/assets/js/23.f98f382f.js"><link rel="prefetch" href="/note-doc/assets/js/230.a7c75ce4.js"><link rel="prefetch" href="/note-doc/assets/js/231.8de7bc42.js"><link rel="prefetch" href="/note-doc/assets/js/232.9a81abc7.js"><link rel="prefetch" href="/note-doc/assets/js/233.012bae0f.js"><link rel="prefetch" href="/note-doc/assets/js/234.2f25a71f.js"><link rel="prefetch" href="/note-doc/assets/js/235.810b7327.js"><link rel="prefetch" href="/note-doc/assets/js/236.144050b9.js"><link rel="prefetch" href="/note-doc/assets/js/237.208d82d2.js"><link rel="prefetch" href="/note-doc/assets/js/238.053233c6.js"><link rel="prefetch" href="/note-doc/assets/js/239.85885d3b.js"><link rel="prefetch" href="/note-doc/assets/js/24.03dcde28.js"><link rel="prefetch" href="/note-doc/assets/js/240.d72ef4ef.js"><link rel="prefetch" href="/note-doc/assets/js/241.c85e7053.js"><link rel="prefetch" href="/note-doc/assets/js/242.6020bc8c.js"><link rel="prefetch" href="/note-doc/assets/js/243.7727cc4b.js"><link rel="prefetch" href="/note-doc/assets/js/244.37c853fb.js"><link rel="prefetch" href="/note-doc/assets/js/245.fd4d2073.js"><link rel="prefetch" href="/note-doc/assets/js/246.4f5543c3.js"><link rel="prefetch" href="/note-doc/assets/js/247.89cab51a.js"><link rel="prefetch" href="/note-doc/assets/js/248.a0e520e0.js"><link rel="prefetch" href="/note-doc/assets/js/249.263b6cb1.js"><link rel="prefetch" href="/note-doc/assets/js/25.2016a897.js"><link rel="prefetch" href="/note-doc/assets/js/250.2ac54b7f.js"><link rel="prefetch" href="/note-doc/assets/js/251.19f68785.js"><link rel="prefetch" href="/note-doc/assets/js/252.8d8ecec6.js"><link rel="prefetch" href="/note-doc/assets/js/253.94d56710.js"><link rel="prefetch" href="/note-doc/assets/js/254.6badcadd.js"><link rel="prefetch" href="/note-doc/assets/js/255.bf702eb5.js"><link rel="prefetch" href="/note-doc/assets/js/256.fd91c1e9.js"><link rel="prefetch" href="/note-doc/assets/js/257.65528509.js"><link rel="prefetch" href="/note-doc/assets/js/258.61e4dcaa.js"><link rel="prefetch" href="/note-doc/assets/js/259.0a4af126.js"><link rel="prefetch" href="/note-doc/assets/js/26.be2145ca.js"><link rel="prefetch" href="/note-doc/assets/js/260.aa43414d.js"><link rel="prefetch" href="/note-doc/assets/js/261.b887f6fe.js"><link rel="prefetch" href="/note-doc/assets/js/262.ce932760.js"><link rel="prefetch" href="/note-doc/assets/js/263.acf96c47.js"><link rel="prefetch" href="/note-doc/assets/js/264.02af2788.js"><link rel="prefetch" href="/note-doc/assets/js/265.0e43f23f.js"><link rel="prefetch" href="/note-doc/assets/js/266.dfdac0a0.js"><link rel="prefetch" href="/note-doc/assets/js/267.57b09d4b.js"><link rel="prefetch" href="/note-doc/assets/js/268.fcfdc126.js"><link rel="prefetch" href="/note-doc/assets/js/269.30fd1b73.js"><link rel="prefetch" href="/note-doc/assets/js/27.78039edc.js"><link rel="prefetch" href="/note-doc/assets/js/270.ab941d89.js"><link rel="prefetch" href="/note-doc/assets/js/271.b2d8f131.js"><link rel="prefetch" href="/note-doc/assets/js/272.faf932ee.js"><link rel="prefetch" href="/note-doc/assets/js/273.ed635f6e.js"><link rel="prefetch" href="/note-doc/assets/js/274.c760bc97.js"><link rel="prefetch" href="/note-doc/assets/js/275.4b62c87b.js"><link rel="prefetch" href="/note-doc/assets/js/276.fb7aed33.js"><link rel="prefetch" href="/note-doc/assets/js/277.64c7a64a.js"><link rel="prefetch" href="/note-doc/assets/js/278.61d38b64.js"><link rel="prefetch" href="/note-doc/assets/js/279.a082531d.js"><link rel="prefetch" href="/note-doc/assets/js/28.1bbdb441.js"><link rel="prefetch" href="/note-doc/assets/js/280.b6871e06.js"><link rel="prefetch" href="/note-doc/assets/js/281.d068f930.js"><link rel="prefetch" href="/note-doc/assets/js/282.b9d5de49.js"><link rel="prefetch" href="/note-doc/assets/js/283.6ccca474.js"><link rel="prefetch" href="/note-doc/assets/js/284.79aaae04.js"><link rel="prefetch" href="/note-doc/assets/js/285.96cb7176.js"><link rel="prefetch" href="/note-doc/assets/js/286.0b59a3f0.js"><link rel="prefetch" href="/note-doc/assets/js/287.63b7c6d3.js"><link rel="prefetch" href="/note-doc/assets/js/288.41caf4ed.js"><link rel="prefetch" href="/note-doc/assets/js/289.5573942a.js"><link rel="prefetch" href="/note-doc/assets/js/29.f14f56ed.js"><link rel="prefetch" href="/note-doc/assets/js/290.44410f30.js"><link rel="prefetch" href="/note-doc/assets/js/291.9a67b926.js"><link rel="prefetch" href="/note-doc/assets/js/292.524c6710.js"><link rel="prefetch" href="/note-doc/assets/js/293.ec76df33.js"><link rel="prefetch" href="/note-doc/assets/js/294.9a28551d.js"><link rel="prefetch" href="/note-doc/assets/js/295.73c0e9bf.js"><link rel="prefetch" href="/note-doc/assets/js/296.a8532901.js"><link rel="prefetch" href="/note-doc/assets/js/297.cf0bbd9b.js"><link rel="prefetch" href="/note-doc/assets/js/298.e9a4fceb.js"><link rel="prefetch" href="/note-doc/assets/js/299.f58ee848.js"><link rel="prefetch" href="/note-doc/assets/js/3.c5ed4172.js"><link rel="prefetch" href="/note-doc/assets/js/30.13ca5a7c.js"><link rel="prefetch" href="/note-doc/assets/js/300.638e9731.js"><link rel="prefetch" href="/note-doc/assets/js/301.084ccfdd.js"><link rel="prefetch" href="/note-doc/assets/js/302.0a07696e.js"><link rel="prefetch" href="/note-doc/assets/js/303.00abc8b5.js"><link rel="prefetch" href="/note-doc/assets/js/304.78c3cdda.js"><link rel="prefetch" href="/note-doc/assets/js/305.1cadf2d0.js"><link rel="prefetch" href="/note-doc/assets/js/306.6f82eded.js"><link rel="prefetch" href="/note-doc/assets/js/307.99919168.js"><link rel="prefetch" href="/note-doc/assets/js/308.7780f1e5.js"><link rel="prefetch" href="/note-doc/assets/js/309.43c5ddf3.js"><link rel="prefetch" href="/note-doc/assets/js/31.3a4c598b.js"><link rel="prefetch" href="/note-doc/assets/js/310.705f8039.js"><link rel="prefetch" href="/note-doc/assets/js/311.3bdf5f7b.js"><link rel="prefetch" href="/note-doc/assets/js/312.2c00c6e3.js"><link rel="prefetch" href="/note-doc/assets/js/313.31c0b45f.js"><link rel="prefetch" href="/note-doc/assets/js/314.364e8b43.js"><link rel="prefetch" href="/note-doc/assets/js/315.f8132ba7.js"><link rel="prefetch" href="/note-doc/assets/js/316.e7d44937.js"><link rel="prefetch" href="/note-doc/assets/js/317.fe4144d5.js"><link rel="prefetch" href="/note-doc/assets/js/318.8b12b374.js"><link rel="prefetch" href="/note-doc/assets/js/319.09764674.js"><link rel="prefetch" href="/note-doc/assets/js/32.f9e136be.js"><link rel="prefetch" href="/note-doc/assets/js/320.ee0d774c.js"><link rel="prefetch" href="/note-doc/assets/js/321.406b152b.js"><link rel="prefetch" href="/note-doc/assets/js/322.e62cb07f.js"><link rel="prefetch" href="/note-doc/assets/js/323.cde2ae18.js"><link rel="prefetch" href="/note-doc/assets/js/324.eb375150.js"><link rel="prefetch" href="/note-doc/assets/js/325.170f272f.js"><link rel="prefetch" href="/note-doc/assets/js/326.f54a3aea.js"><link rel="prefetch" href="/note-doc/assets/js/327.ca3119fc.js"><link rel="prefetch" href="/note-doc/assets/js/328.547e6395.js"><link rel="prefetch" href="/note-doc/assets/js/329.efa0d250.js"><link rel="prefetch" href="/note-doc/assets/js/33.9ca8b57c.js"><link rel="prefetch" href="/note-doc/assets/js/330.718eb377.js"><link rel="prefetch" href="/note-doc/assets/js/331.7f33c946.js"><link rel="prefetch" href="/note-doc/assets/js/332.9a7be494.js"><link rel="prefetch" href="/note-doc/assets/js/333.f14f35a4.js"><link rel="prefetch" href="/note-doc/assets/js/334.865eab6f.js"><link rel="prefetch" href="/note-doc/assets/js/335.fe75e7bf.js"><link rel="prefetch" href="/note-doc/assets/js/336.e12dc40c.js"><link rel="prefetch" href="/note-doc/assets/js/337.d0f69581.js"><link rel="prefetch" href="/note-doc/assets/js/338.8626fa05.js"><link rel="prefetch" href="/note-doc/assets/js/339.a9036272.js"><link rel="prefetch" href="/note-doc/assets/js/34.9ca687a6.js"><link rel="prefetch" href="/note-doc/assets/js/340.daa544d6.js"><link rel="prefetch" href="/note-doc/assets/js/341.60b50416.js"><link rel="prefetch" href="/note-doc/assets/js/342.f58efcd7.js"><link rel="prefetch" href="/note-doc/assets/js/343.37bd6bbf.js"><link rel="prefetch" href="/note-doc/assets/js/344.d026024d.js"><link rel="prefetch" href="/note-doc/assets/js/345.4fd203f4.js"><link rel="prefetch" href="/note-doc/assets/js/346.5ba42259.js"><link rel="prefetch" href="/note-doc/assets/js/347.20c65196.js"><link rel="prefetch" href="/note-doc/assets/js/348.b1ce4ebc.js"><link rel="prefetch" href="/note-doc/assets/js/349.a4e1249c.js"><link rel="prefetch" href="/note-doc/assets/js/35.af9a4d26.js"><link rel="prefetch" href="/note-doc/assets/js/350.2c9d93dc.js"><link rel="prefetch" href="/note-doc/assets/js/351.735b5ce0.js"><link rel="prefetch" href="/note-doc/assets/js/352.cde10aa3.js"><link rel="prefetch" href="/note-doc/assets/js/353.4bf180ef.js"><link rel="prefetch" href="/note-doc/assets/js/354.a6532871.js"><link rel="prefetch" href="/note-doc/assets/js/355.9e9cf1da.js"><link rel="prefetch" href="/note-doc/assets/js/356.e1811a5f.js"><link rel="prefetch" href="/note-doc/assets/js/357.8a813583.js"><link rel="prefetch" href="/note-doc/assets/js/358.c591416b.js"><link rel="prefetch" href="/note-doc/assets/js/359.e9290430.js"><link rel="prefetch" href="/note-doc/assets/js/36.590fd9e6.js"><link rel="prefetch" href="/note-doc/assets/js/360.53ae9833.js"><link rel="prefetch" href="/note-doc/assets/js/361.c6e63b08.js"><link rel="prefetch" href="/note-doc/assets/js/362.86e6e213.js"><link rel="prefetch" href="/note-doc/assets/js/363.4dd5b3be.js"><link rel="prefetch" href="/note-doc/assets/js/364.1ad3e32f.js"><link rel="prefetch" href="/note-doc/assets/js/365.4a375d07.js"><link rel="prefetch" href="/note-doc/assets/js/366.b47a2eac.js"><link rel="prefetch" href="/note-doc/assets/js/367.a9f42f6e.js"><link rel="prefetch" href="/note-doc/assets/js/368.2f675e04.js"><link rel="prefetch" href="/note-doc/assets/js/369.cbabb14f.js"><link rel="prefetch" href="/note-doc/assets/js/37.f73dba2c.js"><link rel="prefetch" href="/note-doc/assets/js/370.6c2fdd19.js"><link rel="prefetch" href="/note-doc/assets/js/371.62352a63.js"><link rel="prefetch" href="/note-doc/assets/js/372.2fd61389.js"><link rel="prefetch" href="/note-doc/assets/js/373.6ff1c42f.js"><link rel="prefetch" href="/note-doc/assets/js/374.98da20e8.js"><link rel="prefetch" href="/note-doc/assets/js/375.6159eb3f.js"><link rel="prefetch" href="/note-doc/assets/js/376.5e59d692.js"><link rel="prefetch" href="/note-doc/assets/js/38.30408472.js"><link rel="prefetch" href="/note-doc/assets/js/39.a0c62f87.js"><link rel="prefetch" href="/note-doc/assets/js/4.4550ddaa.js"><link rel="prefetch" href="/note-doc/assets/js/40.551e2845.js"><link rel="prefetch" href="/note-doc/assets/js/41.972fcfdf.js"><link rel="prefetch" href="/note-doc/assets/js/42.b26fc3b7.js"><link rel="prefetch" href="/note-doc/assets/js/43.5a318ef6.js"><link rel="prefetch" href="/note-doc/assets/js/44.af8c2b4d.js"><link rel="prefetch" href="/note-doc/assets/js/45.14ef29a7.js"><link rel="prefetch" href="/note-doc/assets/js/46.4169d58e.js"><link rel="prefetch" href="/note-doc/assets/js/47.b4e5b289.js"><link rel="prefetch" href="/note-doc/assets/js/48.2bc88a45.js"><link rel="prefetch" href="/note-doc/assets/js/49.f6f6bdd6.js"><link rel="prefetch" href="/note-doc/assets/js/5.3bc006e3.js"><link rel="prefetch" href="/note-doc/assets/js/50.40d7c609.js"><link rel="prefetch" href="/note-doc/assets/js/51.b7d9b751.js"><link rel="prefetch" href="/note-doc/assets/js/52.6f3991c4.js"><link rel="prefetch" href="/note-doc/assets/js/53.a206d7a0.js"><link rel="prefetch" href="/note-doc/assets/js/54.eab2d8b4.js"><link rel="prefetch" href="/note-doc/assets/js/55.40723bc6.js"><link rel="prefetch" href="/note-doc/assets/js/56.c95e52d5.js"><link rel="prefetch" href="/note-doc/assets/js/57.92d27e8a.js"><link rel="prefetch" href="/note-doc/assets/js/58.9cfb945f.js"><link rel="prefetch" href="/note-doc/assets/js/59.01ed7e41.js"><link rel="prefetch" href="/note-doc/assets/js/6.6f40605a.js"><link rel="prefetch" href="/note-doc/assets/js/60.b91d7eb6.js"><link rel="prefetch" href="/note-doc/assets/js/61.4be4076f.js"><link rel="prefetch" href="/note-doc/assets/js/62.7021e0cd.js"><link rel="prefetch" href="/note-doc/assets/js/63.141fd4d9.js"><link rel="prefetch" href="/note-doc/assets/js/64.927d5f2f.js"><link rel="prefetch" href="/note-doc/assets/js/65.912d79bd.js"><link rel="prefetch" href="/note-doc/assets/js/66.df2a34f6.js"><link rel="prefetch" href="/note-doc/assets/js/67.0482b96f.js"><link rel="prefetch" href="/note-doc/assets/js/68.71b1e2b5.js"><link rel="prefetch" href="/note-doc/assets/js/69.f49a3a5e.js"><link rel="prefetch" href="/note-doc/assets/js/7.344c024c.js"><link rel="prefetch" href="/note-doc/assets/js/70.772d77c6.js"><link rel="prefetch" href="/note-doc/assets/js/71.e4b09fba.js"><link rel="prefetch" href="/note-doc/assets/js/72.d84f3b70.js"><link rel="prefetch" href="/note-doc/assets/js/73.3e19b8e9.js"><link rel="prefetch" href="/note-doc/assets/js/74.d52db843.js"><link rel="prefetch" href="/note-doc/assets/js/75.f97b86ce.js"><link rel="prefetch" href="/note-doc/assets/js/76.e62c5b8b.js"><link rel="prefetch" href="/note-doc/assets/js/77.de913c40.js"><link rel="prefetch" href="/note-doc/assets/js/78.0e2c7149.js"><link rel="prefetch" href="/note-doc/assets/js/79.b8f8da0d.js"><link rel="prefetch" href="/note-doc/assets/js/8.b321fab1.js"><link rel="prefetch" href="/note-doc/assets/js/80.ffe953a7.js"><link rel="prefetch" href="/note-doc/assets/js/81.84249f63.js"><link rel="prefetch" href="/note-doc/assets/js/82.88ca7f29.js"><link rel="prefetch" href="/note-doc/assets/js/83.0de3b345.js"><link rel="prefetch" href="/note-doc/assets/js/84.9651d185.js"><link rel="prefetch" href="/note-doc/assets/js/86.6d3e7667.js"><link rel="prefetch" href="/note-doc/assets/js/87.5baccc75.js"><link rel="prefetch" href="/note-doc/assets/js/88.c48915c5.js"><link rel="prefetch" href="/note-doc/assets/js/89.7e944fb7.js"><link rel="prefetch" href="/note-doc/assets/js/9.5fd3bac2.js"><link rel="prefetch" href="/note-doc/assets/js/90.0a392e6f.js"><link rel="prefetch" href="/note-doc/assets/js/91.738530a1.js"><link rel="prefetch" href="/note-doc/assets/js/92.ff2e1d06.js"><link rel="prefetch" href="/note-doc/assets/js/93.0ad03c01.js"><link rel="prefetch" href="/note-doc/assets/js/94.a70ba950.js"><link rel="prefetch" href="/note-doc/assets/js/95.39d7386d.js"><link rel="prefetch" href="/note-doc/assets/js/96.4d02b559.js"><link rel="prefetch" href="/note-doc/assets/js/97.6fb7bc6f.js"><link rel="prefetch" href="/note-doc/assets/js/98.55678428.js"><link rel="prefetch" href="/note-doc/assets/js/99.a8adaed4.js">
    <link rel="stylesheet" href="/note-doc/assets/css/0.styles.35b16e35.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note-doc/" class="home-link router-link-active"><img src="/note-doc/img/logo.png" alt="X_SaaS快速开发平台" class="logo"> <span class="site-name can-hide">X_SaaS快速开发平台</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note-doc/dev/" class="nav-link">开发指南</a></div><div class="nav-item"><a href="/note-doc/oa/" class="nav-link">流程手册</a></div><div class="nav-item"><a href="/note-doc/operate/index/" class="nav-link">操作手册</a></div><div class="nav-item"><a href="/note-doc/dev-rule/" class="nav-link">开发规范</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java全栈知识" class="dropdown-title"><a href="/note-doc/web/" class="link-title">java全栈知识</a> <span class="title" style="display:none;">java全栈知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-doc/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>页面</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-doc/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/note-doc/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-doc/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/note-doc/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/note-doc/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li><li class="dropdown-item"><h4>技术</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-doc/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-subitem"><a href="/note-doc/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/note-doc/about/" class="nav-link">关于</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/note-doc/dev/" class="nav-link">开发指南</a></div><div class="nav-item"><a href="/note-doc/oa/" class="nav-link">流程手册</a></div><div class="nav-item"><a href="/note-doc/operate/index/" class="nav-link">操作手册</a></div><div class="nav-item"><a href="/note-doc/dev-rule/" class="nav-link">开发规范</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java全栈知识" class="dropdown-title"><a href="/note-doc/web/" class="link-title">java全栈知识</a> <span class="title" style="display:none;">java全栈知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-doc/pages/8143cc480faf9a11/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>页面</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-doc/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/note-doc/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-doc/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/note-doc/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/note-doc/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/note-doc/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li><li class="dropdown-item"><h4>技术</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-doc/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-subitem"><a href="/note-doc/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/note-doc/about/" class="nav-link">关于</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>项目手册</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>开发指南</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>快速入门</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading open"><span>微服务</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note-doc/pages/88b04d/" aria-current="page" class="active sidebar-link">统一网关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/note-doc/pages/88b04d/#网关作用" class="sidebar-link">网关作用</a></li><li class="sidebar-sub-header level2"><a href="/note-doc/pages/88b04d/#spring-cloud-gateway" class="sidebar-link">Spring Cloud Gateway</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#基本介绍" class="sidebar-link">基本介绍</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#核心概念" class="sidebar-link">核心概念</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#工作流程" class="sidebar-link">工作流程</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header level4"><a href="/note-doc/pages/88b04d/#_1、添加依赖" class="sidebar-link">1、添加依赖</a></li><li class="sidebar-sub-header level4"><a href="/note-doc/pages/88b04d/#_2、-通过微服务名实现动态路由" class="sidebar-link">2、 通过微服务名实现动态路由</a></li><li class="sidebar-sub-header level4"><a href="/note-doc/pages/88b04d/#_3、网关启动类" class="sidebar-link">3、网关启动类</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/note-doc/pages/88b04d/#常用的路由规则-route-predicate" class="sidebar-link">常用的路由规则(Route Predicate)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_1-after-route-predicate" class="sidebar-link">1.After Route Predicate</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_2-before-route-predicate" class="sidebar-link">2.Before Route Predicate</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_3-between-route-predicate" class="sidebar-link">3.Between Route Predicate</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_4-cookie-route-predicate" class="sidebar-link">4.Cookie Route Predicate</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_5-header-route-predicate" class="sidebar-link">5.Header Route Predicate</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_6-host-route-predicate" class="sidebar-link">6.Host Route Predicate</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_7-method-route-predicate" class="sidebar-link">7.Method Route Predicate</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_8-path-route-predicate" class="sidebar-link">8.Path Route Predicate</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_9-query-route-predicate" class="sidebar-link">9.Query Route Predicate</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_10-remoteaddr-route-predicate" class="sidebar-link">10.RemoteAddr Route Predicate</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_11-weight-route-predicate" class="sidebar-link">11.Weight Route Predicate</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/note-doc/pages/88b04d/#路由配置" class="sidebar-link">路由配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_1-websocket配置方式" class="sidebar-link">1.websocket配置方式</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_2-http地址配置方式" class="sidebar-link">2.http地址配置方式</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_3-注册中心配置方式" class="sidebar-link">3.注册中心配置方式</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/note-doc/pages/88b04d/#filter的使用" class="sidebar-link">Filter的使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#gatewayfilter" class="sidebar-link">GatewayFilter</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#自定义全局globalfilter" class="sidebar-link">自定义全局GlobalFilter</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/note-doc/pages/88b04d/#跨域配置" class="sidebar-link">跨域配置</a></li><li class="sidebar-sub-header level2"><a href="/note-doc/pages/88b04d/#sentinel整合" class="sidebar-link">sentinel整合</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_1、添加依赖-2" class="sidebar-link">1、添加依赖</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_2、配置sentinel-yaml" class="sidebar-link">2、配置sentinel.yaml</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#sentinel自定义异常" class="sidebar-link">Sentinel自定义异常</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/note-doc/pages/88b04d/#官方提供requestratelimitergatewayfilterfactory限流" class="sidebar-link">官方提供RequestRateLimiterGatewayFilterFactory限流</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_1、添加依赖-3" class="sidebar-link">1、添加依赖</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_2、限流规则-根据-uri-限流" class="sidebar-link">2、限流规则，根据  URI  限流</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_3、编写-uri-限流规则配置类" class="sidebar-link">3、编写  URI  限流规则配置类</a></li><li class="sidebar-sub-header level3"><a href="/note-doc/pages/88b04d/#_4、测试服务验证限流" class="sidebar-link">4、测试服务验证限流</a></li></ul></li></ul></li><li><a href="/note-doc/pages/05eabd/" class="sidebar-link">权限认证</a></li><li><a href="/note-doc/pages/921eef/" class="sidebar-link">服务发现</a></li><li><a href="/note-doc/pages/22126f/" class="sidebar-link">配置中心</a></li><li><a href="/note-doc/pages/350fd5/" class="sidebar-link">服务调用</a></li><li><a href="/note-doc/pages/7ca45c/" class="sidebar-link">限流熔断</a></li><li><a href="/note-doc/pages/c42fe4/" class="sidebar-link">消息驱动</a></li><li><a href="/note-doc/pages/008939/" class="sidebar-link">服务监控</a></li><li><a href="/note-doc/pages/dcb32e/" class="sidebar-link">服务接口</a></li><li><a href="/note-doc/pages/b6f673/" class="sidebar-link">单元测试</a></li><li><a href="/note-doc/pages/6edd47/" class="sidebar-link">链路追踪</a></li><li><a href="/note-doc/pages/ed97b9/" class="sidebar-link">分库分表</a></li><li><a href="/note-doc/pages/fe3ddc/" class="sidebar-link">分布式事务</a></li><li><a href="/note-doc/dev/server/dynamic-datasource/" class="sidebar-link">多数据源</a></li><li><a href="/note-doc/pages/552fed/" class="sidebar-link">文件存储</a></li><li><a href="/note-doc/pages/b53fd8/" class="sidebar-link">分布式锁</a></li><li><a href="/note-doc/pages/4c32bc/" class="sidebar-link">分布式日志</a></li><li><a href="/note-doc/dev/server/job/" class="sidebar-link">定时任务</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>后端手册</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>前端手册Vue2</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>前端手册Vue3</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>表单设计器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>运维手册</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>大屏手册</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>更新日志</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>流程手册</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>操作指南</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开发规范</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/note-doc/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/note-doc/categories/?category=%E6%96%87%E6%A1%A3%E6%89%8B%E5%86%8C" title="分类" data-v-06225672>文档手册</a></li><li data-v-06225672><a href="/note-doc/categories/?category=%E9%A1%B9%E7%9B%AE%E6%89%8B%E5%86%8C" title="分类" data-v-06225672>项目手册</a></li><li data-v-06225672><a href="/note-doc/categories/?category=%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97" title="分类" data-v-06225672>开发指南</a></li><li data-v-06225672><a href="/note-doc/categories/?category=%E5%BE%AE%E6%9C%8D%E5%8A%A1" title="分类" data-v-06225672>微服务</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/simpleguan" target="_blank" title="作者" class="beLink" data-v-06225672>TC</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-08-11</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">统一网关<!----></h1>  <div class="theme-vdoing-content content__default"><div class="custom-block tip"><p class="custom-block-title">为什么需要网关</p> <p>API 网关的流行得益于近几年微服务架构的兴起，原本一个庞大的业务系统被拆分成许多粒度更小的系统进行独立部署和维护，这种模式势必会带来更多的跨系统交互，企业或事业单位的业务 API 的规模也会成倍增加，API 网关（或者微服务网关）就逐渐成为了微服务架构的标配组件。</p></div> <div class="custom-block tip"><p class="custom-block-title">什么是服务网关</p> <p><code>API Gateway（APIGW / API 网关）</code> ，顾名思义，是系统对外的唯一入口。 <code>API</code> 网关封装了系统内部架构，为每个客户端提供定制的API。
近几年来移动应用与企业间互联需求的兴起。从以前单一的Web应用，扩展到多种使用场景，且每种使用场景对后台服务的要求都不尽相同。
这不仅增加了后台服务的响应量，还增加了后台服务的复杂性。随着微服务架构概念的提出，API网关成为了微服务架构的一个标配组件。</p></div> <h2 id="网关作用"><a href="#网关作用" class="header-anchor">#</a> 网关作用</h2> <p>从名字就可以看到，它是微服务应用平台的一个网络的关卡，无论后端多么的复杂，这个对外的关卡表现是一致的。
更加重要的是，隐藏在关卡后面的一些通用的事务，都可以抽象出来进行处理。可以把网关比喻成一个类似于海关的机构服务，你的签证资料准备、安检、调度等，都可以统一进行处理。
api网关就是伴随着微服务概念兴起的一种架构模式，当然也不仅限于微服务。从以下图我们可以看到网关的位置。</p> <p><img src="/img/dev/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E7%BD%91%E5%85%B3/gateway.png" alt=""></p> <ul><li><p><strong>反向代理</strong> 这个是所有网关，包括nginx的基本功能。除了能够对服务进行整形，网关一个非常重要的附加收益，就是对后端的服务细节进行了屏蔽。</p></li> <li><p><strong>鉴权</strong> 就是权限认证，也就是常说的权限系统。由于鉴权服务有非常高的相似性，就可以进行抽象处理，放在网关层。比如https协议的统一接入，分布式session的处理问题，新的登录鉴权通道的接入等。</p></li> <li><p><strong>流量控制</strong> 流量控制如果分散到每个服务里去做，就是一种灾难，网关是最适合的地方。流量控制通常有多种策略，对后端服务进行屏蔽。非正常请求和超出负载能力的请求，都会被快速拦截在外，为系统的稳定性提供了必不可少的支持。流量控制有单机限流和分布式限流两种方式，后者控制更加精细一些，spring cloud gateway都有提供。</p></li> <li><p><strong>熔断</strong> 熔断与流控的主要区别，在于前者在一段时间内，服务“不可用”，而后者仅概率性失败。除了服务之间的调用涉及到熔断，在网关层的熔断，作用范围会更大，需要对服务进行准确的分级。</p></li> <li><p><strong>灰度控制</strong> 网关的一个终极功能，就是实现服务的灰度发布。比如常说的 AB test，就是一种灰度发布方式。
灰度会进行精细化控制，比如针对一类用户，某个物理区域，特定请求路径，特定模块，随机百分比等方面的一些灰度控制等。
灰度是一个整体架构配合的结果，但协调的入口就是网关，通过对请求头或者参数加入一些特定的标志，就可以对每个请求进行划分，决定是否落入灰度。</p></li> <li><p><strong>日志监控</strong> 网关是最适合进行日志监控的地方。通过对访问日志的精细分析，能够得到很多有价值的数据，进而对后端服务的优化提供决策依据。
比如，某个“业务”的访问趋势，运营数据，QPS峰值，同比、环比等。</p></li></ul> <h2 id="spring-cloud-gateway"><a href="#spring-cloud-gateway" class="header-anchor">#</a> Spring Cloud Gateway</h2> <h3 id="基本介绍"><a href="#基本介绍" class="header-anchor">#</a> 基本介绍</h3> <div class="custom-block tip"><p class="custom-block-title">Spring Cloud Gateway</p> <p><code>Spring Cloud Gateway</code> 是基于 <code>Spring</code> 生态系统之上构建的 <code>API</code> 网关，包括： <code>Spring 5.x</code> ， <code>Spring Boot 2.x</code> 和 <code>Project Reactor</code> 。 <code>Spring Cloud Gateway</code> 旨在提供一种简单而有效的方法来路由到 <code>API</code> ，并为它们提供跨领域的关注点，例如： <code>安全性</code> ， <code>监视/指标</code> ， <code>限流</code> 等。</p></div> <h3 id="核心概念"><a href="#核心概念" class="header-anchor">#</a> 核心概念</h3> <ul><li><code>路由（Route）</code> ：路由是网关最基础的部分，路由信息由 ID、目标 URI、一组断言和一组过滤器组成。如果断言
路由为真，则说明请求的 URI 和配置匹配。</li> <li><code>断言（Predicate）</code> ：Java8 中的断言函数。Spring Cloud Gateway 中的断言函数输入类型是 Spring 5.0 框架中
的 ServerWebExchange。Spring Cloud Gateway 中的断言函数允许开发者去定义匹配来自于 Http Request 中的任
何信息，比如请求头和参数等。</li> <li><code>过滤器（Filter）</code> ：一个标准的 Spring Web Filter。Spring Cloud Gateway 中的 Filter 分为两种类型，分别是
Gateway Filter 和 Global Filter。过滤器将会对请求和响应进行处理。</li></ul> <h3 id="工作流程"><a href="#工作流程" class="header-anchor">#</a> 工作流程</h3> <div class="custom-block tip"><p class="custom-block-title">摘要[2.2.9.RELEASE]</p> <p><img src="/img/dev/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E7%BD%91%E5%85%B3/spring_cloud_gateway_diagram.png" alt=""></p> <p>Clients make requests to Spring Cloud Gateway. If the Gateway Handler Mapping determines that a request matches a route, it is sent to the Gateway Web Handler. This handler runs the request through a filter chain that is specific to the request. The reason the filters are divided by the dotted line is that filters can run logic both before and after the proxy request is sent. All “pre” filter logic is executed. Then the proxy request is made. After the proxy request is made, the “post” filter logic is run.</p> <details class="custom-block details"><summary>点击查看译文</summary> <p>客户端向Spring Cloud Gateway发出请求。然后在Gateway Handler Mapping中找到与请求相匹配的路由，将其发送到Gateway Web Handler, Handler再通过指定的过滤器链来将请求发送到我们实际的服务执行业务逻辑，然后返回。用虚线分隔过滤器的原因是，过滤器可以在发送代理请求之前和之后运行逻辑。执行所有“pre”筛选逻辑。然后发出代理请求。发出代理请求后，运行“post”过滤器逻辑。</p> <div class="custom-block right"><p><a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway 官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></details></div> <h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <h4 id="_1、添加依赖"><a href="#_1、添加依赖" class="header-anchor">#</a> 1、添加依赖</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- spring cloud gateway 依赖 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_2、-通过微服务名实现动态路由"><a href="#_2、-通过微服务名实现动态路由" class="header-anchor">#</a> 2、 通过微服务名实现动态路由</h4> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token comment"># 需要注意的是uri的协议为lb，表示启用Gateway的负载均衡功能。</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
<span class="token comment">#  cloud:</span>
<span class="token comment">#    gateway:</span>
<span class="token comment">#      routes:</span>
<span class="token comment">#        - id: myapp_vue_demo #路由的ID，没有固定规则但要求唯一，建议配合服务名</span>
<span class="token comment">#          uri: http://localhost:8001   #匹配后提供服务的路由地址</span>
<span class="token comment">#          predicates:</span>
<span class="token comment">#            - Path=/demo1/get/**   #断言,路径相匹配的进行路由</span>

 <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
     <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
       <span class="token key atrule">locator</span><span class="token punctuation">:</span>
         <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment">#开启从注册中心动态创建路由的功能，利用微服务名进行路由</span>
     <span class="token key atrule">routes</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myapp_system <span class="token comment">#路由的ID，没有固定规则但要求唯一，建议配合服务名</span>
         <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//myapp_system
         <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
           <span class="token punctuation">-</span> Path=/sys/<span class="token important">**</span>   <span class="token comment">#断言,路径相匹配的进行路由</span>
       <span class="token punctuation">...</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="_3、网关启动类"><a href="#_3、网关启动类" class="header-anchor">#</a> 3、网关启动类</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GatewayApplication</span> <span class="token punctuation">{</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   	<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">GatewayApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="常用的路由规则-route-predicate"><a href="#常用的路由规则-route-predicate" class="header-anchor">#</a> 常用的路由规则(Route Predicate)</h2> <p><code>Spring Cloud Gateway</code> 创建 <code>Route</code> 对象时， 使用 <code>RoutePredicateFactory</code> 创建 <code>Predicate</code> 对象， <code>Predicate</code> 对象可以赋值给 <code>Route</code> 。</p> <ul><li><p><code>Spring Cloud Gateway</code> 包含许多内置的 <code>Route Predicate Factories</code> 。</p></li> <li><p>所有这些断言都匹配 HTTP 请求的不同属性。</p></li> <li><p>多个 <code>Route Predicate Factories</code> 可以通过逻辑与 <code>（and）</code> 结合起来一起使用。</p></li></ul> <p>路由断言工厂 <code>RoutePredicateFactory</code> 包含的主要实现类如图所示，包括 <code>Datetime</code> 、请求的远端地址、路由权重、请求头、Host 地址、请求方法、请求路径和请求参数等类型的路由断言。</p> <h3 id="_1-after-route-predicate"><a href="#_1-after-route-predicate" class="header-anchor">#</a> 1.After Route Predicate</h3> <p>匹配日期时间之后发生的请求</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
 <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
     <span class="token key atrule">routes</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>demo
         <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/
         <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
           <span class="token punctuation">-</span> After=2022<span class="token punctuation">-</span>08<span class="token punctuation">-</span>23T14<span class="token punctuation">:</span>20<span class="token punctuation">:</span>00.000+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_2-before-route-predicate"><a href="#_2-before-route-predicate" class="header-anchor">#</a> 2.Before Route Predicate</h3> <p>匹配日期时间之前发生的请求</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>demo
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Before=2022<span class="token punctuation">-</span>08<span class="token punctuation">-</span>08T10<span class="token punctuation">:</span>59<span class="token punctuation">:</span>34.102+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-between-route-predicate"><a href="#_3-between-route-predicate" class="header-anchor">#</a> 3.Between Route Predicate</h3> <p>匹配日期时间范围内发生的请求</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>demo
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Between=2022<span class="token punctuation">-</span>08<span class="token punctuation">-</span>08T10<span class="token punctuation">:</span>59<span class="token punctuation">:</span>34.102+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span> <span class="token punctuation">,</span>  2022<span class="token punctuation">-</span>08<span class="token punctuation">-</span>23T10<span class="token punctuation">:</span>59<span class="token punctuation">:</span>34.102+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_4-cookie-route-predicate"><a href="#_4-cookie-route-predicate" class="header-anchor">#</a> 4.Cookie Route Predicate</h3> <p><strong>Cookie Route Predicate</strong>需要两个参数:</p> <ul><li>cookie name</li> <li>正则表达式
路由规则会通过获取<code>cookie name</code>和正则表达式去匹配，如果匹配上才会执行。</li></ul> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
 <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
     <span class="token key atrule">routes</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>demo
         <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/
         <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
           <span class="token punctuation">-</span> Cookie=loginname<span class="token punctuation">,</span> myapp

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>测试  <code>curl http://localhost:8080 --cookie &quot;loginname=admin&quot;</code></p> <h3 id="_5-header-route-predicate"><a href="#_5-header-route-predicate" class="header-anchor">#</a> 5.Header Route Predicate</h3> <p>匹配具有指定名称的请求头， <code>\d+</code> 值匹配正则表达式</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
 <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
     <span class="token key atrule">routes</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>demo
         <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/
         <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
           <span class="token punctuation">-</span> Header=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Id<span class="token punctuation">,</span> \d+

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_6-host-route-predicate"><a href="#_6-host-route-predicate" class="header-anchor">#</a> 6.Host Route Predicate</h3> <p>匹配主机名的列表</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
 <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
     <span class="token key atrule">routes</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>demo
         <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/
         <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
           <span class="token punctuation">-</span> Host=<span class="token important">**.somehost.org</span><span class="token punctuation">,</span><span class="token important">**.anotherhost.org</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_7-method-route-predicate"><a href="#_7-method-route-predicate" class="header-anchor">#</a> 7.Method Route Predicate</h3> <p>匹配请求methods的参数，它是一个或多个参数</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
 <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
     <span class="token key atrule">routes</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>demo
         <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/
         <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
           <span class="token punctuation">-</span> Method=GET<span class="token punctuation">,</span>POST

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_8-path-route-predicate"><a href="#_8-path-route-predicate" class="header-anchor">#</a> 8.Path Route Predicate</h3> <p>匹配请求路径</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
 <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
     <span class="token key atrule">routes</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>demo
         <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/
         <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
           <span class="token punctuation">-</span> Path=/system/<span class="token important">**</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_9-query-route-predicate"><a href="#_9-query-route-predicate" class="header-anchor">#</a> 9.Query Route Predicate</h3> <p>匹配查询参数</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
 <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
     <span class="token key atrule">routes</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>demo
         <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/
         <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
           <span class="token punctuation">-</span> Query=username<span class="token punctuation">,</span> \d+ <span class="token comment">#要有参数名称并且是正整数才能路由</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_10-remoteaddr-route-predicate"><a href="#_10-remoteaddr-route-predicate" class="header-anchor">#</a> 10.RemoteAddr Route Predicate</h3> <p>匹配IP地址和子网掩码</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
 <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
     <span class="token key atrule">routes</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>demo
         <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/
         <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
           <span class="token punctuation">-</span> RemoteAddr=192.168.10.1/0

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_11-weight-route-predicate"><a href="#_11-weight-route-predicate" class="header-anchor">#</a> 11.Weight Route Predicate</h3> <p>匹配权重</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
 <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
     <span class="token key atrule">routes</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>demo
         <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/
         <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
           <span class="token punctuation">-</span> Weight=group1<span class="token punctuation">,</span> <span class="token number">8</span>
       <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>demo1
         <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8081/
         <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
           <span class="token punctuation">-</span> Weight=group1<span class="token punctuation">,</span> <span class="token number">2</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="路由配置"><a href="#路由配置" class="header-anchor">#</a> 路由配置</h2> <p>在 <code>spring cloud gateway</code> 中配置 <code>uri</code> 有三种方式，包括</p> <h3 id="_1-websocket配置方式"><a href="#_1-websocket配置方式" class="header-anchor">#</a> 1.websocket配置方式</h3> <p></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>api
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> ws<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>9090/
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/api/<span class="token important">**</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_2-http地址配置方式"><a href="#_2-http地址配置方式" class="header-anchor">#</a> 2.http地址配置方式</h3> <p></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>api
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>9090/
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/api/<span class="token important">**</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-注册中心配置方式"><a href="#_3-注册中心配置方式" class="header-anchor">#</a> 3.注册中心配置方式</h3> <p></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>api
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//myapp<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>api
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/api/<span class="token important">**</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="filter的使用"><a href="#filter的使用" class="header-anchor">#</a> Filter的使用</h2> <p>路由过滤器可用于修改进入的http请求和返回的http相应，路由过滤器只能指定路由进行使用。
生命周期修改请求</p> <ul><li>pre 在业务逻辑之前</li> <li>post在业务逻辑之后</li></ul> <h3 id="gatewayfilter"><a href="#gatewayfilter" class="header-anchor">#</a> GatewayFilter</h3> <h3 id="自定义全局globalfilter"><a href="#自定义全局globalfilter" class="header-anchor">#</a> 自定义全局GlobalFilter</h3> <p>通过继承<code>impiemerts GlobalFilter ，Ordered</code></p> <h2 id="跨域配置"><a href="#跨域配置" class="header-anchor">#</a> 跨域配置</h2> <div class="custom-block tip"><p class="custom-block-title">提示</p> <ul><li>什么是跨域问题？</li></ul> <p>跨域，指的是浏览器不能执行其他网站的脚本。它是由浏览器的同源策略造成的，是浏览器对 <code>JavaScript</code> 施加的安全限制。</p> <ul><li>什么是同源？</li></ul> <p>所谓同源是指，域名，协议，端口均相同</p> <ul><li>使用 CORS（跨资源共享）解决跨域问题</li></ul> <p>CORS 是一个 W3C 标准，全称是&quot;跨域资源共享&quot;（Cross-origin resource sharing）。它允许浏览器向跨源服务器，发出 XMLHttpRequest 请求，从而克服了 AJAX 只能同源使用的限制。</p> <p>CORS 需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE 浏览器不能低于 IE10</p> <p>整个 CORS 通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS 通信与同源的 AJAX 通信没有差别，代码完全一样。浏览器一旦发现 AJAX 请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉</p> <p>因此，实现 CORS 通信的关键是服务器。只要服务器实现了 CORS 接口，就可以跨源通信</p></div> <p>配置方式：<strong>可以在 <code>application.yml</code> 文件中加入以下配置解决跨域问题</strong></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
 <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
     <span class="token key atrule">globalcors</span><span class="token punctuation">:</span>
       <span class="token key atrule">corsConfigurations</span><span class="token punctuation">:</span>
         <span class="token key atrule">'[/**]'</span><span class="token punctuation">:</span>
           <span class="token key atrule">allowedOriginPatterns</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span>
           <span class="token key atrule">allowed-methods</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span>
           <span class="token key atrule">allowed-headers</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span>
           <span class="token key atrule">allow-credentials</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
           <span class="token key atrule">exposedHeaders</span><span class="token punctuation">:</span> <span class="token string">&quot;Content-Disposition,Content-Type,Cache-Control&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>代码方式：<strong>新增 <code>CorsConfig.java</code> 跨域代码配置</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpHeaders</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpMethod</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">ServerHttpRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">ServerHttpResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>cors<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">CorsUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerWebExchange</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">WebFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">WebFilterChain</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
* 跨域配置
* 
* @author ruoyi
*/</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CorsConfig</span>
<span class="token punctuation">{</span>
   <span class="token comment">/**
    * 这里为支持的请求头，如果有自定义的header字段请自己添加
    */</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ALLOWED_HEADERS</span> <span class="token operator">=</span> <span class="token string">&quot;X-Requested-With, Content-Type, Authorization, credential, X-XSRF-TOKEN, token, Admin-Token, App-Token&quot;</span><span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ALLOWED_METHODS</span> <span class="token operator">=</span> <span class="token string">&quot;GET,POST,PUT,DELETE,OPTIONS,HEAD&quot;</span><span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ALLOWED_ORIGIN</span> <span class="token operator">=</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ALLOWED_EXPOSE</span> <span class="token operator">=</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">MAX_AGE</span> <span class="token operator">=</span> <span class="token string">&quot;18000L&quot;</span><span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Bean</span>
   <span class="token keyword">public</span> <span class="token class-name">WebFilter</span> <span class="token function">corsFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> ctx<span class="token punctuation">,</span> <span class="token class-name">WebFilterChain</span> chain<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
           <span class="token class-name">ServerHttpRequest</span> request <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CorsUtils</span><span class="token punctuation">.</span><span class="token function">isCorsRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
               <span class="token class-name">ServerHttpResponse</span> response <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token class-name">HttpHeaders</span> headers <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               headers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Headers&quot;</span><span class="token punctuation">,</span> <span class="token constant">ALLOWED_HEADERS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               headers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Methods&quot;</span><span class="token punctuation">,</span> <span class="token constant">ALLOWED_METHODS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               headers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">,</span> <span class="token constant">ALLOWED_ORIGIN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               headers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Expose-Headers&quot;</span><span class="token punctuation">,</span> <span class="token constant">ALLOWED_EXPOSE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               headers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Max-Age&quot;</span><span class="token punctuation">,</span> <span class="token constant">MAX_AGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               headers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Credentials&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">OPTIONS</span><span class="token punctuation">)</span>
               <span class="token punctuation">{</span>
                   response<span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token keyword">return</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
           <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>



</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>如果可以通过部署手段（例如nginx配置代理等）解决跨域，则可以不需要添加跨域支持。</p></div> <h2 id="sentinel整合"><a href="#sentinel整合" class="header-anchor">#</a> sentinel整合</h2> <p>Sentinel 支持对 Spring Cloud Gateway、Netflix Zuul 等主流的 API Gateway 进行限流。</p> <h3 id="_1、添加依赖-2"><a href="#_1、添加依赖-2" class="header-anchor">#</a> 1、添加依赖</h3> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- SpringCloud Alibaba Sentinel --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
   	
<span class="token comment">&lt;!-- SpringCloud Alibaba Sentinel Gateway --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-sentinel-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_2、配置sentinel-yaml"><a href="#_2、配置sentinel-yaml" class="header-anchor">#</a> 2、配置sentinel.yaml</h3> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token comment">#Sentinel 控制台地址</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">transport</span><span class="token punctuation">:</span>
         <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span>
      <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token comment"># 名称随意	</span>
        <span class="token key atrule">gw-flow</span><span class="token punctuation">:</span>
          <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
            <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
            <span class="token key atrule">dataId</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span class="token punctuation">-</span>gateway<span class="token punctuation">-</span>flow<span class="token punctuation">-</span>rules	
            <span class="token key atrule">groupId</span><span class="token punctuation">:</span> SENTINEL_GROUP	
            <span class="token comment"># 规则类型，取值见：	</span>
            <span class="token comment"># org.springframework.cloud.alibaba.sentinel.datasource.RuleType	</span>
            <span class="token key atrule">rule-type</span><span class="token punctuation">:</span> gw<span class="token punctuation">-</span>flow	
        <span class="token key atrule">degrade</span><span class="token punctuation">:</span>
          <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
            <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
            <span class="token key atrule">dataId</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span class="token punctuation">-</span>degrade<span class="token punctuation">-</span>rules	
            <span class="token key atrule">groupId</span><span class="token punctuation">:</span> SENTINEL_GROUP	
            <span class="token key atrule">rule-type</span><span class="token punctuation">:</span> degrade	
        <span class="token key atrule">system</span><span class="token punctuation">:</span>
          <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
            <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
            <span class="token key atrule">dataId</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span class="token punctuation">-</span>system<span class="token punctuation">-</span>rules	
            <span class="token key atrule">groupId</span><span class="token punctuation">:</span> SENTINEL_GROUP	
            <span class="token key atrule">rule-type</span><span class="token punctuation">:</span> system	
        <span class="token key atrule">authority</span><span class="token punctuation">:</span>
          <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
            <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
            <span class="token key atrule">dataId</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span class="token punctuation">-</span>authority<span class="token punctuation">-</span>rules	
            <span class="token key atrule">groupId</span><span class="token punctuation">:</span> SENTINEL_GROUP	
            <span class="token key atrule">rule-type</span><span class="token punctuation">:</span> authority	
        <span class="token key atrule">param-flow</span><span class="token punctuation">:</span>
          <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
            <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
            <span class="token key atrule">dataId</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span class="token punctuation">-</span>param<span class="token punctuation">-</span>flow<span class="token punctuation">-</span>rules	
            <span class="token key atrule">groupId</span><span class="token punctuation">:</span> SENTINEL_GROUP
            <span class="token key atrule">rule-type</span><span class="token punctuation">:</span> param<span class="token punctuation">-</span>flow
        <span class="token key atrule">gw-api</span><span class="token punctuation">:</span>
          <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
            <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
            <span class="token key atrule">dataId</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span class="token punctuation">-</span>gateway<span class="token punctuation">-</span>api<span class="token punctuation">-</span>rules	
            <span class="token key atrule">groupId</span><span class="token punctuation">:</span> SENTINEL_GROUP	
            <span class="token key atrule">rule-type</span><span class="token punctuation">:</span> gw<span class="token punctuation">-</span>api<span class="token punctuation">-</span>group
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>通过sentinel-dashboard来限流，流控规则存储到nacos的配置中心。通过配置<code>bootstrap.yml</code>读取配置中心的流控规则</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> <span class="token string">'@nacos.addr@'</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> @nacos.password@
        <span class="token key atrule">password</span><span class="token punctuation">:</span> @nacos.password@
        extension<span class="token punctuation">-</span>configs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token key atrule">dataId</span><span class="token punctuation">:</span> gateway<span class="token punctuation">-</span>sentinel.yaml
            <span class="token key atrule">group</span><span class="token punctuation">:</span> @nacos.group@
            <span class="token key atrule">refresh</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div> <h3 id="sentinel自定义异常"><a href="#sentinel自定义异常" class="header-anchor">#</a> Sentinel自定义异常</h3> <p>为了展示更加友好的限流提示， Sentinel支持自定义异常处理。</p> <p>方案一： <code>yml</code> 配置</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># Spring</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span> 
 <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
     <span class="token key atrule">scg</span><span class="token punctuation">:</span>
       <span class="token key atrule">fallback</span><span class="token punctuation">:</span>
         <span class="token key atrule">mode</span><span class="token punctuation">:</span> response
         <span class="token key atrule">response-body</span><span class="token punctuation">:</span> <span class="token string">'{&quot;code&quot;:403,&quot;msg&quot;:&quot;请求超过最大数，请稍后再试&quot;}'</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>方案二： <code>GatewayConfig</code> 注入 <code>Bean</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">HIGHEST_PRECEDENCE</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">SentinelFallbackHandler</span> <span class="token function">sentinelGatewayExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SentinelFallbackHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>SentinelFallbackHandler.java</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResponseExceptionHandler</span> <span class="token keyword">extends</span> <span class="token class-name">SentinelGatewayBlockExceptionHandler</span> <span class="token punctuation">{</span>

   <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">Log</span> <span class="token constant">LOG</span> <span class="token operator">=</span> <span class="token class-name">LogFactory</span><span class="token punctuation">.</span><span class="token function">getLog</span><span class="token punctuation">(</span><span class="token class-name">ResponseExceptionHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token class-name">ResponseExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ViewResolver</span><span class="token punctuation">&gt;</span></span> viewResolvers<span class="token punctuation">,</span>
   								<span class="token class-name">ServerCodecConfigurer</span> serverCodecConfigurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   	<span class="token keyword">super</span><span class="token punctuation">(</span>viewResolvers<span class="token punctuation">,</span> serverCodecConfigurer<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   	<span class="token constant">LOG</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
   	<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> datas <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;{\&quot;code\&quot;:403,\&quot;msg\&quot;:\&quot;请稍后再试\&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   	<span class="token keyword">if</span><span class="token punctuation">(</span>ex <span class="token keyword">instanceof</span>  <span class="token class-name">ResponseStatusException</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
   		<span class="token class-name">ResponseStatusException</span> responseStatusException <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ResponseStatusException</span><span class="token punctuation">)</span> ex<span class="token punctuation">;</span>
   		<span class="token class-name">HttpStatus</span> status <span class="token operator">=</span> responseStatusException<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   		datas <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;{\&quot;code\&quot;:&quot;</span><span class="token operator">+</span>status<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;,\&quot;msg\&quot;:\&quot;&quot;</span><span class="token operator">+</span>status<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>status<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   	<span class="token punctuation">}</span>
   	<span class="token class-name">ServerHttpResponse</span> serverHttpResponse <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       serverHttpResponse<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">DataBuffer</span> buffer <span class="token operator">=</span> serverHttpResponse<span class="token punctuation">.</span><span class="token function">bufferFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>datas<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> serverHttpResponse<span class="token punctuation">.</span><span class="token function">writeWith</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="官方提供requestratelimitergatewayfilterfactory限流"><a href="#官方提供requestratelimitergatewayfilterfactory限流" class="header-anchor">#</a> 官方提供RequestRateLimiterGatewayFilterFactory限流</h2> <p>顾名思义，限流就是限制流量。通过限流，我们可以很好地控制系统的 QPS，从而达到保护系统的目的。</p> <p>常见的限流算法有： <code>计数器</code> 算法， <code>漏桶（Leaky Bucket）</code> 算法， <code>令牌桶（Token Bucket）</code> 算法。</p> <p><code>Spring Cloud Gateway</code> 官方提供了 <code>RequestRateLimiterGatewayFilterFactory</code> 过滤器工厂，使用 <code>Redis</code>
和 <code>Lua</code> 脚本实现了令牌桶的方式。</p> <h3 id="_1、添加依赖-3"><a href="#_1、添加依赖-3" class="header-anchor">#</a> 1、添加依赖</h3> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- spring data redis reactive 依赖 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis-reactive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2、限流规则-根据-uri-限流"><a href="#_2、限流规则-根据-uri-限流" class="header-anchor">#</a> 2、限流规则，根据 <code>URI</code> 限流</h3> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> 
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>demo
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//myapp<span class="token punctuation">-</span>demo
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/sys/<span class="token important">**</span>
          <span class="token key atrule">filters</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> StripPrefix=1 <span class="token comment"># 表示网关转发到业务模块时候会自动截取前缀。1代表截取/sys</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RequestRateLimiter
              <span class="token key atrule">args</span><span class="token punctuation">:</span>
                <span class="token key atrule">redis-rate-limiter.replenishRate</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># 令牌桶每秒填充速率</span>
                <span class="token key atrule">redis-rate-limiter.burstCapacity</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment"># 令牌桶总容量</span>
                <span class="token key atrule">key-resolver</span><span class="token punctuation">:</span> <span class="token string">&quot;#{@pathKeyResolver}&quot;</span> <span class="token comment"># 使用 SpEL 表达式按名称引用 bean</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_3、编写-uri-限流规则配置类"><a href="#_3、编写-uri-限流规则配置类" class="header-anchor">#</a> 3、编写 <code>URI</code> 限流规则配置类</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span>ratelimit<span class="token punctuation">.</span></span><span class="token class-name">KeyResolver</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 限流规则配置类
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KeyResolverConfiguration</span>
<span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">KeyResolver</span> <span class="token function">pathKeyResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> exchange <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_4、测试服务验证限流"><a href="#_4、测试服务验证限流" class="header-anchor">#</a> 4、测试服务验证限流</h3> <p>启动网关服务 <code>GatewayApplication.java</code> 和系统服务 <code>DemoApplication.java</code> 。</p> <p>因为网关服务有认证鉴权，可以设置一下白名单 <code>/sys/**</code> 在进行测试，多次请求会发现返回 <code>HTTP ERROR 429</code> ，同时在 <code>redis</code> 中会操作两个 <code>key</code> ，表示限流成功。</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>request_rate_limiter.{xxx}.timestamp
request_rate_limiter.{xxx}.tokens

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">其他限流规则</p> <p>参数限流： <code>key-resolver: &quot;#{@parameterKeyResolver}&quot;</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">KeyResolver</span> <span class="token function">parameterKeyResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">return</span> exchange <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>IP限流： <code>key-resolver: &quot;#{@ipKeyResolver}&quot;</code></p> <p></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">KeyResolver</span> <span class="token function">ipKeyResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">return</span> exchange <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHostName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/02/19, 14:29:03</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/note-doc/pages/4107ab/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Spring Boot 模式启动</div></a> <a href="/note-doc/pages/05eabd/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">权限认证</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/note-doc/pages/4107ab/" class="prev">Spring Boot 模式启动</a></span> <span class="next"><a href="/note-doc/pages/05eabd/">权限认证</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/note-doc/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/note-doc/pages/a6ecb9/"><div>
            Google Java 编程风格指南
            <!----></div></a> <span class="date">03-14</span></dt></dl><dl><dd>02</dd> <dt><a href="/note-doc/pages/8f2cb7/"><div>
            触发器
            <!----></div></a> <span class="date">03-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/note-doc/pages/25f802/"><div>
            延迟等待
            <!----></div></a> <span class="date">03-14</span></dt></dl> <dl><dd></dd> <dt><a href="/note-doc/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>Evan Xu | <a href="https://github.com/simpleguan/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/note-doc/assets/js/app.b1b91d6a.js" defer></script><script src="/note-doc/assets/js/2.d4cb6c72.js" defer></script><script src="/note-doc/assets/js/85.333a9d04.js" defer></script>
  </body>
</html>
